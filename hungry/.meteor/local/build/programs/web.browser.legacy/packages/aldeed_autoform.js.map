{"version":3,"sources":["meteor://ðŸ’»app/packages/aldeed:autoform/utility.js","meteor://ðŸ’»app/packages/aldeed:autoform/form-preserve.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform-hooks.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform-formdata.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform-arrays.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform-helpers.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform-validation.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform-inputs.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform-api.js","meteor://ðŸ’»app/packages/aldeed:autoform/formTypes/insert.js","meteor://ðŸ’»app/packages/aldeed:autoform/formTypes/update.js","meteor://ðŸ’»app/packages/aldeed:autoform/formTypes/update-pushArray.js","meteor://ðŸ’»app/packages/aldeed:autoform/formTypes/method.js","meteor://ðŸ’»app/packages/aldeed:autoform/formTypes/method-update.js","meteor://ðŸ’»app/packages/aldeed:autoform/formTypes/normal.js","meteor://ðŸ’»app/packages/aldeed:autoform/formTypes/readonly.js","meteor://ðŸ’»app/packages/aldeed:autoform/formTypes/disabled.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/value-converters.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/boolean-checkbox/boolean-checkbox.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/boolean-radios/boolean-radios.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/boolean-select/boolean-select.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/button/button.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/color/color.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/contenteditable/contenteditable.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/date/date.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/datetime/datetime.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/datetime-local/datetime-local.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/email/email.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/file/file.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/hidden/hidden.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/image/image.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/month/month.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/number/number.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/password/password.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/radio/radio.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/range/range.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/reset/reset.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/search/search.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/select/select.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/select-checkbox/select-checkbox.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/select-checkbox-inline/select-checkbox-inline.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/select-multiple/select-multiple.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/select-radio/select-radio.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/select-radio-inline/select-radio-inline.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/submit/submit.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/tel/tel.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/text/text.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/textarea/textarea.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/time/time.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/url/url.js","meteor://ðŸ’»app/packages/aldeed:autoform/inputTypes/week/week.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/autoForm/autoForm.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/quickForm/quickForm.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/afArrayField/afArrayField.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/afEachArrayItem/afEachArrayItem.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/afFieldInput/afFieldInput.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/afFormGroup/afFormGroup.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/afObjectField/afObjectField.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/afQuickField/afQuickField.js","meteor://ðŸ’»app/packages/aldeed:autoform/components/afQuickFields/afQuickFields.js","meteor://ðŸ’»app/packages/aldeed:autoform/autoform-events.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/bootstrap3.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/components/quickForm/quickForm.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/components/afArrayField/afArrayField.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/components/afFormGroup/afFormGroup.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/components/afObjectField/afObjectField.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/inputTypes/boolean-radios/boolean-radios.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/inputTypes/radio/radio.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/inputTypes/select-checkbox/select-checkbox.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/inputTypes/select-checkbox-inline/select-checkbox-inline.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/inputTypes/select-radio/select-radio.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3/inputTypes/select-radio-inline/select-radio-inline.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3-horizontal/components/quickForm/quickForm.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3-horizontal/components/afArrayField/afArrayField.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3-horizontal/components/afFormGroup/afFormGroup.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3-horizontal/components/afObjectField/afObjectField.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3-horizontal/inputTypes/boolean-checkbox/boolean-checkbox.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/bootstrap3-inline/bootstrap3-inline.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/plain/components/quickForm/quickForm.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/plain/components/afObjectField/afObjectField.js","meteor://ðŸ’»app/packages/aldeed:autoform/templates/plain-fieldset/plain-fieldset.js"],"names":["MongoObject","module","watch","require","v","Utility","componentTypeList","cleanNulls","doc","isArray","keepEmptyStrings","newDoc","_","each","val","key","isBasicObject","isEmpty","isNullUndefinedOrEmptyString","length","reportNulls","flatDoc","nulls","docToModifier","options","modifier","mDoc","getFlatObject","keepArrays","$set","$unset","getSelectValues","select","result","opt","i","ln","selected","push","value","text","getSelectOptions","defs","hash","schemaType","type","selectOptions","map","allowedValues","label","capitalize","String","charAt","toUpperCase","slice","toLowerCase","isObject","k","lookup","obj","ref","window","arr","split","shift","Error","getFieldDefinition","ss","name","def","getDefinition","objAffectsKey","affectsKey","expandObj","subkeys","subkey","subkeylen","nextPiece","current","parseInt","isNaN","compactArrays","without","arrayItem","Date","bubbleEmpty","allEmpty","all","prop","isValidDateString","dateString","m","moment","isValid","isValidTimeString","timeString","regEx","test","isValidNormalizedForcedUtcGlobalDateAndTimeString","datePart","substring","tPart","timePart","zPart","isValidNormalizedLocalDateAndTimeString","dtString","getComponentContext","autoFormGetComponentContext","context","atts","formComponentAttributes","fieldAttributes","fieldAttributesForComponentType","clone","AutoForm","getFormSchema","findAttributesWithPrefix","autoform","omit","extend","evaluatedAtts","call","stringToArray","s","errorMessage","replace","addClass","klass","getFormTypeDef","formType","ftd","_formTypeDefinitions","checkTemplate","template","view","_domrange","isDestroyed","makeKeyGeneric","Object","getPrototypeOf","__proto__","object","constructor","prototype","FormPreserve","formPreserveConstructor","migrationName","self","isString","registeredForms","retrievedDocuments","Package","reload","Reload","_migrationData","EJSON","parse","_onMigrate","_retrieveRegisteredDocuments","stringify","getDocument","formId","has","clearDocument","registerForm","retrieveFunc","formIsRegistered","unregisterForm","unregisterAllForms","res","Hooks","form","hookNames","getDefault","hooks","before","after","hookName","global","addHooksToList","hooksList","autoFormBeforeHooksEach","func","autoFormAfterHooksEach","autoFormHooksEach","getHooks","subtype","f","g","concat","FormData","forms","initForm","sourceDoc","deps","Tracker","Dependency","changed","depend","ArrayTracker","afArrayTracker","info","getMinMax","atGetMinMax","field","overrideMinCount","overrideMaxCount","minCount","Math","max","Infinity","maxCount","min","atInitForm","getForm","ensureField","atEnsureField","resetField","initField","atInitField","docCount","array","range","arrayCount","childKeys","objectKeys","loopArray","loopCtx","createLoopCtx","count","visibleCount","atResetField","resetForm","atResetForm","untrackForm","atUntrackForm","tracksField","atTracksField","getField","atGetField","getCount","atGetCount","getVisibleCount","atGetVisibleCount","isFirstFieldlVisible","atIsFirstFieldlVisible","currentIndex","firstVisibleField","find","currentField","removed","index","isLastFieldlVisible","atIsLastFieldlVisible","lastVisibleField","last","filter","addOneToField","atAddOneToField","currentCount","removeFromFieldAtIndex","atRemoveFromFieldAtIndex","arrayFieldName","formPreserve","reactiveFormData","_inputTypeDefinitions","arrayTracker","_destroyForm","globalDefaultTemplate","defaultTypeTemplates","defaultTemplate","parseOptions","Template","registerHelper","autoFormFieldMessage","getFormId","namedContext","keyErrorMessage","autoFormFieldIsInvalid","keyIsInvalid","autoFormArrayFieldHasMoreThanMinimum","getCurrentDataPlusExtrasForForm","formTypeDef","hideArrayItemButtons","id","autoFormArrayFieldHasLessThanMaximum","autoFormFieldValueIs","currentValue","getFieldValue","autoFormFieldValue","autoFormArrayFieldIsFirstVisible","autoFormArrayFieldIsLastVisible","autoFormFieldValueContains","contains","values","intersection","autoFormFieldLabelText","getLabelForField","autoFormFieldNames","namePlusDot","genericName","genericNamePlusDot","getCurrentDataForForm","fieldList","fields","usedAncestorFieldList","ancestorFieldList","findAttribute","indexOf","filterFieldsByName","filterArrayFields","reject","lastDotPos","lastIndexOf","parentField","omitFields","difference","shouldIncludeField","fieldDefs","denyInsert","denyUpdate","unique","afSelectOptionAtts","pick","htmlAtts","afOptionsFromSchema","_getOptionsForField","_validateField","skipEmpty","onlyIfAlreadyInvalid","docToValidate","templateInstanceForForm","getFormValues","usesModifier","_validateFormDoc","validateField","throttle","getFlatDocOfFieldValues","fieldName","getInputValue","$","attr","schemaDefaultValue","fieldDefaultValue","typeDefs","valueInfo","getInfoForKey","valueIsArray","valueIn","getInputData","inputAtts","required","optional","placeholder","booleanProp","inputTypeContext","data","adjustInputContext","markChanged","setTimeout","formValues","requestInProgress","updateTrackedFieldValue","dotPos","updateAllTrackedFieldValues","o","getAllFieldsInForm","not","addHooks","autoFormAddHooks","formIds","autoFormHooks","hooksObj","_hooks","_globalHooks","_forceResetFormValues","autoFormForceResetFormValues","ReactiveVar","set","autoFormResetForm","reset","setDefaultTemplate","autoFormSetDefaultTemplate","getDefaultTemplate","autoFormGetDefaultTemplate","setDefaultTemplateForType","autoFormSetDefaultTemplateForType","getDefaultTemplateForType","autoFormGetDefaultTemplateForType","getTemplateName","autoFormGetTemplateName","templateType","templateName","skipExistsCheck","templateExists","t","_debug","console","warn","schemaAutoFormDefs","fieldSchema","getSchemaForField","templateFromAncestor","defaultTemplateForType","autoFormGetFormValues","getModifier","insertDoc","updateDoc","transforms","removeEmptyStrings","autoConvert","trimStrings","setArrayItems","hookCtx","schema","clean","isModifier","getAutoValues","mutate","formValuesTransform","transform","autoFormGetFieldValue","nonreactive","rerunWhenFormRenderedOrDestroyed","getValueForKey","getInputTypeTemplateNameForElement","autoFormGetInputTypeTemplateNameForElement","element","Blaze","getView","originalParentView","parentView","autoFormGetInputValue","fieldType","arrayItemFieldType","typeDef","inputTypeTemplate","dataContext","getData","getQuickTypeForKey","lastUnderscore","where","valueOut","valueConverters","converterFunc","addInputType","afAddInputType","definition","addFormType","afAddFormType","autoFormValidateField","validateForm","autoFormValidateForm","formDoc","needsModifierAndDoc","validation","useCollectionSchema","getValidationContext","autoFormGetValidationContext","_resolvedSchema","autoFormFindAttribute","attrName","viewData","checkView","currentView","undefined","autoFormFindAttributesWithPrefix","prefix","searchObj","debug","autoFormDebug","onError","operation","error","log","getInputType","expectsArray","endsWith","noselect","rows","autoFormGetSchemaForField","autoFormGetOptionsForField","saf","afFieldInput","afQuickField","getAllowedValuesForKey","autoFormGetLabelForField","viewForForm","templateInstance","formElement","document","getElementById","err","getArrayCountFromDocForField","keyInfo","parseData","setDefaults","getFormCollection","collection","selectFirstInvalidField","ctx","focus","removeAttr","addStickyValidationError","_stickyErrors","removeStickyValidationError","validateFormDoc","ec","userId","Meteor","isInsert","isUpdate","isUpsert","isFromTrustedCode","docId","_id","docForValidation","extendAutoValueContext","vc","validate","extendedCustomContext","keys","stickyError","addValidationErrors","stickyErrors","simpleSchema","adjustSchema","waitingForForms","triggerFormRenderedDestroyedReruns","onSubmit","c","event","preventDefault","collectionHasSchema","runBeforeHooks","insert","validationOptions","shouldPrevalidate","formAttributes","update","scope","modifer","$push","getObjectSchema","meteormethod","valid","formTypeDefinition","ssIsOverride","failedValidation","ddp","hookCount","doneCount","submitError","submitResult","endSubmission","done","hookContext","shouldStop","eachOnSubmit","hook","currentDoc","stopPropagation","readonly","disabled","booleanToString","booleanToStringArray","booleanToNumber","booleanToNumberArray","dateToDateString","format","dateToDateStringUTC","utc","dateToDateStringUTCArray","dateToNormalizedForcedUtcGlobalDateAndTimeString","dateToNormalizedForcedUtcGlobalDateAndTimeStringArray","dateToNormalizedLocalDateAndTimeString","date","timezoneId","tz","dateToNumber","getTime","dateToNumberArray","dateToDateArray","stringToStringArray","item","trim","stringToNumber","numVal","Number","stringToNumberArray","stringToBoolean","lval","stringToBooleanArray","stringToDate","stringToDateArray","numberToString","toString","numberToStringArray","numberToNumberArray","numberToBoolean","numberToBooleanArray","stringToBool","is","contextAdjust","checked","afBooleanRadioGroup","helpers","falseAtts","trueAtts","nullAtts","dsk","items","nullLabel","firstOption","falseLabel","trueLabel","html","afContenteditable","events","target","change","getValue","instance","isRendered","onRendered","autorun","currentData","toDate","dateToNormalizedLocalDateAndTimeStringArray","maxlength","isHidden","selectedAttsAdjust","autocomplete","itemAtts","optgroup","subItems","subOpt","afCheckboxGroup","afCheckboxGroupInline","afRadioGroup","afRadioGroupInline","linesToArray","lines","line","autoForm","autoFormTplAtts","htmlAttributes","removeProps","hasComponentPrefix","any","componentType","hasOwnProperty","novalidate","afDestroyUpdateForm","get","created","autoFormCreated","preserveForm","autoFormRegFormCallback","firstRun","retrievedDoc","autoFormEachDocToForm","rendered","autoFormRendered","lastId","destroyed","autoFormDestroyed","quickForm","innerContext","quickFormContext","adjustedData","sortedSchema","fieldGroups","grouplessFieldContext","fullSchema","mergedSchema","forEach","grouplessFields","getFieldsWithNoGroup","fieldGroupNames","getSortedFieldGroupNames","fieldGroupName","fieldsForGroup","getFieldsForGroup","qfAutoFormContext","qfShouldRenderButton","buttonContent","schemaObj","names","group","compact","sort","groupName","afArrayField","afArrayFieldContext","fieldMinCount","fieldMaxCount","initialCount","afEachArrayItem","afEachArrayItemContext","inputType","componentDef","inputTemplateName","styleTemplateName","afFieldInputContext","defaultValue","Array","iData","afFormGroup","afFormGroupContext","afFormGroupAtts","formGroupAtts","afFieldLabelAtts","formGroupLabelAtts","afFieldInputAtts","formGroupInputAtts","Random","idPrefix","skipLabel","afFormGroupClass","labelText","labelAtts","autoFormLabelAttsEach","afObjectField","isGroup","afQuickFieldIsGroup","isSubschema","_schema","isFieldArray","afQuickFieldIsFieldArray","groupAtts","afQuickFieldGroupAtts","isHiddenInput","afQuickFieldIsHiddenInput","afQuickFields","quickFieldAtts","afQuickFieldsQuickFieldAtts","afQuickFieldsComponentAtts","defaultOptions","parentData","lastAutoSaveElement","lastKeyVals","beginSubmit","beginSubmitHooks","submitButton","endSubmit","endSubmitHooks","adjustKeyForArrays","gKey","validationType","getKeyForElement","getAttribute","closest","throttleAutosave","currentTarget","submit","leading","autoFormSubmitHandler","validationContext","onSuccessHooks","onErrorHooks","beforeHooks","afterHooks","autoSaveChangedElement","ik","validationErrors","message","onErrorEach","next","runHook","cb","d","once","resultCallback","resetOnSuccess","autosave","onSuccessEach","afterHooksEach","e","autoFormKeyUpHandler","keyCode","arrayKey","autosaveOnKeyup","autoFormBlurHandler","autoFormChangeHandler","$target","keyVal","autoFormResetHandler","autoFormClickRemoveItem","autoFormClickAddItem","btn","attsPlusFormControlClass","attsPlusBtnClass","quickForm_bootstrap3","fieldGroupLabel","substr","SimpleSchema","defaultLabel","quickFieldsAtts","submitButtonAtts","bsQuickFormSubmitButtonAtts","qfAtts","buttonClasses","afArrayField_bootstrap3","panelClass","headingClass","afFormGroup_bootstrap3","bsFormGroupSkipLabel","bsFieldLabelAtts","afObjectField_bootstrap3","afBooleanRadioGroup_bootstrap3","afRadio_bootstrap3","afCheckboxGroup_bootstrap3","afCheckboxGroupInline_bootstrap3","afRadioGroup_bootstrap3","afRadioGroupInline_bootstrap3","inputClass","labelClass","rightColumnClass","leftLabel","attsPlusSpecialClass","useLeftLabel","quickForm_plain","plQuickFormSubmitButtonAtts","afObjectField_plain","plfsQuickFormSubmitButtonAtts"],"mappings":"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","file":"/packages/aldeed_autoform.js","sourcesContent":["import MongoObject from 'mongo-object';\n\n/* global Utility:true, AutoForm, moment */\n\nUtility = {\n  componentTypeList: ['afArrayField', 'afEachArrayItem', 'afFieldInput', 'afFormGroup', 'afObjectField', 'afQuickField', 'afQuickFields', 'autoForm', 'quickForm'],\n  /**\n   * @method Utility.cleanNulls\n   * @private\n   * @param {Object} doc - Source object\n   * @returns {Object}\n   *\n   * Returns an object in which all properties with null, undefined, or empty\n   * string values have been removed, recursively.\n   */\n  cleanNulls: function cleanNulls(doc, isArray, keepEmptyStrings) {\n    var newDoc = isArray ? [] : {};\n    _.each(doc, function(val, key) {\n      if (!_.isArray(val) && isBasicObject(val)) {\n        val = cleanNulls(val, false, keepEmptyStrings); // recurse into plain objects\n        if (!_.isEmpty(val)) {\n          newDoc[key] = val;\n        }\n      } else if (_.isArray(val)) {\n        val = cleanNulls(val, true, keepEmptyStrings); // recurse into non-typed arrays\n        if (!_.isEmpty(val)) {\n          newDoc[key] = val;\n        }\n      } else if (!Utility.isNullUndefinedOrEmptyString(val)) {\n        newDoc[key] = val;\n      } else if (keepEmptyStrings && typeof val === 'string' && val.length === 0) {\n        newDoc[key] = val;\n      }\n    });\n    return newDoc;\n  },\n  /**\n   * @method Utility.reportNulls\n   * @private\n   * @param {Object} flatDoc - An object with no properties that are also objects.\n   * @returns {Object} An object in which the keys represent the keys in the\n   * original object that were null, undefined, or empty strings, and the value\n   * of each key is \"\".\n   */\n  reportNulls: function reportNulls(flatDoc, keepEmptyStrings) {\n    var nulls = {};\n    // Loop through the flat doc\n    _.each(flatDoc, function(val, key) {\n      // If value is undefined, null, or an empty string, report this as null so it will be unset\n      if (val === null) {\n        nulls[key] = '';\n      } else if (val === void 0) {\n        nulls[key] = '';\n      } else if (!keepEmptyStrings && typeof val === 'string' && val.length === 0) {\n        nulls[key] = '';\n      }\n      // If value is an array in which all the values recursively are undefined, null, or an empty string, report this as null so it will be unset\n      else if (_.isArray(val) && Utility.cleanNulls(val, true, keepEmptyStrings).length === 0) {\n        nulls[key] = '';\n      }\n    });\n    return nulls;\n  },\n  /**\n   * @method Utility.docToModifier\n   * @private\n   * @param {Object} doc - An object to be converted into a MongoDB modifier\n   * @param {Object} [options] - Options\n   * @param {Boolean} [options.keepEmptyStrings] - Pass `true` to keep empty strings in the $set. Otherwise $unset them.\n   * @param {Boolean} [options.keepArrays] - Pass `true` to $set entire arrays. Otherwise the modifier will $set individual array items.\n   * @returns {Object} A MongoDB modifier.\n   *\n   * Converts an object into a modifier by flattening it, putting keys with\n   * null, undefined, and empty string values into `modifier.$unset`, and\n   * putting the rest of the keys into `modifier.$set`.\n   */\n  docToModifier: function docToModifier(doc, options) {\n    var modifier = {}, mDoc, flatDoc, nulls;\n    options = options || {};\n\n    // Flatten doc\n    mDoc = new MongoObject(doc);\n    flatDoc = mDoc.getFlatObject({ keepArrays: !!options.keepArrays });\n    // Get a list of null, undefined, and empty string values so we can unset them instead\n    nulls = Utility.reportNulls(flatDoc, !!options.keepEmptyStrings);\n    flatDoc = Utility.cleanNulls(flatDoc, false, !!options.keepEmptyStrings);\n\n    if (!_.isEmpty(flatDoc)) {\n      modifier.$set = flatDoc;\n    }\n    if (!_.isEmpty(nulls)) {\n      modifier.$unset = nulls;\n    }\n    return modifier;\n  },\n  /**\n   * @method Utility.getSelectValues\n   * @private\n   * @param {Element} select - DOM Element from which to get current values\n   * @returns {string[]}\n   *\n   * Gets a string array of all the selected values in a given `select` DOM element.\n   */\n  getSelectValues: function getSelectValues(select) {\n    var result = [];\n    var options = select && select.options || [];\n    var opt;\n\n    for (var i = 0, ln = options.length; i < ln; i++) {\n      opt = options[i];\n\n      if (opt.selected) {\n        result.push(opt.value || opt.text);\n      }\n    }\n    return result;\n  },\n  /*\n   * Get select options\n   */\n  getSelectOptions: function getSelectOptions(defs, hash) {\n    var schemaType = defs.type;\n    var selectOptions = hash.options;\n\n    // Handle options=\"allowed\"\n    if (selectOptions === 'allowed') {\n      selectOptions = _.map(defs.allowedValues, function(v) {\n        var label = v;\n        if (hash.capitalize && v.length > 0 && schemaType === String) {\n          label = v.charAt(0).toUpperCase() + v.slice(1).toLowerCase();\n        }\n\n        return { label: label, value: v };\n      });\n    }\n\n    // Hashtable\n    else if (_.isObject(selectOptions) && !_.isArray(selectOptions)) {\n      selectOptions = _.map(selectOptions, function(v, k) {\n        return { label: v, value: schemaType(k) };\n      });\n    }\n\n    return selectOptions;\n  },\n  /**\n   * @method Utility.lookup\n   * @private\n   * @param {Any} obj\n   * @returns {Any}\n   *\n   * If `obj` is a string, returns the value of the property with that\n   * name on the `window` object. Otherwise returns `obj`.\n   */\n  lookup: function lookup(obj) {\n    var ref = window, arr;\n    if (typeof obj === 'string') {\n      arr = obj.split('.');\n      while (arr.length && (ref = ref[arr.shift()]));\n      if (!ref) {\n        throw new Error(obj + ' is not in the window scope');\n      }\n      return ref;\n    }\n    return obj;\n  },\n  /**\n   * @method Utility.getFieldDefinition\n   * @private\n   * @param {SimpleSchema} ss\n   * @param {String} name\n   * @return {Object} Schema definitions object\n   *\n   * Returns the schema definitions object from a SimpleSchema instance, grabbing the first\n   * type definition out of potentially multiple.\n   */\n  getFieldDefinition(ss, name) {\n    const def = ss.getDefinition(name);\n    if (!def) return;\n\n    return {\n      ...def,\n      ...(def.type && def.type[0]) || {},\n    };\n  },\n  /**\n   * @method Utility.objAffectsKey\n   * @private\n   * @param  {Object} obj\n   * @param  {String} key\n   * @return {Boolean}\n   * @todo should make this a static method in MongoObject\n   */\n  objAffectsKey: function objAffectsKey(obj, key) {\n    var mDoc = new MongoObject(obj);\n    return mDoc.affectsKey(key);\n  },\n  /**\n   * @method Utility.expandObj\n   * @private\n   * @param  {Object} doc\n   * @return {Object}\n   *\n   * Takes a flat object and returns an expanded version of it.\n   */\n  expandObj: function expandObj(doc) {\n    var newDoc = {}, subkeys, subkey, subkeylen, nextPiece, current;\n    _.each(doc, function(val, key) {\n      subkeys = key.split('.');\n      subkeylen = subkeys.length;\n      current = newDoc;\n      for (var i = 0; i < subkeylen; i++) {\n        subkey = subkeys[i];\n        if (typeof current[subkey] !== 'undefined' && !_.isObject(current[subkey])) {\n          break; // already set for some reason; leave it alone\n        }\n        if (i === subkeylen - 1) {\n          // last iteration; time to set the value\n          current[subkey] = val;\n        } else {\n          // see if the next piece is a number\n          nextPiece = subkeys[i + 1];\n          nextPiece = parseInt(nextPiece, 10);\n          if (isNaN(nextPiece) && !_.isObject(current[subkey])) {\n            current[subkey] = {};\n          } else if (!isNaN(nextPiece) && !_.isArray(current[subkey])) {\n            current[subkey] = [];\n          }\n        }\n        current = current[subkey];\n      }\n    });\n    return newDoc;\n  },\n  /**\n   * @method Utility.compactArrays\n   * @private\n   * @param  {Object} obj\n   * @return {undefined}\n   *\n   * Edits the object by reference, compacting any arrays at any level recursively.\n   */\n  compactArrays: function compactArrays(obj) {\n    if (_.isObject(obj)) {\n      _.each(obj, function (val, key) {\n        if (_.isArray(val)) {\n          obj[key] = _.without(val, void 0, null);\n          _.each(obj[key], function (arrayItem) {\n            compactArrays(arrayItem);\n          });\n        } else if (!(val instanceof Date) && _.isObject(val)) {\n          // recurse into objects\n          compactArrays(val);\n        }\n      });\n    }\n  },\n  /**\n   * @method Utility.bubbleEmpty\n   * @private\n   * @param  {Object} obj\n   * @return {undefined}\n   *\n   * Edits the object by reference.\n   */\n  bubbleEmpty: function bubbleEmpty(obj, keepEmptyStrings) {\n    if (_.isObject(obj)) {\n      _.each(obj, function (val, key) {\n        if (_.isArray(val)) {\n          _.each(val, function (arrayItem) {\n            bubbleEmpty(arrayItem);\n          });\n        } else if (isBasicObject(val)) {\n          var allEmpty = _.all(val, function (prop) {\n            return (prop === void 0 || prop === null || (!keepEmptyStrings && typeof prop === 'string' && prop.length === 0));\n          });\n          if (_.isEmpty(val) || allEmpty) {\n            obj[key] = null;\n          } else {\n            // recurse into objects\n            bubbleEmpty(val);\n          }\n        }\n      });\n    }\n  },\n  /**\n   * @method Utility.isNullUndefinedOrEmptyString\n   * @private\n   * @param  {Any} val\n   * @return {Boolean}\n   *\n   * Returns `true` if the value is null, undefined, or an empty string\n   */\n  isNullUndefinedOrEmptyString: function isNullUndefinedOrEmptyString(val) {\n    return (val === void 0 || val === null || (typeof val === 'string' && val.length === 0));\n  },\n  /**\n   * @method Utility.isValidDateString\n   * @private\n   * @param  {String}  dateString\n   * @return {Boolean}\n   *\n   * Returns `true` if dateString is a \"valid date string\"\n   */\n  isValidDateString: function isValidDateString(dateString) {\n    var m = moment(dateString, 'YYYY-MM-DD', true);\n    return m && m.isValid();\n  },\n  /**\n   * @method Utility.isValidTimeString\n   * @private\n   * @param  {String}  timeString\n   * @return {Boolean}\n   *\n   * Returns `true` if timeString is a \"valid time string\"\n   */\n  isValidTimeString: function isValidTimeString(timeString) {\n    if (typeof timeString !== 'string') {\n      return false;\n    }\n\n    // this reg ex actually allows a few invalid hours/minutes/seconds, but\n    // we can catch that when parsing\n    var regEx = /^[0-2][0-9]:[0-5][0-9](:[0-5][0-9](\\.[0-9]{1,3})?)?$/;\n    return regEx.test(timeString);\n  },\n  /**\n   * @method  Utility.isValidNormalizedForcedUtcGlobalDateAndTimeString\n   * @private\n   * @param  {String} dateString\n   * @return {Boolean}\n   *\n   * Returns true if dateString is a \"valid normalized forced-UTC global date and time string\"\n   */\n  isValidNormalizedForcedUtcGlobalDateAndTimeString: function isValidNormalizedForcedUtcGlobalDateAndTimeString(dateString) {\n    if (typeof dateString !== 'string') {\n      return false;\n    }\n\n    var datePart = dateString.substring(0, 10);\n    var tPart = dateString.substring(10, 11);\n    var timePart = dateString.substring(11, dateString.length - 1);\n    var zPart = dateString.substring(dateString.length - 1);\n    return Utility.isValidDateString(datePart) && tPart === 'T' && Utility.isValidTimeString(timePart) && zPart === 'Z';\n  },\n  /**\n   * @method  Utility.isValidNormalizedLocalDateAndTimeString\n   * @private\n   * @param  {String} dtString\n   * @return {Boolean}\n   *\n   * Returns true if dtString is a \"valid normalized local date and time string\"\n   */\n  isValidNormalizedLocalDateAndTimeString: function isValidNormalizedLocalDateAndTimeString(dtString) {\n    if (typeof dtString !== 'string') {\n      return false;\n    }\n\n    var datePart = dtString.substring(0, 10);\n    var tPart = dtString.substring(10, 11);\n    var timePart = dtString.substring(11, dtString.length);\n    return Utility.isValidDateString(datePart) && tPart === 'T' && Utility.isValidTimeString(timePart);\n  },\n  /**\n   * @method Utility.getComponentContext\n   * @private\n   * @param  {Object} context A context (`this`) object\n   * @param {String} name The name of the helper or component we're calling from.\n   * @return {Object} Normalized context object\n   *\n   * Returns an object with `atts` and `defs` properties, normalized from whatever object is passed in.\n   * This helps deal with the fact that we have to pass the ancestor autoform's context to different\n   * helpers and components in different ways, but in all cases we want to get access to it and throw\n   * an error if we can't find an autoform context.\n   */\n  getComponentContext: function autoFormGetComponentContext(context, name) {\n    var atts, defs = {}, formComponentAttributes, fieldAttributes, fieldAttributesForComponentType, ss;\n\n    atts = _.clone(context || {});\n    ss = AutoForm.getFormSchema();\n\n    defs = Utility.getFieldDefinition(ss, atts.name);\n    if (!defs) return;\n\n    // Look up the tree if we're in a helper, checking to see if any ancestor components\n    // had a <componentType>-attribute specified.\n    formComponentAttributes = AutoForm.findAttributesWithPrefix(name + '-');\n\n    // Get any field-specific attributes defined in the schema.\n    // They can be in autoform.attrName or autoform.componentType.attrName, with\n    // the latter overriding the former.\n    fieldAttributes = _.clone(defs.autoform) || {};\n    fieldAttributesForComponentType = fieldAttributes[name] || {};\n    fieldAttributes = _.omit(fieldAttributes, Utility.componentTypeList);\n    fieldAttributes = _.extend({}, fieldAttributes, fieldAttributesForComponentType);\n\n    // \"autoform\" option in the schema provides default atts\n    atts = _.extend({}, formComponentAttributes, fieldAttributes, atts);\n\n    // eval any attribute that is provided as a function\n    var evaluatedAtts = {};\n    _.each(atts, function (v, k) {\n      if (typeof v === 'function') {\n        evaluatedAtts[k] = v.call({\n          name: atts.name\n        });\n      } else {\n        evaluatedAtts[k] = v;\n      }\n    });\n\n    return {\n      atts: evaluatedAtts,\n      defs: defs\n    };\n  },\n  /**\n   * @method Utility.stringToArray\n   * @private\n   * @param {String|Array} s A variable that might be a string or an array.\n   * @param {String} errorMessage Error message to use if it's not a string or an array.\n   * @return {Array} The array, building it from a comma-delimited string if necessary.\n   */\n  stringToArray: function stringToArray(s, errorMessage) {\n    if (typeof s === 'string') {\n      return s.replace(/ /g, '').split(',');\n    } else if (!_.isArray(s)) {\n      throw new Error(errorMessage);\n    } else {\n      return s;\n    }\n  },\n  /**\n   * @method Utility.addClass\n   * @private\n   * @param {Object} atts An object that might have a \"class\" property\n   * @param {String} klass The class string to add\n   * @return {Object} The object with klass added to the \"class\" property, creating the property if necessary\n   */\n  addClass: function addClass(atts, klass) {\n    if (typeof atts['class'] === 'string') {\n      atts['class'] += ' ' + klass;\n    } else {\n      atts['class'] = klass;\n    }\n    return atts;\n  },\n  /**\n   * @method Utility.getFormTypeDef\n   * @private\n   * @param {String} formType The form type\n   * @return {Object} The definition. Throws an error if type hasn't been defined.\n   */\n  getFormTypeDef: function getFormTypeDef(formType) {\n    var ftd = AutoForm._formTypeDefinitions[formType];\n    if (!ftd) {\n      throw new Error('AutoForm: Form type \"' + formType + '\" has not been defined');\n    }\n    return ftd;\n  },\n  checkTemplate: function checkTemplate(template) {\n    return !!(template &&\n            template.view &&\n            template.view._domrange &&\n            !template.view.isDestroyed);\n  },\n  // This is copied from mongo-object to avoid a direct dep on that package\n  makeKeyGeneric(key) {\n    if (typeof key !== 'string') return null;\n    return key.replace(/\\.[0-9]+(?=\\.|$)/g, '.$');\n  },\n};\n\n// getPrototypeOf polyfill\nif (typeof Object.getPrototypeOf !== 'function') {\n  if (typeof ''.__proto__ === 'object') {\n    Object.getPrototypeOf = function(object) {\n      return object.__proto__;\n    };\n  } else {\n    Object.getPrototypeOf = function(object) {\n      // May break if the constructor has been tampered with\n      return object.constructor.prototype;\n    };\n  }\n}\n\n/* Tests whether \"obj\" is an Object as opposed to\n * something that inherits from Object\n *\n * @param {any} obj\n * @returns {Boolean}\n */\nvar isBasicObject = function(obj) {\n  return _.isObject(obj) && Object.getPrototypeOf(obj) === Object.prototype;\n};\n","/**\n * @constructor\n * @private\n * @param {String} migrationName\n *\n * Internal helper object to preserve form inputs across Hot Code Push\n * and across \"pages\" navigation if the option is enabled.\n */\nFormPreserve = function formPreserveConstructor(migrationName) {\n  var self = this;\n  if (! _.isString(migrationName))\n    throw Error('You must define an unique migration name of type String');\n  self.registeredForms = {};\n  self.retrievedDocuments = {};\n  if (Package.reload) {\n    var Reload = Package.reload.Reload;\n    self.retrievedDocuments = Reload._migrationData(migrationName) || '{}';\n\n    // Currently migration does not seem to support proper storage\n    // of Date type. It comes back as a string, so we need to store\n    // EJSON instead.\n    if (typeof self.retrievedDocuments === 'string') {\n      self.retrievedDocuments = EJSON.parse(self.retrievedDocuments);\n    }\n\n    Reload._onMigrate(migrationName, function () {\n      var doc = self._retrieveRegisteredDocuments();\n      return [true, EJSON.stringify(doc)];\n    });\n  }\n};\n\nFormPreserve.prototype.getDocument = function (formId) {\n  var self = this, doc;\n  if (! _.has(self.retrievedDocuments, formId)) {\n    return false;\n  }\n\n  return self.retrievedDocuments[formId];\n};\n\nFormPreserve.prototype.clearDocument = function (formId) {\n  delete this.retrievedDocuments[formId];\n};\n\nFormPreserve.prototype.registerForm = function (formId, retrieveFunc) {\n  this.registeredForms[formId] = retrieveFunc;\n};\n\nFormPreserve.prototype.formIsRegistered = function (formId) {\n  return !!this.registeredForms[formId];\n};\n\nFormPreserve.prototype.unregisterForm = function (formId) {\n  delete this.registeredForms[formId];\n  delete this.retrievedDocuments[formId];\n};\n\nFormPreserve.prototype.unregisterAllForms = function () {\n  var self = this;\n  self.registeredForms = {};\n  self.retrievedDocuments = {};\n};\n\nFormPreserve.prototype._retrieveRegisteredDocuments = function () {\n  var self = this;\n  res = {};\n  _.each(self.registeredForms, function (retrieveFunc, formId) {\n    res[formId] = retrieveFunc();\n  });\n  return res;\n};\n","// Manages all hooks, supporting append/replace, get\n\nHooks = {\n  form: {}\n};\n\n// The names of all supported hooks, excluding \"before\" and \"after\".\nvar hookNames = ['formToDoc', 'formToModifier', 'docToForm', 'onSubmit', 'onSuccess', 'onError',\n    'beginSubmit', 'endSubmit'];\n\nHooks.getDefault = function() {\n  var hooks = {\n    before: {},\n    after: {}\n  };\n  _.each(hookNames, function(hookName) {\n    hooks[hookName] = [];\n  });\n  return hooks;\n};\n\nHooks.global = Hooks.getDefault();\n\nHooks.addHooksToList = function addHooksToList(hooksList, hooks, replace) {\n  // Add before hooks\n  hooks.before && _.each(hooks.before, function autoFormBeforeHooksEach(func, type) {\n    if (typeof func !== 'function') {\n      throw new Error('AutoForm before hook must be a function, not ' + typeof func);\n    }\n    hooksList.before[type] = (!replace && hooksList.before[type]) ? hooksList.before[type] : [];\n    hooksList.before[type].push(func);\n  });\n\n  // Add after hooks\n  hooks.after && _.each(hooks.after, function autoFormAfterHooksEach(func, type) {\n    if (typeof func !== 'function') {\n      throw new Error('AutoForm after hook must be a function, not ' + typeof func);\n    }\n    hooksList.after[type] = (!replace && hooksList.after[type]) ? hooksList.after[type] : [];\n    hooksList.after[type].push(func);\n  });\n\n  // Add all other hooks\n  _.each(hookNames, function autoFormHooksEach(name) {\n    if (hooks[name]) {\n      if (typeof hooks[name] !== 'function') {\n        throw new Error('AutoForm ' + name + ' hook must be a function, not ' + typeof hooks[name]);\n      }\n\n      if (replace) {\n        hooksList[name] = [];\n      }\n\n      hooksList[name].push(hooks[name]);\n    }\n  });\n};\n\nHooks.getHooks = function getHooks(formId, type, subtype) {\n  var f, g;\n  if (subtype) {\n    f = Hooks.form[formId] && Hooks.form[formId][type] && Hooks.form[formId][type][subtype] || [];\n    g = Hooks.global[type] && Hooks.global[type][subtype] || [];\n  } else {\n    f = Hooks.form[formId] && Hooks.form[formId][type] || [];\n    g = Hooks.global[type] || [];\n  }\n  return f.concat(g);\n};\n","/* global FormData:true */\n\n/*\n * Tracks form data with reactivity. This is similar to\n * ReactiveDict, but we need to store typed objects and\n * keep their type upon retrieval.\n */\n\nFormData = function () {\n  var self = this;\n  self.forms = {};\n};\n\n/**\n * Initializes tracking for a given form, if not already done.\n * @param {String} formId The form's `id` attribute\n */\nFormData.prototype.initForm = function (formId) {\n  var self = this;\n\n  if (self.forms[formId]) {\n    return;\n  }\n\n  self.forms[formId] = {\n    sourceDoc: null,\n    deps: {\n      sourceDoc: new Tracker.Dependency()\n    }\n  };\n};\n\n/**\n * Initializes tracking for a given form, if not already done.\n * @param {String} formId The form's `id` attribute\n */\n\n/**\n * Gets or sets a source doc for the given form. Reactive.\n * @param   {String}                formId    The form's `id` attribute\n * @param   {MongoObject|null}      sourceDoc The mDoc for the form or `null` if no doc.\n * @returns {MongoObject|undefined} Returns the form's MongoObject if getting.\n */\nFormData.prototype.sourceDoc = function (formId, sourceDoc) {\n  var self = this;\n  self.initForm(formId);\n\n  if (sourceDoc || sourceDoc === null) {\n    // setter\n    self.forms[formId].sourceDoc = sourceDoc;\n    self.forms[formId].deps.sourceDoc.changed();\n  } else {\n    // getter\n    self.forms[formId].deps.sourceDoc.depend();\n    return self.forms[formId].sourceDoc;\n  }\n};\n","// Track arrays; this allows us to add/remove fields or groups of fields for an array\n// but still easily respect minCount and maxCount, and properly add/remove the same\n// items from the database once the form is submitted.\n\nArrayTracker = function afArrayTracker() {\n  var self = this;\n  self.info = {};\n};\n\nArrayTracker.prototype.getMinMax = function atGetMinMax(ss, field, overrideMinCount, overrideMaxCount) {\n  var defs = AutoForm.Utility.getFieldDefinition(ss, field);\n\n  // minCount is set by the schema, but can be set higher on the field attribute\n  overrideMinCount = overrideMinCount || 0;\n  var minCount = defs.minCount || 0;\n  minCount = Math.max(overrideMinCount, minCount);\n\n  // maxCount is set by the schema, but can be set lower on the field attribute\n  overrideMaxCount = overrideMaxCount || Infinity;\n  var maxCount = defs.maxCount || Infinity;\n  maxCount = Math.min(overrideMaxCount, maxCount);\n\n  return { minCount: minCount, maxCount: maxCount };\n};\n\nArrayTracker.prototype.initForm = function atInitForm(formId) {\n  var self = this;\n\n  if (self.info[formId]) return;\n\n  self.info[formId] = {};\n};\n\nArrayTracker.prototype.getForm = function atInitForm(formId) {\n  var self = this;\n  self.initForm(formId);\n  return self.info[formId];\n};\n\nArrayTracker.prototype.ensureField = function atEnsureField(formId, field) {\n  var self = this;\n  self.initForm(formId);\n\n  if (!self.info[formId][field]) self.resetField(formId, field);\n};\n\nArrayTracker.prototype.initField = function atInitField(formId, field, ss, docCount, overrideMinCount, overrideMaxCount) {\n  var self = this;\n  self.ensureField(formId, field);\n\n  if (self.info[formId][field].array != null) return;\n\n// If we have a doc: The count should be the maximum of docCount or schema minCount or field minCount or 1.\n// If we don't have a doc: The count should be the maximum of schema minCount or field minCount or 1.\n  var range = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount);\n  var arrayCount = Math.max(range.minCount, (docCount == null) ? 1 : docCount);\n\n// If this is an array of objects, collect names of object props\n  var childKeys = [];\n  if (AutoForm.Utility.getFieldDefinition(ss, field + '.$').type === Object) {\n    childKeys = ss.objectKeys(AutoForm.Utility.makeKeyGeneric(field) + '.$');\n\t}\n\n  var loopArray = [];\n  for (var i = 0; i < arrayCount; i++) {\n    var loopCtx = createLoopCtx(formId, field, i, childKeys, overrideMinCount, overrideMaxCount);\n    loopArray.push(loopCtx);\n  }\n\n  self.info[formId][field].array = loopArray;\n  var count = loopArray.length;\n  self.info[formId][field].count = count;\n  self.info[formId][field].visibleCount = count;\n  self.info[formId][field].deps.changed();\n};\n\nArrayTracker.prototype.resetField = function atResetField(formId, field) {\n  var self = this;\n  self.initForm(formId);\n\n  if (!self.info[formId][field]) {\n    self.info[formId][field] = {\n      deps: new Tracker.Dependency()\n\t\t};\n\t}\n\n  self.info[formId][field].array = null;\n  self.info[formId][field].count = 0;\n  self.info[formId][field].visibleCount = 0;\n  self.info[formId][field].deps.changed();\n};\n\nArrayTracker.prototype.resetForm = function atResetForm(formId) {\n  var self = this;\n  _.each(self.info[formId], function (info, field) {\n    self.resetField(formId, field);\n\t});\n};\n\nArrayTracker.prototype.untrackForm = function atUntrackForm(formId) {\n  var self = this;\n  self.info[formId] = {};\n};\n\nArrayTracker.prototype.tracksField = function atTracksField(formId, field) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  return !!self.info[formId][field].array;\n};\n\nArrayTracker.prototype.getField = function atGetField(formId, field) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  return self.info[formId][field].array;\n};\n\nArrayTracker.prototype.getCount = function atGetCount(formId, field) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  return self.info[formId][field].count;\n};\n\nArrayTracker.prototype.getVisibleCount = function atGetVisibleCount(formId, field) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  return self.info[formId][field].visibleCount;\n};\n\nArrayTracker.prototype.isFirstFieldlVisible = function atIsFirstFieldlVisible(formId, field, currentIndex) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  var firstVisibleField = _.find(self.info[formId][field].array, function(currentField) {\n    return !currentField.removed;\n\t});\n\treturn (firstVisibleField && firstVisibleField.index === currentIndex);\n};\n\nArrayTracker.prototype.isLastFieldlVisible = function atIsLastFieldlVisible(formId, field, currentIndex) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  var lastVisibleField = _.last(_.filter(self.info[formId][field].array, function(currentField) {\n    return !currentField.removed;\n\t}));\n  return (lastVisibleField && lastVisibleField.index === currentIndex);\n};\n\nArrayTracker.prototype.addOneToField = function atAddOneToField(formId, field, ss, overrideMinCount, overrideMaxCount) {\n  var self = this;\n  self.ensureField(formId, field);\n\n  if (!self.info[formId][field].array) return;\n\n  var currentCount = self.info[formId][field].visibleCount;\n  var maxCount = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount).maxCount;\n\n  if (currentCount < maxCount) {\n    var i = self.info[formId][field].array.length;\n\n    // If this is an array of objects, collect names of object props\n    var childKeys = [];\n    if (AutoForm.Utility.getFieldDefinition(ss, field + '.$').type === Object) {\n      childKeys = ss.objectKeys(AutoForm.Utility.makeKeyGeneric(field) + '.$');\n\t  }\n\n    var loopCtx = createLoopCtx(formId, field, i, childKeys, overrideMinCount, overrideMaxCount);\n\n    self.info[formId][field].array.push(loopCtx);\n    self.info[formId][field].count++;\n    self.info[formId][field].visibleCount++;\n    self.info[formId][field].deps.changed();\n  }\n};\n\nArrayTracker.prototype.removeFromFieldAtIndex = function atRemoveFromFieldAtIndex(formId, field, index, ss, overrideMinCount, overrideMaxCount) {\n  var self = this;\n  self.ensureField(formId, field);\n\n  if (!self.info[formId][field].array) return;\n\n  var currentCount = self.info[formId][field].visibleCount;\n  var minCount = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount).minCount;\n\n  if (currentCount > minCount) {\n    self.info[formId][field].array[index].removed = true;\n    self.info[formId][field].count--;\n    self.info[formId][field].visibleCount--;\n    self.info[formId][field].deps.changed();\n  }\n};\n\n/*\n * PRIVATE\n */\nvar createLoopCtx = function(formId, field, index, childKeys, overrideMinCount, overrideMaxCount) {\n  var loopCtx = {\n    formId:         formId,\n    arrayFieldName: field,\n    name:           field + '.' + index,\n    index:          index,\n    minCount:       overrideMinCount,\n    maxCount:       overrideMaxCount\n  };\n\n  // If this is an array of objects, add child key names under loopCtx.current[childName] = fullKeyName\n  if (childKeys.length) {\n    loopCtx.current = {};\n    _.each(childKeys, function (k) {\n      loopCtx.current[k] = field + '.' + index + '.' + k;\n    });\n  }\n\n  return loopCtx;\n};\n","/* global AutoForm:true, FormPreserve */\n\nAutoForm = AutoForm || {};\n\n// formPreserve is used to keep current form data across hot code\n// reloads for any forms that are currently rendered\nAutoForm.formPreserve = new FormPreserve('autoforms');\n\nAutoForm.reactiveFormData = new FormData();\n\nAutoForm._inputTypeDefinitions = {}; // for storing input type definitions added by AutoForm.addInputType\nAutoForm._formTypeDefinitions = {}; // for storing submit type definitions added by AutoForm.addFormType\n\narrayTracker = new ArrayTracker();\n\n// Used by AutoForm._forceResetFormValues; temporary hack\nAutoForm._destroyForm = {};\n\n// reactive templates\nglobalDefaultTemplate = 'bootstrap3';\ndefaultTypeTemplates = {};\ndeps = {\n  defaultTemplate: new Tracker.Dependency(),\n  defaultTypeTemplates: {}\n};\n","/* global arrayTracker, AutoForm */\n\nfunction parseOptions(options) {\n  var hash = (options || {}).hash || {};\n  // Find the form's schema\n  var ss = AutoForm.getFormSchema();\n  return _.extend({}, hash, { ss: ss });\n}\n\n/*\n * Global template helpers (exported to app)\n */\n\n/*\n * afFieldMessage\n */\nTemplate.registerHelper('afFieldMessage', function autoFormFieldMessage(options) {\n  options = parseOptions(options, 'afFieldMessage');\n  var formId = AutoForm.getFormId();\n\n  return options.ss.namedContext(formId).keyErrorMessage(options.name);\n});\n\n/*\n * afFieldIsInvalid\n */\nTemplate.registerHelper('afFieldIsInvalid', function autoFormFieldIsInvalid(options) {\n  options = parseOptions(options, 'afFieldIsInvalid');\n  var formId = AutoForm.getFormId();\n\n  return options.ss.namedContext(formId).keyIsInvalid(options.name);\n});\n\n/*\n * afArrayFieldHasMoreThanMinimum\n */\nTemplate.registerHelper('afArrayFieldHasMoreThanMinimum', function autoFormArrayFieldHasMoreThanMinimum(options) {\n  options = parseOptions(options, 'afArrayFieldHasMoreThanMinimum');\n  var form = AutoForm.getCurrentDataPlusExtrasForForm();\n\n  // Registered form types can disable adding/removing array items\n  if (form.formTypeDef.hideArrayItemButtons) {\n    return false;\n  }\n\n  var range = arrayTracker.getMinMax(options.ss, options.name, options.minCount, options.maxCount);\n  var visibleCount = arrayTracker.getVisibleCount(form.id, options.name);\n  return (visibleCount > range.minCount);\n});\n\n/*\n * afArrayFieldHasLessThanMaximum\n */\nTemplate.registerHelper('afArrayFieldHasLessThanMaximum', function autoFormArrayFieldHasLessThanMaximum(options) {\n  options = parseOptions(options, 'afArrayFieldHasLessThanMaximum');\n  var form = AutoForm.getCurrentDataPlusExtrasForForm();\n\n  // Registered form types can disable adding/removing array items\n  if (form.formTypeDef.hideArrayItemButtons) {\n    return false;\n  }\n\n  var range = arrayTracker.getMinMax(options.ss, options.name, options.minCount, options.maxCount);\n  var visibleCount = arrayTracker.getVisibleCount(form.id, options.name);\n  return (visibleCount < range.maxCount);\n});\n\n/*\n * afFieldValueIs\n */\nTemplate.registerHelper('afFieldValueIs', function autoFormFieldValueIs(options) {\n  options = parseOptions(options, 'afFieldValueIs');\n\n  var currentValue = AutoForm.getFieldValue(options.name, options.formId);\n  return currentValue === options.value;\n});\n\n/*\n * afFieldValue\n */\nTemplate.registerHelper('afFieldValue', function autoFormFieldValue(options) {\n  options = parseOptions(options, 'afFieldValue');\n\n  return AutoForm.getFieldValue(options.name, options.formId || AutoForm.getFormId());\n});\n\n/*\n * afArrayFieldIsFirstVisible\n */\nTemplate.registerHelper('afArrayFieldIsFirstVisible', function autoFormArrayFieldIsFirstVisible() {\n  var context = this;\n  return arrayTracker.isFirstFieldlVisible(context.formId, context.arrayFieldName, context.index);\n});\n\n/*\n * afArrayFieldIsLastVisible\n */\nTemplate.registerHelper('afArrayFieldIsLastVisible', function autoFormArrayFieldIsLastVisible() {\n  var context = this;\n  return arrayTracker.isLastFieldlVisible(context.formId, context.arrayFieldName, context.index);\n});\n\n/*\n * afFieldValueContains\n */\nTemplate.registerHelper('afFieldValueContains', function autoFormFieldValueContains(options) {\n  options = parseOptions(options, 'afFieldValueContains');\n\n  var currentValue = AutoForm.getFieldValue(options.name, options.formId);\n  return _.isArray(currentValue) && (_.contains(currentValue, options.value) || options.values && _.intersection(currentValue, options.values.split(',')));\n});\n\n/*\n * afFieldLabelText\n */\nTemplate.registerHelper('afFieldLabelText', function autoFormFieldLabelText(options) {\n  options = parseOptions(options, 'afFieldLabelText');\n  return AutoForm.getLabelForField(options.name);\n});\n\n/*\n * afFieldNames\n */\nTemplate.registerHelper('afFieldNames', function autoFormFieldNames(options) {\n  options = parseOptions(options, 'afFieldNames');\n  var ss = options.ss, name = options.name, namePlusDot, genericName, genericNamePlusDot;\n  var form = AutoForm.getCurrentDataForForm();\n\n  if (name) {\n    namePlusDot = name + '.';\n    genericName = AutoForm.Utility.makeKeyGeneric(name);\n    genericNamePlusDot = genericName + '.';\n  }\n\n  // Get the list of fields we want included\n  var fieldList = options.fields, usedAncestorFieldList = false;\n  if (fieldList) {\n    fieldList = AutoForm.Utility.stringToArray(fieldList, 'AutoForm: fields attribute must be an array or a string containing a comma-delimited list of fields');\n  }\n\n  var ancestorFieldList = AutoForm.findAttribute('fields');\n  if (ancestorFieldList) {\n    ancestorFieldList = AutoForm.Utility.stringToArray(ancestorFieldList, 'AutoForm: fields attribute must be an array or a string containing a comma-delimited list of fields');\n\n    // Use the ancestor field list as backup, unless there is\n    // a name and that name is listed in the ancestor field list\n    if (!fieldList) {\n      fieldList = ancestorFieldList;\n      usedAncestorFieldList = true;\n    }\n  }\n\n  if (fieldList) {\n\n    // Take only those fields in the fieldList that are descendants of the `name` field\n    if (name) {\n      // Replace generic name with real name. We assume that field names\n      // with $ apply to all array items. Field list will now have the\n      // correct array field item number instead of $.\n      if (genericName !== name) {\n        fieldList = _.map(fieldList, function (field) {\n          if (field.indexOf(genericNamePlusDot) === 0) {\n            return namePlusDot + field.slice(genericNamePlusDot.length);\n          }\n          return field;\n        });\n      }\n\n      fieldList = _.filter(fieldList, function filterFieldsByName(field) {\n        return field.indexOf(namePlusDot) === 0;\n      });\n    }\n\n    // If top level fields, be sure to remove any with $ in them\n    else {\n      fieldList = _.filter(fieldList, function filterArrayFields(field) {\n        return (field.slice(-2) !== '.$' && field.indexOf('.$.') === -1);\n      });\n    }\n\n    // First we filter out any fields that are subobjects where the\n    // parent object is also in the fieldList and is NOT the current\n    // field name.\n    // This means that if you do `fields=\"address,address.city\"` we\n    // will use an afObjectField for address and include only the\n    // \"city\" field within that, but if you instead do `fields=\"address.city\"`\n    // we will use a single field for the city, with no afObjectField\n    // template around it.\n    fieldList = _.reject(fieldList, function (field) {\n      var lastDotPos = field.lastIndexOf('.');\n      if (lastDotPos === -1) {\n        return false; // keep\n      }\n\n      var parentField = field.slice(0, lastDotPos);\n      if (parentField.slice(-2) === '.$') {\n        parentField = parentField.slice(0, -2);\n      }\n      return _.contains(fieldList, parentField) && parentField !== name && parentField !== genericName;\n    });\n  }\n\n  if (!fieldList || (fieldList.length === 0 && usedAncestorFieldList)) {\n    // Get list of field names that are descendants of this field's name.\n    // If name/genericName is undefined, this will return top-level\n    // schema keys.\n    fieldList = ss.objectKeys(genericName);\n\n    if (name) {\n      // Tack child field name on to end of parent field name. This\n      // ensures that we keep the desired array index for array items.\n      fieldList = _.map(fieldList, function (field) {\n        return name + '.' + field;\n      });\n    }\n  }\n\n  // If user wants to omit some fields, remove those from the array\n  var omitFields = options.omitFields || AutoForm.findAttribute('omitFields');\n  if (omitFields) {\n    omitFields = AutoForm.Utility.stringToArray(omitFields, 'AutoForm: omitFields attribute must be an array or a string containing a comma-delimited list of fields');\n    fieldList = _.difference(fieldList, omitFields);\n    // If omitFields contains generic field names (with $) we omit those too\n    fieldList = _.reject(fieldList, function (f) {\n      return _.contains(omitFields, AutoForm.Utility.makeKeyGeneric(f));\n    });\n  }\n\n  // Filter out fields we never want\n  fieldList = _.filter(fieldList, function shouldIncludeField(field) {\n    var fieldDefs = AutoForm.Utility.getFieldDefinition(ss, field);\n\n    // Don't include fields that are not in the schema\n    if (!fieldDefs) {\n      return false;\n    }\n\n    // Don't include fields with autoform.omit=true\n    if (fieldDefs.autoform && fieldDefs.autoform.omit === true) {\n      return false;\n    }\n\n    // Don't include fields with denyInsert=true when it's an insert form\n    if (fieldDefs.denyInsert && form.type === 'insert') {\n      return false;\n    }\n\n    // Don't include fields with denyUpdate=true when it's an update form\n    if (fieldDefs.denyUpdate && form.type === 'update') {\n      return false;\n    }\n\n    return true;\n  });\n\n  // Ensure fields are not added more than once\n  fieldList = _.unique(fieldList);\n\n  // We return it as an array of objects because that\n  // works better with Blaze contexts\n  fieldList = _.map(fieldList, function (name) {\n    return { name: name };\n  });\n\n  return fieldList;\n});\n\n\n/*\n * afSelectOptionAtts\n */\nTemplate.registerHelper('afSelectOptionAtts', function afSelectOptionAtts() {\n  var atts = _.pick(this, 'value');\n  if (this.selected) {\n    atts.selected = '';\n  }\n  if (this.htmlAtts) {\n    _.extend(atts, this.htmlAtts);\n  }\n  return atts;\n});\n\n// Expects to be called with this.name available\nTemplate.registerHelper('afOptionsFromSchema', function afOptionsFromSchema() {\n  return AutoForm._getOptionsForField(this.name);\n});\n","/* global AutoForm, validateField:true */\n\nfunction _validateField(key, formId, skipEmpty, onlyIfAlreadyInvalid) {\n  var docToValidate;\n\n  // Due to throttling, this can be called after the autoForm template is destroyed.\n  // If that happens, we exit without error.\n  var template = AutoForm.templateInstanceForForm(formId);\n\n  // If form is not currently rendered, return true\n  if (!Utility.checkTemplate(template)) return true;\n\n  var form = AutoForm.getCurrentDataForForm(formId);\n  var ss = AutoForm.getFormSchema(formId, form);\n\n  if (!ss) return true;\n\n  // Skip validation if onlyIfAlreadyInvalid is true and the form is\n  // currently valid.\n  if (onlyIfAlreadyInvalid && ss.namedContext(formId).isValid()) {\n    return true; // skip validation\n  }\n\n  // Create a document based on all the values of all the inputs on the form\n  // Get the form type definition\n  var ftd = Utility.getFormTypeDef(form.type);\n\n  // Clean and validate doc\n  docToValidate = AutoForm.getFormValues(formId, template, ss, !!ftd.usesModifier);\n\n  // If form is not currently rendered, return true\n  if (!docToValidate) {\n    return true;\n  }\n\n  // Skip validation if skipEmpty is true and the field we're validating\n  // has no value.\n  if (skipEmpty && !AutoForm.Utility.objAffectsKey(docToValidate, key)) {\n    return true; // skip validation\n  }\n\n  return AutoForm._validateFormDoc(docToValidate, !!ftd.usesModifier, formId, ss, form, key);\n}\n\n// Throttle field validation to occur at most every 300ms,\n// with leading and trailing calls.\nvalidateField = _.throttle(_validateField, 300);\n","/* global AutoForm, getInputValue:true, getAllFieldsInForm:true, getInputData:true, updateTrackedFieldValue:true, updateAllTrackedFieldValues:true, getFlatDocOfFieldValues:true */\n\ngetFlatDocOfFieldValues = function getFlatDocOfFieldValues(fields, ss) {\n  var doc = {};\n  fields.each(function () {\n    var fieldName, val = AutoForm.getInputValue(this, ss);\n    if (val !== void 0) {\n      // Get the field/schema key name\n      fieldName = $(this).attr('data-schema-key');\n      doc[fieldName] = val;\n    }\n  });\n  return doc;\n};\n\n/*\n * package scope functions\n */\n\n/*\n * Gets the value that should be shown/selected in the input. Returns\n * a string, a boolean, or an array of strings. The value used,\n * in order of preference, is one of:\n * * The `value` attribute provided\n * * The value that is set in the `doc` provided on the containing autoForm\n * * The `defaultValue` from the schema\n */\ngetInputValue = function getInputValue(atts, value, mDoc, schemaDefaultValue, fieldDefaultValue, typeDefs) {\n\n  if (typeof value === 'undefined') {\n    // Get the value for this key in the current document\n    if (mDoc) {\n      var valueInfo = mDoc.getInfoForKey(atts.name);\n      if (valueInfo) {\n        value = valueInfo.value;\n      } else {\n        value = fieldDefaultValue;\n      }\n    }\n\n    // Only if there is no current document, use the schema defaultValue\n    else {\n      // Use the field default value if provided\n      if (typeof fieldDefaultValue !== 'undefined') {\n        value = fieldDefaultValue;\n      }\n      // Or use the defaultValue in the schema\n      else {\n        value = schemaDefaultValue;\n      }\n    }\n  }\n\n  // Change null or undefined to an empty string\n  value = (value === null || value === void 0) ? '' : value;\n\n  // If the component expects the value to be an array, and it's not, make it one\n  if (typeDefs.valueIsArray && !_.isArray(value)) {\n    if (typeof value === 'string') {\n      value = value.split(',');\n    } else {\n      value = [value];\n    }\n  }\n\n  // At this point we have a value or an array of values.\n  // Run through the components valueIn function if we have one.\n  // It should then be in whatever format the component expects.\n  if (typeof typeDefs.valueIn === 'function') {\n    value = typeDefs.valueIn(value, atts);\n  }\n\n  return value;\n};\n\n/*\n * Builds the data context that the input component will have.\n */\ngetInputData = function getInputData(defs, hash, value, label, formType) {\n\n  /*\n   * Get HTML attributes\n   */\n\n  // We don't want to alter the original hash, so we clone it and\n  // remove some stuff that should not be HTML attributes.\n  var inputAtts = _.omit(hash,\n    'type',\n    'value',\n    'noselect',\n    'options',\n    'template',\n    'defaultValue',\n    'data');\n\n  // Add required if required\n  if (typeof inputAtts.required === 'undefined' && !defs.optional) {\n    inputAtts.required = '';\n  }\n\n   // Add data-schema-key to every type of element\n  inputAtts['data-schema-key'] = inputAtts.name;\n\n  // Set placeholder to label from schema if requested.\n  // We check hash.placeholder instead of inputAtts.placeholder because\n  // we're setting inputAtts.placeholder, so it wouldn't be the same on\n  // subsequent reactive runs of this function.\n  if (hash.placeholder === 'schemaLabel') {\n    inputAtts.placeholder = label;\n  }\n\n  // To enable reactively toggling boolean attributes\n  // in a simple way, we add the attributes to the HTML\n  // only if their value is `true`. That is, unlike in\n  // HTML, their mere presence does not matter.\n  _.each(['disabled', 'readonly', 'checked', 'required', 'autofocus'], function (booleanProp) {\n    if (!_.has(hash, booleanProp)) {\n      return;\n    }\n\n    // For historical reasons, we treat the string \"true\" and an empty string as `true`, too.\n    // But an empty string value results in the cleanest rendered output for boolean props,\n    // so we standardize as that.\n    if (hash[booleanProp] === true || hash[booleanProp] === 'true' || hash[booleanProp] === '') {\n      inputAtts[booleanProp] = '';\n    } else {\n      // If the value is anything else, we don't render it\n      delete inputAtts[booleanProp];\n    }\n  });\n\n  /*\n   * Set up the context. This is the object that becomes `this` in the\n   * input type template.\n   */\n\n  var inputTypeContext = {\n    name: inputAtts.name,\n    schemaType: defs.type,\n    min: defs.min,\n    max: defs.max,\n    value: value,\n    atts: inputAtts,\n    selectOptions: AutoForm.Utility.getSelectOptions(defs, hash)\n  };\n\n  /*\n   * Merge data property from the field schema with the context.\n   * We do not want these turned into HTML attributes.\n   */\n  if (hash.data) _.extend(inputTypeContext, hash.data);\n\n  // Before returning the context, we allow the registered form type to\n  // adjust it if necessary.\n  var ftd = Utility.getFormTypeDef(formType);\n  if (typeof ftd.adjustInputContext === 'function') {\n    inputTypeContext = ftd.adjustInputContext(inputTypeContext);\n  }\n\n  return inputTypeContext;\n};\n\nfunction markChanged(template, fieldName) {\n  // We always want to be sure to wait for DOM updates to\n  // finish before we indicate that values have changed.\n  // Using a value of 0 here did not work, but 100 seems to\n  // work in testing. We'll need to keep an eye on this.\n  // Not an ideal solution.\n  setTimeout(function () {\n    // Template or view may have disappeared while\n    // we waited to run this\n    if (template &&\n        template.view &&\n        template.view._domrange &&\n        !template.view.isDestroyed &&\n        template.formValues[fieldName]) {\n\n      template.formValues[fieldName].changed();\n      template.formValues[fieldName].requestInProgress = false;\n\n    }\n  }, 100);\n}\n\nupdateTrackedFieldValue = function updateTrackedFieldValue(template, fieldName) {\n  if (!template) return;\n\n  template.formValues = template.formValues || {};\n  if (!template.formValues[fieldName]) {\n    template.formValues[fieldName] = new Tracker.Dependency();\n  }\n  // In case we call updateTrackedFieldValue from multiple places at once,\n  // call .changed() only once\n  if (template.formValues[fieldName].requestInProgress) {\n    return;\n  }\n  template.formValues[fieldName].requestInProgress = true;\n\n  markChanged(template, fieldName);\n\n  // To properly handle array fields, we'll mark the ancestors as changed, too\n  // XXX Might be a more elegant way to handle this\n  var dotPos = fieldName.lastIndexOf('.');\n  while (dotPos !== -1) {\n    fieldName = fieldName.slice(0, dotPos);\n\n    if (!template.formValues[fieldName]) {\n      template.formValues[fieldName] = new Tracker.Dependency();\n    }\n\n    markChanged(template, fieldName);\n\n    dotPos = fieldName.lastIndexOf('.');\n  }\n};\n\nupdateAllTrackedFieldValues = function updateAllTrackedFieldValues(template) {\n  if (template && template.formValues) {\n    _.each(template.formValues, function (o, fieldName) {\n      updateTrackedFieldValue(template, fieldName);\n    });\n  }\n};\n\ngetAllFieldsInForm = function getAllFieldsInForm(template) {\n  // Get all elements with `data-schema-key` attribute, unless disabled\n  return template.$('[data-schema-key]').not('[disabled]');\n  // Exclude fields in sub-forms, since they will belong to a different AutoForm and schema.\n  // TODO need some selector/filter that actually works correctly for excluding subforms\n  // return template.$('[data-schema-key]').not(\"[disabled]\").not(template.$('form form [data-schema-key]'));\n};\n","import MongoObject from 'mongo-object';\n\n/* global AutoForm:true, Utility, Hooks, deps, globalDefaultTemplate:true, defaultTypeTemplates:true, validateField, arrayTracker, ReactiveVar, getAllFieldsInForm, setDefaults:true, getFlatDocOfFieldValues */\n\n// This file defines the public, exported API\n\nAutoForm = AutoForm || {}; // exported\n\n/**\n * @property AutoForm.Utility\n * @public\n */\nAutoForm.Utility = Utility;\n\n/**\n * @method AutoForm.addHooks\n * @public\n * @param {String[]|String|null} formIds Form `id` or array of form IDs to which these hooks apply. Specify `null` to add hooks that will run for every form.\n * @param {Object} hooks Hooks to add, where supported names are \"before\", \"after\", \"formToDoc\", \"docToForm\", \"onSubmit\", \"onSuccess\", and \"onError\".\n * @returns {undefined}\n *\n * Defines hooks to be used by one or more forms. Extends hooks lists if called multiple times for the same\n * form.\n */\nAutoForm.addHooks = function autoFormAddHooks(formIds, hooks, replace) {\n  if (typeof formIds === 'string') {\n    formIds = [formIds];\n  }\n\n  // If formIds is null, add global hooks\n  if (!formIds) {\n    Hooks.addHooksToList(Hooks.global, hooks, replace);\n  } else {\n    _.each(formIds, function (formId) {\n\n      // Init the hooks object if not done yet\n      Hooks.form[formId] = Hooks.form[formId] || Hooks.getDefault();\n\n      Hooks.addHooksToList(Hooks.form[formId], hooks, replace);\n    });\n  }\n};\n\n/**\n * @method AutoForm.hooks\n * @public\n * @param {Object} hooks\n * @returns {undefined}\n *\n * Defines hooks by form id. Extends hooks lists if called multiple times for the same\n * form.\n */\nAutoForm.hooks = function autoFormHooks(hooks, replace) {\n  _.each(hooks, function(hooksObj, formId) {\n    AutoForm.addHooks(formId, hooksObj, replace);\n  });\n};\n\n/**\n * @property AutoForm._hooks\n * @public\n *\n * Hooks list to aid automated testing\n */\nAutoForm._hooks = Hooks.form;\n\n/**\n * @property AutoForm._globalHooks\n * @public\n *\n * Global hooks list to aid automated testing\n */\nAutoForm._globalHooks = Hooks.global;\n\n/**\n * @method AutoForm._forceResetFormValues\n * @public\n * @param {String} formId\n * @returns {undefined}\n *\n * Forces an AutoForm's values to properly update.\n * See https://github.com/meteor/meteor/issues/2431\n */\nAutoForm._forceResetFormValues = function autoFormForceResetFormValues(formId) {\n  AutoForm._destroyForm[formId] = AutoForm._destroyForm[formId] || new ReactiveVar(false);\n\n  AutoForm._destroyForm[formId].set(true);\n  setTimeout(function () {\n    AutoForm._destroyForm[formId].set(false);\n  }, 0);\n};\n\n/**\n * @method AutoForm.resetForm\n * @public\n * @param {String} formId\n * @param {TemplateInstance} [template] Looked up if not provided. Pass in for efficiency.\n * @returns {undefined}\n *\n * Resets an autoform, including resetting validation errors. The same as clicking the reset button for an autoform.\n */\nAutoForm.resetForm = function autoFormResetForm(formId, template) {\n  template = template || AutoForm.templateInstanceForForm(formId);\n  if (!Utility.checkTemplate(template)) return;\n  template.$('form')[0].reset();\n};\n\n/**\n * @method AutoForm.setDefaultTemplate\n * @public\n * @param {String} template\n */\nAutoForm.setDefaultTemplate = function autoFormSetDefaultTemplate(template) {\n  globalDefaultTemplate = template;\n  deps.defaultTemplate.changed();\n};\n\n/**\n * @method AutoForm.getDefaultTemplate\n * @public\n *\n * Reactive.\n */\nAutoForm.getDefaultTemplate = function autoFormGetDefaultTemplate() {\n  deps.defaultTemplate.depend();\n  return globalDefaultTemplate;\n};\n\n/**\n * @method AutoForm.setDefaultTemplateForType\n * @public\n * @param {String} type\n * @param {String} template\n */\nAutoForm.setDefaultTemplateForType = function autoFormSetDefaultTemplateForType(type, template) {\n  if (!deps.defaultTypeTemplates[type]) {\n    deps.defaultTypeTemplates[type] = new Tracker.Dependency();\n  }\n  if (template !== null && !Template[type + '_' + template]) {\n    throw new Error('setDefaultTemplateForType can\\'t set default template to \"' + template + '\" for type \"' + type + '\" because there is no defined template with the name \"' + type + '_' + template + '\"');\n  }\n  defaultTypeTemplates[type] = template;\n  deps.defaultTypeTemplates[type].changed();\n};\n\n/**\n * @method AutoForm.getDefaultTemplateForType\n * @public\n * @param {String} type\n * @return {String} Template name\n *\n * Reactive.\n */\nAutoForm.getDefaultTemplateForType = function autoFormGetDefaultTemplateForType(type) {\n  if (!deps.defaultTypeTemplates[type]) {\n    deps.defaultTypeTemplates[type] = new Tracker.Dependency();\n  }\n  deps.defaultTypeTemplates[type].depend();\n  return defaultTypeTemplates[type];\n};\n\n/**\n * @method AutoForm.getTemplateName\n * @public\n * @param {String} templateType\n * @param {String} templateName\n * @param {String} [fieldName]\n * @param {Boolean} [skipExistsCheck] Pass `true` to return a template name even if that template hasn't been defined.\n * @return {String} Template name\n *\n * Returns the full template name. In the simplest scenario, this is templateType_templateName\n * as passed in. However, if templateName is not provided, it is looked up in the following\n * manner:\n *\n * 1. autoform.<componentType>.template from the schema (field+type override for all forms)\n * 2. autoform.template from the schema (field override for all forms)\n * 3. template-<componentType> attribute on an ancestor component within the same form (form+type for all fields)\n * 4. template attribute on an ancestor component within the same form (form specificity for all types and fields)\n * 5. Default template for component type, as set by AutoForm.setDefaultTemplateForType\n * 6. Default template, as set by AutoForm.setDefaultTemplate.\n * 7. Built-in default template, currently bootstrap-3.\n */\nAutoForm.getTemplateName = function autoFormGetTemplateName(templateType, templateName, fieldName, skipExistsCheck) {\n  function templateExists(t) {\n    return !!(skipExistsCheck || Template[t]);\n  }\n\n  // Default case: use the `template` attribute provided\n  if (templateName && templateExists(templateType + '_' + templateName)) {\n    return templateType + '_' + templateName;\n  }\n\n  // If the attributes provided a templateName but that template didn't exist, show a warning\n  if (templateName && AutoForm._debug) {\n    console.warn(templateType + ': \"' + templateName + '\" is not a valid template name. Falling back to a different template.');\n  }\n\n  // Get `autoform` object from the schema, if present.\n  // Skip for quickForm because it renders a form and not a field.\n  let schemaAutoFormDefs;\n  if (templateType !== 'quickForm' && fieldName) {\n    const fieldSchema = AutoForm.getSchemaForField(fieldName);\n    schemaAutoFormDefs = fieldSchema && fieldSchema.autoform;\n  }\n\n  // Fallback #1: autoform.<componentType>.template from the schema\n  if (schemaAutoFormDefs && schemaAutoFormDefs[templateType] && schemaAutoFormDefs[templateType].template && templateExists(templateType + '_' + schemaAutoFormDefs[templateType].template)) {\n    return templateType + '_' + schemaAutoFormDefs[templateType].template;\n  }\n\n  // Fallback #2: autoform.template from the schema\n  if (schemaAutoFormDefs && schemaAutoFormDefs.template && templateExists(templateType + '_' + schemaAutoFormDefs.template)) {\n    return templateType + '_' + schemaAutoFormDefs.template;\n  }\n\n  // Fallback #3: template-<componentType> attribute on an ancestor component within the same form\n  let templateFromAncestor = AutoForm.findAttribute('template-' + templateType);\n  if (templateFromAncestor && templateExists(templateType + '_' + templateFromAncestor)) {\n    return templateType + '_' + templateFromAncestor;\n  }\n\n  // Fallback #4: template attribute on an ancestor component within the same form\n  templateFromAncestor = AutoForm.findAttribute('template');\n  if (templateFromAncestor && templateExists(templateType + '_' + templateFromAncestor)) {\n    return templateType + '_' + templateFromAncestor;\n  }\n\n  // Fallback #5: Default template for component type, as set by AutoForm.setDefaultTemplateForType\n  const defaultTemplateForType = AutoForm.getDefaultTemplateForType(templateType);\n  if (defaultTemplateForType && templateExists(templateType + '_' + defaultTemplateForType)) {\n    return templateType + '_' + defaultTemplateForType;\n  }\n\n  // Fallback #6: Default template, as set by AutoForm.setDefaultTemplate\n  const defaultTemplate = AutoForm.getDefaultTemplate();\n  if (defaultTemplate && templateExists(templateType + '_' + defaultTemplate)) {\n    return templateType + '_' + defaultTemplate;\n  }\n\n  // Found nothing. Return undefined\n};\n\n/**\n * @method AutoForm.getFormValues\n * @public\n * @param {String} formId The `id` attribute of the `autoForm` you want current values for.\n * @param {Template} [template] The template instance, if already known, as a performance optimization.\n * @param {SimpleSchema} [ss] The SimpleSchema instance, if already known, as a performance optimization.\n * @param {Boolean} [getModifier] Set to `true` to return a modifier object or `false` to return a normal object. For backwards compatibility, and object containing both is returned if this is undefined.\n * @return {Object|null}\n *\n * Returns an object representing the current values of all schema-based fields in the form.\n * The returned object is either a normal object or a MongoDB modifier, based on the `getModifier` argument. Return value may be `null` if the form is not currently rendered on screen.\n */\nAutoForm.getFormValues = function autoFormGetFormValues(formId, template, ss, getModifier) {\n  var insertDoc, updateDoc, transforms;\n\n  template = template || AutoForm.templateInstanceForForm(formId);\n  if (!template ||\n      !template.view ||\n      // We check for domrange later in this function\n      template.view.isDestroyed) {\n    return null;\n  }\n\n  // Get a reference to the SimpleSchema instance that should be used for\n  // determining what types we want back for each field.\n  ss = ss || AutoForm.getFormSchema(formId);\n\n  var form = AutoForm.getCurrentDataForForm(formId);\n\n  // By default, we do not keep empty strings\n  var keepEmptyStrings = false;\n  if (form.removeEmptyStrings === false) {\n    keepEmptyStrings = true;\n  }\n  // By default, we do filter\n  var filter = true;\n  if (form.filter === false) {\n    filter = false;\n  }\n  // By default, we do autoConvert\n  var autoConvert = true;\n  if (form.autoConvert === false) {\n    autoConvert = false;\n  }\n  // By default, we do trimStrings\n  var trimStrings = true;\n  if (form.trimStrings === false) {\n    trimStrings = false;\n  }\n  // By default, we do keepArrays\n  // We need keepArrays: false when we need update fields\n  // like \"foo.2.bar\" to update the proper index. But in\n  // most cases, we need to keep arrays together due to the mongo\n  // bug that creates objects rather than arrays if the array\n  // does not already exist in the db.\n  var keepArrays = true;\n  if (form.setArrayItems === true) {\n    keepArrays = false;\n  }\n\n  var hookCtx = {\n    template: template,\n    formId: formId,\n    schema: ss\n  };\n\n  // Get a preliminary doc based on the form\n  var doc;\n\n  if (template.view._domrange) {\n    // Build a flat document from field values\n    doc = getFlatDocOfFieldValues(getAllFieldsInForm(template), ss);\n\n    // Expand the flat document\n    doc = AutoForm.Utility.expandObj(doc);\n\n    // When all fields that comprise a sub-object are empty, we should unset\n    // the whole subobject and not complain about required fields in it. For example,\n    // if `profile.address` has several properties but they are all null or undefined,\n    // we will set `profile.address=null`. This ensures that we don't get incorrect validation\n    // errors about required fields that are children of optional objects.\n    AutoForm.Utility.bubbleEmpty(doc, keepEmptyStrings);\n  } else {\n    // If the form is not yet rendered, use the form.doc\n    doc = form.doc || {};\n  }\n\n  // Create and clean insert doc.\n  if (getModifier !== true) {\n    // Delete any properties that are null, undefined, or empty strings,\n    // unless the form has requested to keep empty string.\n    // Do not add autoValues at this stage.\n    insertDoc = AutoForm.Utility.cleanNulls(doc, false, keepEmptyStrings);\n\n    // As array items are removed, gaps can appear in the numbering,\n    // which results in arrays that have undefined items. Here we\n    // remove any array items that are undefined.\n    //\n    // We do this to the insertDoc, but we don't want to do it earlier to the\n    // doc, because that would cause the update modifier to have $sets for\n    // the wrong array indexes.\n    AutoForm.Utility.compactArrays(insertDoc);\n\n    ss.clean(insertDoc, {\n      isModifier: false,\n      getAutoValues: false,\n      filter: filter,\n      autoConvert: autoConvert,\n      trimStrings: trimStrings,\n      mutate: true,\n    });\n\n    // Pass expanded doc through formToDoc hooks\n    transforms = Hooks.getHooks(formId, 'formToDoc');\n    _.each(transforms, function formValuesTransform(transform) {\n      insertDoc = transform.call(hookCtx, insertDoc, ss);\n    });\n  }\n\n  // Create and clean update modifier.\n  if (getModifier !== false) {\n    // Converts to modifier object with $set and $unset.\n    // Do not add autoValues at this stage.\n    updateDoc = AutoForm.Utility.docToModifier(doc, {\n      keepEmptyStrings: keepEmptyStrings,\n      keepArrays: keepArrays,\n    });\n\n    ss.clean(updateDoc, {\n      isModifier: true,\n      getAutoValues: false,\n      filter: filter,\n      autoConvert: autoConvert,\n      trimStrings: trimStrings,\n      mutate: true,\n    });\n\n    // Pass modifier through formToModifier hooks\n    transforms = Hooks.getHooks(formId, 'formToModifier');\n    _.each(transforms, function formValuesTransform(transform) {\n      updateDoc = transform.call(hookCtx, updateDoc);\n    });\n  }\n\n  if (getModifier === true) {\n    return updateDoc;\n  } else if (getModifier === false) {\n    return insertDoc;\n  } else {\n    // We return insertDoc and updateDoc when getModifier\n    // is undefined for backwards compatibility\n    return {\n      insertDoc: insertDoc,\n      updateDoc: updateDoc\n    };\n  }\n};\n\n/**\n * @method AutoForm.getFieldValue\n * @public\n * @param {String} fieldName The name of the field for which you want the current value.\n * @param {String} [formId] The `id` attribute of the `autoForm` you want current values for. Default is the closest form from the current context.\n * @return {Any|undefined}\n *\n * Returns the value of the field (the value that would be used if the form were submitted right now).\n * This is a reactive method that will rerun whenever the current value of the requested field changes. Return value will be undefined if the field is not currently rendered.\n */\nAutoForm.getFieldValue = function autoFormGetFieldValue(fieldName, formId) {\n  // find AutoForm template\n  var template = Tracker.nonreactive(function () {\n    return AutoForm.templateInstanceForForm(formId);\n  });\n\n  if (!template) {\n    if (formId) {\n      AutoForm.rerunWhenFormRenderedOrDestroyed(formId);\n    }\n    return;\n  }\n\n  // reactive dependency\n  template.formValues = template.formValues || {};\n  if (!template.formValues[fieldName]) {\n    template.formValues[fieldName] = new Tracker.Dependency();\n  }\n  template.formValues[fieldName].depend();\n\n  var doc = AutoForm.getFormValues(formId, template, null, false);\n  if (!doc) return;\n\n  var mDoc = new MongoObject(doc);\n  return mDoc.getValueForKey(fieldName);\n};\n\n/**\n * @method AutoForm.getInputTypeTemplateNameForElement\n * @public\n * @param {DOMElement} element The input DOM element, generated by an autoform input control\n * @return {String}\n *\n * Returns the name of the template used to render the element.\n */\nAutoForm.getInputTypeTemplateNameForElement = function autoFormGetInputTypeTemplateNameForElement(element) {\n  // get the enclosing view\n  var view = Blaze.getView(element);\n  // if the enclosing view is not a template, perhaps because\n  // the template contains a block helper like if, with, each,\n  // then look up the view chain until we arrive at a template\n  while (view &&\n         view.name.indexOf('Template.') !== 0 &&\n         view.name.indexOf('BlazeComponent.') !== 0) {\n    view = view.originalParentView || view.parentView;\n  }\n\n  if (!view) return;\n\n  // View names have \"Template.\" or \"BlazeComponent.\" at the beginning so we slice that off.\n  return view.name.slice(view.name.indexOf('.') + 1);\n};\n\n/**\n * @method AutoForm.getInputValue\n * @public\n * @param {DOMElement} element The input DOM element, generated by an autoform input control, which must have a `data-schema-key` attribute set to the correct schema key name.\n * @param {SimpleSchema} [ss] Provide the SimpleSchema instance if you already have it.\n * @return {Any}\n *\n * Returns the value of the field (the value that would be used if the form were submitted right now).\n * Unlike `AutoForm.getFieldValue`, this function is not reactive.\n */\nAutoForm.getInputValue = function autoFormGetInputValue(element, ss) {\n  var field, fieldName, fieldType, fieldSchema, arrayItemFieldType, val, typeDef, inputTypeTemplate, dataContext, autoConvert;\n\n  Tracker.nonreactive(function() {\n    // don't rerun when data context of element changes, can cause infinite loops\n\n    dataContext = Blaze.getData(element);\n    if (dataContext && dataContext.atts) {\n      autoConvert = dataContext.atts.autoConvert;\n    }\n  });\n\n  // Get jQuery field reference\n  field = $(element);\n\n  // Get the field/schema key name\n  fieldName = field.attr('data-schema-key');\n\n  // If we have a schema, we can autoconvert to the correct data type\n  if (ss) fieldType = ss.getQuickTypeForKey(fieldName);\n\n  // Get the name of the input type template used to render the input element\n  inputTypeTemplate = AutoForm.getInputTypeTemplateNameForElement(element);\n\n  // Slice off the potential theme template, after the last underscore.\n  var lastUnderscore = inputTypeTemplate.lastIndexOf('_');\n  if (lastUnderscore !== -1) {\n    inputTypeTemplate = inputTypeTemplate.slice(0, lastUnderscore);\n  }\n\n  // Figure out what registered input type was used to render this element\n  typeDef = _.where(AutoForm._inputTypeDefinitions, { template: inputTypeTemplate })[0];\n\n  // If field has a \"data-null-value\" attribute, value should always be null\n  if (field.attr('data-null-value') !== void 0) {\n    val = null;\n  }\n  // Otherwise get the field's value using the input type's `valueOut` function if provided\n  else if (typeDef && typeDef.valueOut) {\n    val = typeDef.valueOut.call(field);\n  }\n  // Otherwise get the field's value in a default way\n  else {\n    val = field.val();\n  }\n\n  // run through input's type converter if provided\n  if (val !== void 0 && autoConvert !== false && typeDef && typeDef.valueConverters && fieldType) {\n    var converterFunc = typeDef.valueConverters[fieldType];\n    if (typeof converterFunc === 'function') {\n      val = converterFunc.call(field, val);\n    }\n  }\n\n  return val;\n};\n\n/**\n * @method AutoForm.addInputType\n * @public\n * @param {String} name The type string that this definition is for.\n * @param {Object} definition Defines how the input type should be rendered.\n * @param {String} definition.componentName The component name. A template with the name <componentName>_bootstrap3, and potentially others, must be defined.\n * @return {undefined}\n *\n * Use this method to add custom input components.\n */\nAutoForm.addInputType = function afAddInputType(name, definition) {\n  var obj = {};\n  obj[name] = definition;\n  _.extend(AutoForm._inputTypeDefinitions, obj);\n};\n\n/**\n * @method AutoForm.addFormType\n * @public\n * @param {String} name The type string that this definition is for.\n * @param {Object} definition Defines how the submit type should work\n * @param {Function} [definition.adjustInputContext] A function that accepts a single argument, which is the context with which an input template in the form will be called, potentially changes the context object, and then returns it. For example, the \"readonly\" and \"disabled\" form types use this function to add the \"readonly\" or \"disabled\" attribute, respectively, to every input within the form.\n * @param {Function} [definition.adjustSchema] A function that accepts a single argument, which is the form schema, and potentially uses that to return a different schema to use instead. For example, the \"update-pushArray\" form type uses this function to build and return a schema that is limited by the `scope` attribute on the form. When this function is called, `this` contains useful information about the form.\n * @param {Boolean} [definition.hideArrayItemButtons] Set to `true` if this form type should not show buttons for adding and removing items in an array field. The \"disabled\" and \"readonly\" form types do this.\n * @param {Function} definition.onSubmit A function that does whatever should happen upon submission of this form type. When this function is called, `this` contains useful information about the form. At a minimum, you probably want to call `this.event.preventDefault()` to prevent the browser from submitting the form. Your submission logic may want to rely on additional custom form attributes, which will be available in `this.formAttributes`. If you do any additional validation and it fails, you should call `this.failedValidation()`. When your logic is done, you should call `this.result(error, result)`. If you want to end the submission process without providing a result, call `this.endSubmission()`. If you don't call `this.result()` or `this.endSubmission()`, `endSubmit` hooks won't be called, so for example the submit button might remain disabled. `onError` hooks will be called only if you pass an error to `this.result()`. `onSuccess` hooks will be called only if you do not pass an error to `this.result()`.\n * @param {Function} [definition.shouldPrevalidate] A function that returns `true` if validation against the form schema should happen before the `onSubmit` function is called, or `false` if not. When this function is called, `this` contains useful information about the form. If this function is not provided for a form type, the default is `true`.\n * @param {Function} definition.validateForm A function that validates the form and returns `true` if valid or `false` if not. This can happen during submission but also at other times. When this function is called, `this` contains useful information about the form and the validation options.\n * @return {undefined}\n *\n * Use this method to add custom form types.\n */\nAutoForm.addFormType = function afAddFormType(name, definition) {\n  var obj = {};\n  obj[name] = definition;\n  _.extend(AutoForm._formTypeDefinitions, obj);\n};\n\n/**\n * @method AutoForm.validateField\n * @public\n * @param {String} formId The `id` attribute of the `autoForm` you want to validate.\n * @param {String} fieldName The name of the field within the `autoForm` you want to validate.\n * @param {Boolean} [skipEmpty=false] Set to `true` to skip validation if the field has no value. Useful for preventing `required` errors in form fields that the user has not yet filled out.\n * @return {Boolean} Is it valid?\n *\n * In addition to returning a boolean that indicates whether the field is currently valid,\n * this method causes the reactive validation messages to appear.\n */\nAutoForm.validateField = function autoFormValidateField(formId, fieldName, skipEmpty) {\n  return validateField(fieldName, formId, skipEmpty, false);\n};\n\n/**\n * @method AutoForm.validateForm\n * @public\n * @param {String} formId The `id` attribute of the `autoForm` you want to validate.\n * @return {Boolean} Is it valid?\n *\n * In addition to returning a boolean that indicates whether the form is currently valid,\n * this method causes the reactive validation messages to appear.\n */\nAutoForm.validateForm = function autoFormValidateForm(formId) {\n  var form = AutoForm.getCurrentDataForForm(formId);\n  var formDoc, formType = form.type;\n\n  var ftd = Utility.getFormTypeDef(formType);\n\n  // Gather all form values\n  if (ftd.needsModifierAndDoc) {\n    formDoc = AutoForm.getFormValues(formId, null, null);\n  } else if (ftd.usesModifier) {\n    formDoc = AutoForm.getFormValues(formId, null, null, true);\n  } else {\n    formDoc = AutoForm.getFormValues(formId, null, null, false);\n  }\n\n  // If form is not currently rendered, return true\n  if (!formDoc) {\n    return true;\n  }\n\n  return (form.validation === 'none') || ftd.validateForm.call({\n    form: form,\n    formDoc: formDoc,\n    useCollectionSchema: false\n  });\n};\n\n/**\n * @method AutoForm.getValidationContext\n * @public\n * @param {String} [formId] The `id` attribute of the `autoForm` for which you want the validation context\n * @return {SimpleSchema.ValidationContext} The SimpleSchema validation context object.\n *\n * Use this method to get the validation context, which can be used to check\n * the current invalid fields, manually invalidate fields, etc.\n */\nAutoForm.getValidationContext = function autoFormGetValidationContext(formId) {\n  var form = AutoForm.getCurrentDataForForm(formId);\n  var ss = form._resolvedSchema;\n  if (!ss) return;\n  // formId may not be passed in, but we MUST pass it into namedContext to get back proper context\n  formId = formId || form.id;\n  return ss.namedContext(formId);\n};\n\n/**\n * @method AutoForm.findAttribute\n * @public\n * @param {String} attrName Attribute name\n * @return {Any|undefined} Searches for the given attribute, looking up the parent context tree until the closest autoform is reached.\n *\n * Call this method from a UI helper. Might return undefined.\n */\nAutoForm.findAttribute = function autoFormFindAttribute(attrName) {\n  var val, view, viewData;\n\n  function checkView() {\n    // Is the attribute we're looking for on here?\n    // If so, stop searching\n    viewData = Blaze.getData(view);\n    if (viewData && viewData.atts && viewData.atts[attrName] !== void 0) {\n      val = viewData.atts[attrName];\n    } else if (viewData && viewData[attrName] !== void 0) {\n      // When searching for \"template\", make sure we didn't just\n      // find the one that's on Template.dynamic\n      if (attrName !== 'template' || !('data' in viewData)) {\n        val = viewData[attrName];\n      }\n    }\n  }\n\n  // Loop\n  view = Blaze.currentView;\n  while (val === undefined && view && view.name !== 'Template.autoForm') {\n    checkView();\n    view = view.originalParentView || view.parentView;\n  }\n\n  // If we've reached the form, check there, too\n  if (val === undefined && view && view.name === 'Template.autoForm') {\n    checkView();\n  }\n\n  return val;\n};\n\n/**\n * @method AutoForm.findAttributesWithPrefix\n * @public\n * @param {String} prefix Attribute prefix\n * @return {Object} An object containing all of the found attributes and their values, with the prefix removed from the keys.\n *\n * Call this method from a UI helper. Searches for attributes that start with the given prefix, looking up the parent context tree until the closest autoform is reached.\n */\nAutoForm.findAttributesWithPrefix = function autoFormFindAttributesWithPrefix(prefix) {\n  var result = {}, view, viewData, searchObj;\n\n  function checkView() {\n    // Is the attribute we're looking for on here?\n    // If so, add to result object.\n    viewData = Blaze.getData(view);\n    if (viewData && viewData.atts) {\n      searchObj = viewData.atts;\n    } else {\n      searchObj = viewData;\n    }\n    // We need an isArray check, too because _.isObject([{}]) comes back true\n    if (_.isObject(searchObj) && !_.isArray(searchObj)) {\n      _.each(searchObj, function (v, k) {\n        if (k.indexOf(prefix) === 0) {\n          result[k.slice(prefix.length)] = v;\n        }\n      });\n    }\n  }\n\n  // Loop\n  view = Blaze.currentView;\n  while (view && view.name !== 'Template.autoForm') {\n    checkView();\n    view = view.originalParentView || view.parentView;\n  }\n\n  // If we've reached the form, check there, too\n  if (view && view.name === 'Template.autoForm') {\n    checkView();\n  }\n\n  return result;\n};\n\n/**\n * @method AutoForm.debug\n * @public\n *\n * Call this method in client code while developing to turn on extra logging.\n * You need to call it just one time, usually in top level client code.\n */\nAutoForm.debug = function autoFormDebug() {\n  AutoForm._debug = true;\n  AutoForm.addHooks(null, {\n    onError: function (operation, error) {\n      console.log('Error in ' + this.formId, operation, error);\n    }\n  });\n};\n\n/**\n * @property AutoForm.arrayTracker\n * @public\n */\nAutoForm.arrayTracker = arrayTracker;\n\n/**\n * @method AutoForm.getInputType\n * @param {Object} atts The attributes provided to afFieldInput.\n * @public\n * @return {String} The input type. Most are the same as the `type` attributes for HTML input elements, but some are special strings that autoform interprets.\n *\n * Call this method from a UI helper to get the type string for the input control.\n */\nAutoForm.getInputType = function getInputType(atts) {\n  var type;\n\n  atts = AutoForm.Utility.getComponentContext(atts, 'afFieldInput').atts;\n\n  // If a `type` attribute is specified, we just use that\n  if (atts.type) return atts.type;\n\n  // Get schema definition, using the item definition for array fields\n  var ss = AutoForm.getFormSchema();\n  var schemaType = ss && ss.getQuickTypeForKey(atts.name);\n  if (!schemaType) return 'text';\n\n  var expectsArray = schemaType.endsWith('Array');\n\n  // Based on the `type` attribute, the `type` from the schema, and/or\n  // other characteristics such as regEx and whether an array is expected,\n  // choose which type string to return.\n\n  // If options were provided, noselect is `true`, and the schema\n  // expects the value of the field to be an array, use \"select-checkbox\".\n  if (atts.options && atts.noselect === true && expectsArray) {\n    type = 'select-checkbox';\n  }\n\n  // If options were provided, noselect is `true`, and the schema\n  // does not expect the value of the field to be an array, use \"select-radio\".\n  else if (atts.options && atts.noselect === true && !expectsArray) {\n    type = 'select-radio';\n  }\n\n  // If options were provided, noselect is not `true`, and the schema\n  // expects the value of the field to be an array, use \"select-multiple\".\n  else if (atts.options && atts.noselect !== true && expectsArray) {\n    type = 'select-multiple';\n  }\n\n  // If options were provided, noselect is not `true`, and the schema\n  // does not expect the value of the field to be an array, use \"select\".\n  else if (atts.options && atts.noselect !== true && !expectsArray) {\n    type = 'select';\n  }\n\n  // If the schema expects the value of the field to be a string and\n  // the `rows` attribute is provided, use \"textarea\"\n  else if (schemaType === 'string' && atts.rows === +atts.rows) {\n    type = 'textarea';\n  }\n\n  // If the schema expects the value of the field to be a number,\n  // use \"number\"\n  else if (schemaType === 'number') {\n    type = 'number';\n  }\n\n  // If the schema expects the value of the field to be a Date instance,\n  // use \"date\"\n  else if (schemaType === 'date') {\n    type = 'date';\n  }\n\n  // If the schema expects the value of the field to be a boolean,\n  // use \"boolean-checkbox\"\n  else if (schemaType === 'boolean') {\n    type = 'boolean-checkbox';\n  }\n\n  // Default is \"text\"\n  else {\n    type = 'text';\n  }\n\n  return type;\n};\n\n/**\n * @method AutoForm.getSchemaForField\n * @public\n * @param {String} name The field name attribute / schema key.\n * @return {Object|undefined}\n *\n * Call this method from a UI helper to get the field definitions based on the schema used by the closest containing autoForm.\n */\nAutoForm.getSchemaForField = function autoFormGetSchemaForField(name) {\n  var ss = AutoForm.getFormSchema();\n  if (!ss) return;\n  return Utility.getFieldDefinition(ss, name);\n};\n\n/**\n * @method AutoForm._getOptionsForField\n * @public\n * @param {String} name The field name attribute / schema key.\n * @return {Array(Object)|String|undefined}\n *\n * Call this method from a UI helper to get the select options for the field. Might return the string \"allowed\".\n */\nAutoForm._getOptionsForField = function autoFormGetOptionsForField(name) {\n  var ss, def, saf, allowedValues;\n\n  ss = AutoForm.getFormSchema();\n  if (!ss) return;\n\n  def = AutoForm.Utility.getFieldDefinition(ss, name);\n  if (!def) return;\n\n  // If options in schema, use those\n  saf = def.autoform;\n  if (saf) {\n    if (saf.afFieldInput && saf.afFieldInput.options) {\n      return saf.afFieldInput.options;\n    } else if (saf.afQuickField && saf.afQuickField.options) {\n      return saf.afQuickField.options;\n    } else if (saf.options) {\n      return saf.options;\n    }\n  }\n\n  // If schema has allowedValues, use those\n  allowedValues = ss.getAllowedValuesForKey(name);\n  if (allowedValues) return 'allowed';\n};\n\n/**\n * @method AutoForm.getLabelForField\n * @public\n * @param {String} name The field name attribute / schema key.\n * @return {Object}\n *\n * Call this method from a UI helper to get the field definitions based on the schema used by the closest containing autoForm.\n */\nAutoForm.getLabelForField = function autoFormGetLabelForField(name) {\n  return AutoForm.getFormSchema().label(name);\n};\n\n/**\n * @method AutoForm.templateInstanceForForm\n * @public\n * @param {String} [formId] The form's `id` attribute\n * @returns {TemplateInstance|undefined} The template instance.\n *\n * Gets the template instance for the form with formId or the closest form to the current context.\n */\nAutoForm.templateInstanceForForm = function (formId) {\n  var view = AutoForm.viewForForm(formId);\n\n  if (!view) return;\n\n  return view.templateInstance();\n};\n\n/**\n * @method AutoForm.viewForForm\n * @public\n * @param {String} [formId] The form's `id` attribute. Do not pass this if calling from within a form context.\n * @returns {Blaze.View|undefined} The `Blaze.View` instance for the autoForm.\n *\n * Gets the `Blaze.View` instance for the form with formId or the closest form to the current context.\n */\nAutoForm.viewForForm = function (formId) {\n  var formElement, view;\n\n  if (formId) {\n    formElement = document.getElementById(formId);\n    if (!formElement) {\n      return;\n    }\n  }\n\n  // If formElement is undefined, Blaze.getView returns the current view.\n  try {\n    view = Blaze.getView(formElement);\n  } catch (err) {}\n\n  while (view && view.name !== 'Template.autoForm') {\n    view = view.originalParentView || view.parentView;\n  }\n\n  if (!view || view.name !== 'Template.autoForm') {\n    return;\n  }\n\n  return view;\n};\n\n/**\n * @method AutoForm.getArrayCountFromDocForField\n * @public\n * @param {String} formId The form's `id` attribute\n * @param {String} field  The field name (schema key)\n * @returns {Number|undefined} Array count in the attached document.\n *\n * Looks in the document attached to the form to see if the\n * requested field exists and is an array. If so, returns the\n * length (count) of the array. Otherwise returns undefined.\n */\nAutoForm.getArrayCountFromDocForField = function (formId, field) {\n  var mDoc = AutoForm.reactiveFormData.sourceDoc(formId);\n  var docCount;\n  if (mDoc) {\n    var keyInfo = mDoc.getInfoForKey(field);\n    if (keyInfo && _.isArray(keyInfo.value)) {\n      docCount = keyInfo.value.length;\n    }\n  }\n  return docCount;\n};\n\n/**\n * @method AutoForm.parseData\n * @public\n * @param {Object} data Current data context for the form, or an empty object. Usually this is used from a quickForm, since the autoForm won't be rendered yet. Otherwise you should use AutoForm.getCurrentDataForForm if you can.\n * @returns {Object} Current data context for the form, or an empty object.\n *\n * Parses and alters the current data context for a form. It will have default values added and a `_resolvedSchema` property that has the schema the form should use.\n */\nAutoForm.parseData = function (data) {\n  return setDefaults(data);\n};\n\n/**\n * @method AutoForm.getCurrentDataForForm\n * @public\n * @param {String} formId The form's `id` attribute\n * @returns {Object} Current data context for the form, or an empty object.\n *\n * Returns the current data context for a form.\n * You can call this without a formId from within a helper and\n * the data for the nearest containing form will be returned.\n */\nAutoForm.getCurrentDataForForm = function (formId) {\n  var view = AutoForm.viewForForm(formId);\n\n  if (!view) return;\n\n  var data = Blaze.getData(view);\n\n  if (!data) return;\n\n  return setDefaults(data);\n};\n\n/**\n * @method AutoForm.getCurrentDataPlusExtrasForForm\n * @public\n * @param   {String} [formId] The form's `id` attribute\n * @returns {Object} Current data context for the form, or an empty object.\n *\n * Returns the current data context for a form plus some extra properties.\n * You can call this without a formId from within a helper and\n * the data for the nearest containing form will be returned.\n */\nAutoForm.getCurrentDataPlusExtrasForForm = function (formId) {\n  var data = AutoForm.getCurrentDataForForm(formId);\n\n  data = _.clone(data);\n\n  // add form type definition\n  var formType = data.type || 'normal';\n  data.formTypeDef = Utility.getFormTypeDef(formType);\n\n  return data;\n};\n\n/**\n * @method AutoForm.getFormCollection\n * @public\n * @param {String} formId The form's `id` attribute\n * @returns {Mongo.Collection|undefined} The Collection instance\n *\n * Gets the collection for a form from the `collection` attribute\n */\nAutoForm.getFormCollection = function (formId) {\n  var data = AutoForm.getCurrentDataForForm(formId);\n  return AutoForm.Utility.lookup(data.collection);\n};\n\n/**\n * @method AutoForm.getFormSchema\n * @public\n * @param {String} [formId] The form's `id` attribute\n * @param {Object} [form] Pass the form data context as an optimization or if the form is not yet rendered.\n * @returns {SimpleSchema|undefined} The SimpleSchema instance\n *\n * Gets the schema for a form, from the `schema` attribute if\n * provided, or from the schema attached to the `Mongo.Collection`\n * specified in the `collection` attribute. The form must be\n * currently rendered.\n */\nAutoForm.getFormSchema = function (formId, form) {\n  form = form ? setDefaults(form) : AutoForm.getCurrentDataForForm(formId);\n  return form._resolvedSchema;\n};\n\n/**\n * @method AutoForm.getFormId\n * @public\n * @returns {String} The containing form's `id` attribute value\n *\n * Call in a helper to get the containing form's `id` attribute. Reactive.\n */\nAutoForm.getFormId = function () {\n  return AutoForm.getCurrentDataForForm().id;\n};\n\n/**\n * @method AutoForm.selectFirstInvalidField\n * @public\n * @param {String} formId The `id` attribute of the form\n * @param {SimpleSchema} ss The SimpleSchema instance that was used to create the form's validation context.\n * @returns {undefined}\n *\n * Selects the focus the first field (in DOM order) with an error.\n */\nAutoForm.selectFirstInvalidField = function selectFirstInvalidField(formId, ss) {\n  var ctx = ss.namedContext(formId), template, fields;\n  if (!ctx.isValid()) {\n    template = AutoForm.templateInstanceForForm(formId);\n    fields = getAllFieldsInForm(template);\n    fields.each(function () {\n      var f = $(this);\n      if (ctx.keyIsInvalid(f.attr('data-schema-key'))) {\n        if (!f.attr('tabindex')) {\n          f.attr('tabindex', 0); // Make sure the field is 'focusable'\n          f.focus();\n          f.removeAttr('tabindex');\n        } else {\n          f.focus();\n        }\n        return false;\n      }\n    });\n  }\n};\n\nAutoForm.addStickyValidationError = function addStickyValidationError(formId, key, type, value) {\n  var template = AutoForm.templateInstanceForForm(formId);\n  if (!template) return;\n\n  // Add error\n  template._stickyErrors[key] = {\n    type: type,\n    value: value\n  };\n\n  // Revalidate that field\n  validateField(key, formId, false, false);\n};\n\nAutoForm.removeStickyValidationError = function removeStickyValidationError(formId, key) {\n  var template = AutoForm.templateInstanceForForm(formId);\n  if (!template) return;\n\n  // Remove errors\n  delete template._stickyErrors[key];\n\n  // Revalidate that field\n  validateField(key, formId, false, false);\n};\n\n/**\n * @method AutoForm._validateFormDoc\n * @public\n *\n * If creating a form type, you will often want to call this from the `validateForm` function. It provides the generic form validation logic that does not typically change between form types.\n *\n * @param {Object} doc The document with the gathered form values to validate.\n * @param {Boolean} isModifier Is `doc` actually a mongo modifier object?\n * @param {String} formId The form `id` attribute\n * @param {SimpleSchema} ss The SimpleSchema instance against which to validate.\n * @param {Object} form The form context object\n * @param {String} [key] Optionally, a specific schema key to validate.\n * @returns {Boolean} Is the form valid?\n */\nAutoForm._validateFormDoc = function validateFormDoc(doc, isModifier, formId, ss, form, key) {\n  var isValid;\n  var ec = {\n    userId: (Meteor.userId && Meteor.userId()) || null,\n    isInsert: !isModifier,\n    isUpdate: !!isModifier,\n    isUpsert: false,\n    isFromTrustedCode: false,\n    docId: (form.doc && form.doc._id) || null\n  };\n\n  // Get a version of the doc that has auto values to validate here. We\n  // don't want to actually send any auto values to the server because\n  // we ultimately want them generated on the server\n  var docForValidation = _.clone(doc);\n  ss.clean(docForValidation, {\n    isModifier: isModifier,\n    filter: false,\n    autoConvert: false,\n    trimStrings: false,\n    extendAutoValueContext: ec,\n    mutate: true,\n  });\n\n  // Get form's validation context\n  var vc = ss.namedContext(formId);\n\n  // Validate\n  // If `key` is provided, we validate that key/field only\n  if (key) {\n    isValid = vc.validate(docForValidation, {\n      extendedCustomContext: ec,\n      keys: [key],\n      modifier: isModifier,\n    });\n\n    // Add sticky error for this key if there is one\n    var stickyError = AutoForm.templateInstanceForForm(formId)._stickyErrors[key];\n    if (stickyError) {\n      isValid = false;\n      vc.addValidationErrors([\n        { name: key, type: stickyError.type, value: stickyError.value }\n      ]);\n    }\n  } else {\n    isValid = vc.validate(docForValidation, {\n      modifier: isModifier,\n      extendedCustomContext: ec\n    });\n\n    // Add sticky errors for all keys if any\n    var stickyErrors = AutoForm.templateInstanceForForm(formId)._stickyErrors;\n    if (!_.isEmpty(stickyErrors)) {\n      isValid = false;\n      stickyErrors = _.map(stickyErrors, function (obj, k) {\n        return { name: k, type: obj.type, value: obj.value };\n      });\n      vc.addValidationErrors(stickyErrors);\n    }\n\n    if (!isValid) {\n      AutoForm.selectFirstInvalidField(formId, ss);\n    }\n  }\n\n  return isValid;\n};\n\n/**\n * Sets defaults for the form data context\n * @private\n * @returns {String} The data context with property defaults added.\n */\nsetDefaults = function setDefaults(data) {\n  if (!data) data = {};\n\n  // default form type is \"normal\"\n  if (typeof data.type !== 'string') {\n    data.type = 'normal';\n  }\n\n  // default form validation is \"submitThenKeyup\"\n  if (typeof data.validation !== 'string') {\n    data.validation = 'submitThenKeyup';\n  }\n\n  // Resolve form schema\n  if (!data._resolvedSchema) {\n    var formType = data.type;\n    var schema = data.schema;\n    if (schema) {\n      schema = AutoForm.Utility.lookup(schema);\n    } else {\n      var collection = AutoForm.Utility.lookup(data.collection);\n      if (collection && typeof collection.simpleSchema === 'function') {\n        schema = collection.simpleSchema(data.doc);\n      }\n    }\n\n    // Form type definition can optionally alter the schema\n    var ftd = Utility.getFormTypeDef(formType);\n\n    if (typeof ftd.adjustSchema === 'function') {\n      schema = ftd.adjustSchema.call({ form: data }, schema);\n    }\n\n    // If we have a schema, cache it\n    if (schema) {\n      data._resolvedSchema = schema;\n    }\n  }\n\n  return data;\n};\n\nvar waitingForForms = {};\nAutoForm.rerunWhenFormRenderedOrDestroyed = function (formId) {\n  if (!_.has(waitingForForms, formId)) {\n    waitingForForms[formId] = new Tracker.Dependency();\n  }\n  waitingForForms[formId].depend();\n};\n\nAutoForm.triggerFormRenderedDestroyedReruns = function (formId) {\n  if (!_.has(waitingForForms, formId)) {\n    waitingForForms[formId] = new Tracker.Dependency();\n  }\n  waitingForForms[formId].changed();\n};\n","/* global AutoForm */\n\nAutoForm.addFormType('insert', {\n  onSubmit: function () {\n    var c = this;\n\n    // Prevent browser form submission\n    this.event.preventDefault();\n\n    // Make sure we have a collection\n    var collection = this.collection;\n    if (!collection) {\n      throw new Error(\"AutoForm: You must specify a collection when form type is insert.\");\n    }\n\n    // See if the collection has a schema attached\n    var collectionHasSchema = (typeof collection.simpleSchema === \"function\" &&\n                               collection.simpleSchema(this.insertDoc) != null);\n\n    // Run \"before.insert\" hooks\n    this.runBeforeHooks(this.insertDoc, function (doc) {\n      // Perform insert\n      if (collectionHasSchema) {\n        // If the collection2 pkg is used and a schema is attached, we pass a validationContext\n        collection.insert(doc, c.validationOptions, c.result);\n      } else {\n        // If the collection2 pkg is not used or no schema is attached, we don't pass options\n        // because core Meteor's `insert` function does not accept\n        // an options argument.\n        collection.insert(doc, c.result);\n      }\n    });\n  },\n  validateForm: function () {\n    // Get SimpleSchema\n    var ss = AutoForm.getFormSchema(this.form.id);\n    // Validate\n    return AutoForm._validateFormDoc(this.formDoc, false, this.form.id, ss, this.form);\n  },\n  shouldPrevalidate: function () {\n    // Prevalidate only if there is both a `schema` attribute and a `collection` attribute\n    return !!this.formAttributes.collection && !!this.formAttributes.schema;\n  }\n});\n","/* global AutoForm */\n\nAutoForm.addFormType('update', {\n  onSubmit: function () {\n    var c = this;\n\n    // Prevent browser form submission\n    this.event.preventDefault();\n\n    // Make sure we have a collection\n    var collection = this.collection;\n    if (!collection) {\n      throw new Error(\"AutoForm: You must specify a collection when form type is update.\");\n    }\n\n    // Run \"before.update\" hooks\n    this.runBeforeHooks(this.updateDoc, function (modifier) {\n      if (_.isEmpty(modifier)) { // make sure this check stays after the before hooks\n        // Nothing to update. Just treat it as a successful update.\n        c.result(null, 0);\n      } else {\n        // Perform update\n        collection.update({_id: c.docId}, modifier, c.validationOptions, c.result);\n      }\n    });\n  },\n  usesModifier: true,\n  validateForm: function () {\n    // Get SimpleSchema\n    var ss = AutoForm.getFormSchema(this.form.id);\n    // We validate the modifier. We don't want to throw errors about missing required fields, etc.\n    return AutoForm._validateFormDoc(this.formDoc, true, this.form.id, ss, this.form);\n  },\n  shouldPrevalidate: function () {\n    // Prevalidate only if there is both a `schema` attribute and a `collection` attribute\n    return !!this.formAttributes.collection && !!this.formAttributes.schema;\n  }\n});\n","/* global AutoForm */\n\nAutoForm.addFormType('update-pushArray', {\n  onSubmit: function () {\n    var c = this;\n\n    // Prevent browser form submission\n    this.event.preventDefault();\n\n    // Make sure we have a collection\n    var collection = this.collection;\n    if (!collection) {\n      throw new Error(\"AutoForm: You must specify a collection when form type is update-pushArray.\");\n    }\n\n    // Make sure we have a scope\n    var scope = c.formAttributes.scope;\n    if (!scope) {\n      throw new Error(\"AutoForm: You must specify a scope when form type is update-pushArray.\");\n    }\n\n    // Run \"before.update\" hooks\n    this.runBeforeHooks(this.insertDoc, function (doc) {\n      if (_.isEmpty(doc)) { // make sure this check stays after the before hooks\n        // Nothing to update. Just treat it as a successful update.\n        c.result(null, 0);\n      } else {\n        var modifer = {$push: {}};\n        modifer.$push[scope] = doc;\n        // Perform update\n        collection.update({_id: c.docId}, modifer, c.validationOptions, c.result);\n      }\n    });\n  },\n  validateForm: function () {\n    // Get SimpleSchema\n    var ss = AutoForm.getFormSchema(this.form.id);\n    // We validate as if it's an insert form\n    return AutoForm._validateFormDoc(this.formDoc, false, this.form.id, ss, this.form);\n  },\n  adjustSchema: function (ss) {\n    return ss.getObjectSchema(this.form.scope + '.$');\n  },\n  shouldPrevalidate: function () {\n    // Prevalidate because the form is generated with a schema\n    // that has keys different from the collection schema\n    return true;\n  }\n});\n","/* global AutoForm */\n\nAutoForm.addFormType('method', {\n  onSubmit: function () {\n    var c = this;\n\n    // Prevent browser form submission\n    this.event.preventDefault();\n\n    if (!this.formAttributes.meteormethod) {\n      throw new Error('When form type is \"method\", you must also provide a \"meteormethod\" attribute');\n    }\n\n    // Run \"before.method\" hooks\n    this.runBeforeHooks(this.insertDoc, function (doc) {\n      // Validate. If both schema and collection were provided, then we validate\n      // against the collection schema here. Otherwise we validate against whichever\n      // one was passed.\n      var valid = (c.formAttributes.validation === 'none') ||\n          c.formTypeDefinition.validateForm.call({\n            form: c.formAttributes,\n            formDoc: doc,\n            useCollectionSchema: c.ssIsOverride\n          });\n\n      if (valid === false) {\n        c.failedValidation();\n      } else {\n        // Call the method. If a ddp connection was provided, use\n        // that instead of the default Meteor connection\n        var ddp = c.formAttributes.ddp;\n        ddp = (ddp && typeof ddp.call === 'function') ? ddp : Meteor;\n        ddp.call(c.formAttributes.meteormethod, doc, c.result);\n      }\n    });\n  },\n  validateForm: function () {\n    // Get SimpleSchema\n    var ss = AutoForm.getFormSchema(this.form.id);\n\n    var collection = AutoForm.getFormCollection(this.form.id);\n    // If there is a `schema` attribute but you want to force validation against the\n    // collection's schema instead, pass useCollectionSchema=true\n    ss = (this.useCollectionSchema && collection) ? collection.simpleSchema() : ss;\n\n    // Validate\n    return AutoForm._validateFormDoc(this.formDoc, false, this.form.id, ss, this.form);\n  },\n  shouldPrevalidate: function () {\n    // Prevalidate only if there is both a `schema` attribute and a `collection` attribute\n    return !!this.formAttributes.collection && !!this.formAttributes.schema;\n  }\n});\n","/* global AutoForm */\n\nAutoForm.addFormType('method-update', {\n  onSubmit: function () {\n    var c = this;\n\n    // Prevent browser form submission\n    this.event.preventDefault();\n\n    if (!this.formAttributes.meteormethod) {\n      throw new Error('When form type is \"method-update\", you must also provide a \"meteormethod\" attribute');\n    }\n\n    // Run \"before.method\" hooks\n    this.runBeforeHooks(this.updateDoc, function (updateDoc) {\n      // Validate. If both schema and collection were provided, then we validate\n      // against the collection schema here. Otherwise we validate against whichever\n      // one was passed.\n      var valid = (c.formAttributes.validation === 'none') ||\n          c.formTypeDefinition.validateForm.call({\n            form: c.formAttributes,\n            formDoc: updateDoc,\n            useCollectionSchema: c.ssIsOverride\n          });\n\n      if (valid === false) {\n        c.failedValidation();\n      } else {\n        // Call the method. If a ddp connection was provided, use\n        // that instead of the default Meteor connection\n        var ddp = c.formAttributes.ddp;\n        ddp = (ddp && typeof ddp.call === 'function') ? ddp : Meteor;\n        ddp.call(c.formAttributes.meteormethod, {\n          _id: c.docId,\n          modifier: updateDoc,\n        }, c.result);\n      }\n    });\n  },\n  usesModifier: true,\n  validateForm: function () {\n    // Get SimpleSchema\n    var ss = AutoForm.getFormSchema(this.form.id);\n\n    var collection = AutoForm.getFormCollection(this.form.id);\n    // If there is a `schema` attribute but you want to force validation against the\n    // collection's schema instead, pass useCollectionSchema=true\n    ss = (this.useCollectionSchema && collection) ? collection.simpleSchema() : ss;\n\n    // We validate the modifier. We don't want to throw errors about missing required fields, etc.\n    return AutoForm._validateFormDoc(this.formDoc, true, this.form.id, ss, this.form);\n  },\n  shouldPrevalidate: function () {\n    // Prevalidate only if there is both a `schema` attribute and a `collection` attribute\n    return !!this.formAttributes.collection && !!this.formAttributes.schema;\n  }\n});\n","/* global AutoForm, Hooks */\n\nAutoForm.addFormType('normal', {\n  onSubmit: function () {\n    var c = this;\n\n    // Get onSubmit hooks\n    // These are called differently from the before hooks because\n    // they run async, but they can run in parallel and we need the\n    // result of all of them immediately because they can return\n    // false to stop normal form submission.\n    var hooks = Hooks.getHooks(this.formId, 'onSubmit');\n\n    var hookCount = hooks.length, doneCount = 0, submitError, submitResult;\n\n    if (hookCount === 0) {\n      // we haven't called preventDefault, so normal browser\n      // submission will now happen\n      this.endSubmission();\n      return;\n    }\n\n    // Set up onSubmit hook context\n    var ctx = _.extend({\n      done: function (error, result) {\n        doneCount++;\n        if (!submitError && error) {\n          submitError = error;\n        }\n        if (!submitResult && result) {\n          submitResult = result;\n        }\n        if (doneCount === hookCount) {\n          // run onError, onSuccess, endSubmit\n          c.result(submitError, submitResult);\n        }\n      }\n    }, this.hookContext);\n\n    // Call all hooks at once.\n    // Pass both types of doc plus the doc attached to the form.\n    // If any return false, we stop normal submission, but we don't\n    // run onError, onSuccess, endSubmit hooks until they all call this.done().\n    var shouldStop = false;\n    _.each(hooks, function eachOnSubmit(hook) {\n      var result = hook.call(ctx, c.insertDoc, c.updateDoc, c.currentDoc);\n      if (shouldStop === false && result === false) {\n        shouldStop = true;\n      }\n    });\n    if (shouldStop) {\n      this.event.preventDefault();\n      this.event.stopPropagation();\n    }\n  },\n  needsModifierAndDoc: true,\n  validateForm: function () {\n    // Get SimpleSchema\n    var ss = AutoForm.getFormSchema(this.form.id);\n    // Validate\n    return AutoForm._validateFormDoc(this.formDoc.insertDoc, false, this.form.id, ss, this.form);\n  }\n});\n","/* global AutoForm */\n\nAutoForm.addFormType('readonly', {\n  onSubmit: function () {\n    // Prevent browser form submission\n    this.event.preventDefault();\n    // Nothing else\n  },\n  validateForm: function () {\n    // Always valid\n    return true;\n  },\n  adjustInputContext: function (ctx) {\n    ctx.atts.readonly = \"\";\n    return ctx;\n  },\n  hideArrayItemButtons: true\n});\n","/* global AutoForm */\n\nAutoForm.addFormType('disabled', {\n  onSubmit: function () {\n    // Prevent browser form submission\n    this.event.preventDefault();\n    // Nothing else\n  },\n  validateForm: function () {\n    // Always valid\n    return true;\n  },\n  adjustInputContext: function (ctx) {\n    ctx.atts.disabled = \"\";\n    return ctx;\n  },\n  hideArrayItemButtons: true\n});\n","/*\n * The conversion functions in this file can be used by input types to convert their outgoing values into the data type expected by the schema\n */\n\nAutoForm.valueConverters = {\n  booleanToString: function booleanToString(val) {\n    if (val === true) {\n      return \"TRUE\";\n    } else if (val === false) {\n      return \"FALSE\";\n    }\n    return val;\n  },\n  booleanToStringArray: function booleanToStringArray(val) {\n    if (val === true) {\n      return [\"TRUE\"];\n    } else if (val === false) {\n      return [\"FALSE\"];\n    }\n    return val;\n  },\n  booleanToNumber: function booleanToNumber(val) {\n    if (val === true) {\n      return 1;\n    } else if (val === false) {\n      return 0;\n    }\n    return val;\n  },\n  booleanToNumberArray: function booleanToNumberArray(val) {\n    if (val === true) {\n      return [1];\n    } else if (val === false) {\n      return [0];\n    }\n    return val;\n  },\n  /**\n   * @method  AutoForm.valueConverters.dateToDateString\n   * @private\n   * @param  {Date} date\n   * @return {String}\n   *\n   * Returns a \"valid date string\" representing the local date.\n   */\n  dateToDateString: function dateToDateString(val) {\n    return (val instanceof Date) ? moment(val).format(\"YYYY-MM-DD\") : val;\n  },\n  /**\n   * @method  AutoForm.valueConverters.dateToDateStringUTC\n   * @private\n   * @param  {Date} date\n   * @return {String}\n   *\n   * Returns a \"valid date string\" representing the date converted to the UTC time zone.\n   */\n  dateToDateStringUTC: function dateToDateStringUTC(val) {\n    return (val instanceof Date) ? moment.utc(val).format(\"YYYY-MM-DD\") : val;\n  },\n  dateToDateStringUTCArray: function dateToDateStringUTCArray(val) {\n    if (val instanceof Date) {\n      return [AutoForm.valueConverters.dateToDateStringUTC(val)];\n    }\n    return val;\n  },\n  /**\n   * @method  AutoForm.valueConverters.dateToNormalizedForcedUtcGlobalDateAndTimeString\n   * @private\n   * @param  {Date} date\n   * @return {String}\n   *\n   * Returns a \"valid normalized forced-UTC global date and time string\" representing the time\n   * converted to the UTC time zone and expressed as the shortest possible string for the given\n   * time (e.g. omitting the seconds component entirely if the given time is zero seconds past the minute).\n   *\n   * http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#date-and-time-state-(type=datetime)\n   * http://www.whatwg.org/specs/web-apps/current-work/multipage/common-microsyntaxes.html#valid-normalized-forced-utc-global-date-and-time-string\n   */\n  dateToNormalizedForcedUtcGlobalDateAndTimeString: function dateToNormalizedForcedUtcGlobalDateAndTimeString(val) {\n    return (val instanceof Date) ? moment(val).utc().format(\"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]\") : val;\n  },\n  dateToNormalizedForcedUtcGlobalDateAndTimeStringArray: function dateToNormalizedForcedUtcGlobalDateAndTimeStringArray(val) {\n    if (val instanceof Date) {\n      return [AutoForm.valueConverters.dateToNormalizedForcedUtcGlobalDateAndTimeString(val)];\n    }\n    return val;\n  },\n  /**\n   * @method AutoForm.valueConverters.dateToNormalizedLocalDateAndTimeString\n   * @private\n   * @param {Date} date The Date object\n   * @param {String} [timezoneId] A valid timezoneId that moment-timezone understands, e.g., \"America/Los_Angeles\"\n   * @return {String}\n   *\n   * Returns a \"valid normalized local date and time string\".\n   */\n  dateToNormalizedLocalDateAndTimeString: function dateToNormalizedLocalDateAndTimeString(date, timezoneId) {\n    var m = moment(date);\n    // by default, we assume local timezone; add moment-timezone to app and pass timezoneId\n    // to use a different timezone\n    if (typeof timezoneId === \"string\") {\n      if (typeof m.tz !== \"function\") {\n        throw new Error(\"If you specify a timezoneId, make sure that you've added a moment-timezone package to your app\");\n      }\n      m.tz(timezoneId);\n    }\n    return m.format(\"YYYY-MM-DD[T]HH:mm:ss.SSS\");\n  },\n  dateToNumber: function dateToNumber(val) {\n    return (val instanceof Date) ? val.getTime() : val;\n  },\n  dateToNumberArray: function dateToNumberArray(val) {\n    if (val instanceof Date) {\n      return [val.getTime()];\n    }\n    return val;\n  },\n  dateToDateArray: function dateToDateArray(val) {\n    if (val instanceof Date) {\n      return [val];\n    }\n    return val;\n  },\n  stringToStringArray: function stringToStringArray(val) {\n    if (typeof val === \"string\") {\n      val = val.split(\",\");\n      return _.map(val, function (item) {\n        return $.trim(item);\n      });\n    }\n    return val;\n  },\n  /**\n   * @method AutoForm.valueConverters.stringToNumber\n   * @public\n   * @param {String} val A string or null or undefined.\n   * @return {Number|String} The string converted to a Number or the original value.\n   *\n   * For strings, returns Number(val) unless the result is NaN. Otherwise returns val.\n   */\n  stringToNumber: function stringToNumber(val) {\n    if (typeof val === \"string\" && val.length > 0) {\n      var numVal = Number(val);\n      if (!isNaN(numVal)) {\n        return numVal;\n      }\n    }\n    return val;\n  },\n  stringToNumberArray: function stringToNumberArray(val) {\n    if (typeof val === \"string\") {\n      val = val.split(\",\");\n      return _.map(val, function (item) {\n        item = $.trim(item);\n        return AutoForm.valueConverters.stringToNumber(item);\n      });\n    }\n    return val;\n  },\n  /**\n   * @method AutoForm.valueConverters.stringToBoolean\n   * @private\n   * @param {String} val A string or null or undefined.\n   * @return {Boolean|String} The string converted to a Boolean.\n   *\n   * If the string is \"true\" or \"1\", returns `true`. If the string is \"false\" or \"0\", returns `false`. Otherwise returns the original string.\n   */\n  stringToBoolean: function stringToBoolean(val) {\n    if (typeof val === \"string\" && val.length > 0) {\n      var lval = val.toLowerCase();\n      if (lval === \"true\" || lval === \"1\") {\n        return true;\n      } else if (lval === \"false\" || lval === \"0\") {\n        return false;\n      }\n    }\n    return val;\n  },\n  stringToBooleanArray: function stringToBooleanArray(val) {\n    if (typeof val === \"string\") {\n      val = val.split(\",\");\n      return _.map(val, function (item) {\n        item = $.trim(item);\n        return AutoForm.valueConverters.stringToBoolean(item);\n      });\n    }\n    return val;\n  },\n  /**\n   * @method AutoForm.valueConverters.stringToDate\n   * @private\n   * @param {String} val A string or null or undefined.\n   * @return {Date|String} The string converted to a Date instance.\n   *\n   * Returns new Date(val) as long as val is a string with at least one character. Otherwise returns the original string.\n   */\n  stringToDate: function stringToDate(val) {\n    if (typeof val === \"string\" && val.length > 0) {\n      return new Date(val);\n    }\n    return val;\n  },\n  stringToDateArray: function stringToDateArray(val) {\n    if (typeof val === \"string\") {\n      val = val.split(\",\");\n      return _.map(val, function (item) {\n        item = $.trim(item);\n        return AutoForm.valueConverters.stringToDate(item);\n      });\n    }\n    return val;\n  },\n  numberToString: function numberToString(val) {\n    if (typeof val === \"number\") {\n      return val.toString();\n    }\n    return val;\n  },\n  numberToStringArray: function numberToStringArray(val) {\n    if (typeof val === \"number\") {\n      return [val.toString()];\n    }\n    return val;\n  },\n  numberToNumberArray: function numberToNumberArray(val) {\n    if (typeof val === \"number\") {\n      return [val];\n    }\n    return val;\n  },\n  numberToBoolean: function numberToBoolean(val) {\n    if (val === 0) {\n      return false;\n    } else if (val === 1) {\n      return true;\n    }\n    return val;\n  },\n  numberToBooleanArray: function numberToBooleanArray(val) {\n    if (val === 0) {\n      return [false];\n    } else if (val === 1) {\n      return [true];\n    }\n    return val;\n  }\n};\n\n// BACKWARDS COMPATIBILITY - some of these were formerly on the Utility object\nUtility.dateToDateString = AutoForm.valueConverters.dateToDateString;\nUtility.dateToDateStringUTC = AutoForm.valueConverters.dateToDateStringUTC;\nUtility.dateToNormalizedForcedUtcGlobalDateAndTimeString = AutoForm.valueConverters.dateToNormalizedForcedUtcGlobalDateAndTimeString;\nUtility.dateToNormalizedLocalDateAndTimeString = AutoForm.valueConverters.dateToNormalizedLocalDateAndTimeString;\nUtility.stringToBool = AutoForm.valueConverters.stringToBoolean;\nUtility.stringToNumber = AutoForm.valueConverters.stringToNumber;\nUtility.stringToDate = AutoForm.valueConverters.stringToDate;\n","AutoForm.addInputType(\"boolean-checkbox\", {\n  template: \"afCheckbox\",\n  valueOut: function () {\n    return !!this.is(\":checked\");\n  },\n  valueConverters: {\n    \"string\": AutoForm.valueConverters.booleanToString,\n    \"stringArray\": AutoForm.valueConverters.booleanToStringArray,\n    \"number\": AutoForm.valueConverters.booleanToNumber,\n    \"numberArray\": AutoForm.valueConverters.booleanToNumberArray\n  },\n  contextAdjust: function (context) {\n    if (context.value === true) {\n      context.atts.checked = \"\";\n    }\n    //don't add required attribute to checkboxes because some browsers assume that to mean that it must be checked, which is not what we mean by \"required\"\n    delete context.atts.required;\n    return context;\n  }\n});\n","AutoForm.addInputType(\"boolean-radios\", {\n  template: \"afBooleanRadioGroup\",\n  valueOut: function () {\n    if (this.find('input[value=false]').is(\":checked\")) {\n      return false;\n    } else if (this.find('input[value=true]').is(\":checked\")) {\n      return true;\n    } else if (this.find('input[value=null]').is(\":checked\")) {\n      return null;\n    }\n  },\n  valueConverters: {\n    \"string\": AutoForm.valueConverters.booleanToString,\n    \"stringArray\": AutoForm.valueConverters.booleanToStringArray,\n    \"number\": AutoForm.valueConverters.booleanToNumber,\n    \"numberArray\": AutoForm.valueConverters.booleanToNumberArray\n  }\n});\n\nTemplate.afBooleanRadioGroup.helpers({\n  falseAtts: function falseAtts() {\n    var atts = _.omit(this.atts, 'trueLabel', 'falseLabel', 'nullLabel', 'data-schema-key');\n    if (this.value === false) {\n      atts.checked = \"\";\n    }\n    return atts;\n  },\n  trueAtts: function trueAtts() {\n    var atts = _.omit(this.atts, 'trueLabel', 'falseLabel', 'nullLabel', 'data-schema-key');\n    if (this.value === true) {\n      atts.checked = \"\";\n    }\n    return atts;\n  },\n  nullAtts: function nullAtts() {\n    var atts = _.omit(this.atts, 'trueLabel', 'falseLabel', 'nullLabel', 'data-schema-key');\n    if (this.value !== true && this.value !== false) {\n      atts.checked = \"\";\n    }\n    return atts;\n  },\n  dsk: function () {\n    return {'data-schema-key': this.atts['data-schema-key']};\n  }\n});\n","AutoForm.addInputType(\"boolean-select\", {\n  template: \"afBooleanSelect\",\n  valueOut: function () {\n    var val = this.val();\n    if (val === \"true\") {\n      return true;\n    } else if (val === \"false\") {\n      return false;\n    }\n  },\n  valueConverters: {\n    \"string\": AutoForm.valueConverters.booleanToString,\n    \"stringArray\": AutoForm.valueConverters.booleanToStringArray,\n    \"number\": AutoForm.valueConverters.booleanToNumber,\n    \"numberArray\": AutoForm.valueConverters.booleanToNumberArray\n  },\n  contextAdjust: function (context) {\n    var atts = _.omit(context.atts, 'trueLabel', 'falseLabel', 'nullLabel', 'firstOption');\n\n    // build items list\n    context.items = [\n      {\n        name: context.name,\n        value: \"\",\n        // _id must be included because it is a special property that\n        // #each uses to track unique list items when adding and removing them\n        // See https://github.com/meteor/meteor/issues/2174\n        _id: \"\",\n        selected: (context.value !== false && context.value !== true),\n        label: context.atts.nullLabel || context.atts.firstOption || \"(Select One)\",\n        atts: atts\n      },\n      {\n        name: context.name,\n        value: \"false\",\n        // _id must be included because it is a special property that\n        // #each uses to track unique list items when adding and removing them\n        // See https://github.com/meteor/meteor/issues/2174\n        _id: \"false\",\n        selected: (context.value === false),\n        label: context.atts.falseLabel || \"False\",\n        atts: atts\n      },\n      {\n        name: context.name,\n        value: \"true\",\n        // _id must be included because it is a special property that\n        // #each uses to track unique list items when adding and removing them\n        // See https://github.com/meteor/meteor/issues/2174\n        _id: \"true\",\n        selected: (context.value === true),\n        label: context.atts.trueLabel || \"True\",\n        atts: atts\n      }\n    ];\n\n    return context;\n  }\n});\n","AutoForm.addInputType(\"button\", {\n  template: \"afInputButton\"\n});","AutoForm.addInputType(\"color\", {\n  template: \"afInputColor\"\n});","AutoForm.addInputType(\"contenteditable\", {\n  template: \"afContenteditable\",\n  valueOut: function () {\n    return this.html();\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts['data-maxlength'] === \"undefined\" && typeof context.max === \"number\") {\n      context.atts['data-maxlength'] = context.max;\n    }\n    return context;\n  }\n});\n\nTemplate.afContenteditable.events({\n  'blur div[contenteditable=true]': function (event, template) {\n    template.$(event.target).change();\n  }\n});\n\nTemplate.afContenteditable.helpers({\n  getValue: function (value) {\n    if(Template.instance().view.isRendered){\n      Template.instance().$('[contenteditable]').html(value);\n    }\n  }\n});\n\nTemplate.afContenteditable.onRendered(function () {\n  var template = this;\n\n  template.autorun(function () {\n    var data = Template.currentData();\n    template.$('[contenteditable]').html(data.value);\n  });\n});\n","AutoForm.addInputType(\"date\", {\n  template: \"afInputDate\",\n  valueIn: function (val) {\n    //convert Date to string value\n    return AutoForm.valueConverters.dateToDateStringUTC(val);\n  },\n  valueOut: function () {\n    var val = this.val();\n    if (AutoForm.Utility.isValidDateString(val)) {\n      //Date constructor will interpret val as UTC and create\n      //date at mignight in the morning of val date in UTC time zone\n      return new Date(val);\n    } else {\n      return null;\n    }\n  },\n  valueConverters: {\n    \"string\": AutoForm.valueConverters.dateToDateStringUTC,\n    \"stringArray\": AutoForm.valueConverters.dateToDateStringUTCArray,\n    \"number\": AutoForm.valueConverters.dateToNumber,\n    \"numberArray\": AutoForm.valueConverters.dateToNumberArray,\n    \"dateArray\": AutoForm.valueConverters.dateToDateArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.max === \"undefined\" && context.max instanceof Date) {\n      context.atts.max = AutoForm.valueConverters.dateToDateStringUTC(context.max);\n    }\n    if (typeof context.atts.min === \"undefined\" && context.min instanceof Date) {\n      context.atts.min = AutoForm.valueConverters.dateToDateStringUTC(context.min);\n    }\n    return context;\n  }\n});\n","AutoForm.addInputType(\"datetime\", {\n  template: \"afInputDateTime\",\n  valueIn: function (val) {\n    //convert Date to string value\n    return AutoForm.valueConverters.dateToNormalizedForcedUtcGlobalDateAndTimeString(val);\n  },\n  valueOut: function () {\n    var val = this.val();\n    val = (typeof val === \"string\") ? val.replace(/ /g, \"T\") : val;\n    if (AutoForm.Utility.isValidNormalizedForcedUtcGlobalDateAndTimeString(val)) {\n      //Date constructor will interpret val as UTC due to ending \"Z\"\n      return new Date(val);\n    } else {\n      return null;\n    }\n  },\n  valueConverters: {\n    \"string\": AutoForm.valueConverters.dateToNormalizedForcedUtcGlobalDateAndTimeString,\n    \"stringArray\": AutoForm.valueConverters.dateToNormalizedForcedUtcGlobalDateAndTimeStringArray,\n    \"number\": AutoForm.valueConverters.dateToNumber,\n    \"numberArray\": AutoForm.valueConverters.dateToNumberArray,\n    \"dateArray\": AutoForm.valueConverters.dateToDateArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.max === \"undefined\" && context.max instanceof Date) {\n      context.atts.max = AutoForm.valueConverters.dateToNormalizedForcedUtcGlobalDateAndTimeString(context.max);\n    }\n    if (typeof context.atts.min === \"undefined\" && context.min instanceof Date) {\n      context.atts.min = AutoForm.valueConverters.dateToNormalizedForcedUtcGlobalDateAndTimeString(context.min);\n    }\n    return context;\n  }\n});\n","AutoForm.addInputType(\"datetime-local\", {\n  template: \"afInputDateTimeLocal\",\n  valueIn: function (val, atts) {\n    //convert Date to string value\n    return (val instanceof Date) ? AutoForm.valueConverters.dateToNormalizedLocalDateAndTimeString(val, atts.timezoneId) : val;\n  },\n  valueOut: function () {\n    var val = this.val();\n    val = (typeof val === \"string\") ? val.replace(/ /g, \"T\") : val;\n    if (AutoForm.Utility.isValidNormalizedLocalDateAndTimeString(val)) {\n      var timezoneId = this.attr(\"data-timezone-id\");\n      // default is local, but if there's a timezoneId, we use that\n      if (typeof timezoneId === \"string\") {\n        if (typeof moment.tz !== \"function\") {\n          throw new Error(\"If you specify a timezoneId, make sure that you've added a moment-timezone package to your app\");\n        }\n        return moment.tz(val, timezoneId).toDate();\n      } else {\n        return moment(val).toDate();\n      }\n    } else {\n      return this.val();\n    }\n  },\n  valueConverters: {\n    \"string\": function dateToNormalizedLocalDateAndTimeString(val) {\n      return (val instanceof Date) ? AutoForm.valueConverters.dateToNormalizedLocalDateAndTimeString(val, this.attr(\"data-timezone-id\")) : val;\n    },\n    \"stringArray\": function dateToNormalizedLocalDateAndTimeStringArray(val) {\n      if (val instanceof Date) {\n        return [AutoForm.valueConverters.dateToNormalizedLocalDateAndTimeString(val, this.attr(\"data-timezone-id\"))];\n      }\n      return val;\n    },\n    \"number\": AutoForm.valueConverters.dateToNumber,\n    \"numberArray\": AutoForm.valueConverters.dateToNumberArray,\n    \"dateArray\": AutoForm.valueConverters.dateToDateArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.max === \"undefined\" && context.max instanceof Date) {\n      context.atts.max = AutoForm.valueConverters.dateToNormalizedLocalDateAndTimeString(context.max, context.atts.timezoneId);\n    }\n    if (typeof context.atts.min === \"undefined\" && context.min instanceof Date) {\n      context.atts.min = AutoForm.valueConverters.dateToNormalizedLocalDateAndTimeString(context.min, context.atts.timezoneId);\n    }\n    if (context.atts.timezoneId) {\n      context.atts[\"data-timezone-id\"] = context.atts.timezoneId;\n    }\n    delete context.atts.timezoneId;\n    return context;\n  }\n});\n","AutoForm.addInputType(\"email\", {\n  template: \"afInputEmail\",\n  contextAdjust: function (context) {\n    if (typeof context.atts.maxlength === \"undefined\" && typeof context.max === \"number\") {\n      context.atts.maxlength = context.max;\n    }\n    return context;\n  }\n});","AutoForm.addInputType(\"file\", {\n  template: \"afInputFile\"\n});","AutoForm.addInputType(\"hidden\", {\n  template: \"afInputHidden\",\n  isHidden: true,\n  valueOut: function () {\n    return this.val();\n  },\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray,\n    \"number\": AutoForm.valueConverters.stringToNumber,\n    \"numberArray\": AutoForm.valueConverters.stringToNumberArray,\n    \"boolean\": AutoForm.valueConverters.stringToBoolean,\n    \"booleanArray\": AutoForm.valueConverters.stringToBooleanArray,\n    \"date\": AutoForm.valueConverters.stringToDate,\n    \"dateArray\": AutoForm.valueConverters.stringToDateArray\n  }\n});\n","AutoForm.addInputType(\"image\", {\n  template: \"afInputImage\"\n});","AutoForm.addInputType(\"month\", {\n  template: \"afInputMonth\",\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray\n  }\n});\n","AutoForm.addInputType(\"number\", {\n  template: \"afInputNumber\",\n  valueOut: function () {\n    return AutoForm.valueConverters.stringToNumber(this.val());\n  },\n  valueConverters: {\n    \"string\": AutoForm.valueConverters.numberToString,\n    \"stringArray\": AutoForm.valueConverters.numberToStringArray,\n    \"numberArray\": AutoForm.valueConverters.numberToNumberArray,\n    \"boolean\": AutoForm.valueConverters.numberToBoolean,\n    \"booleanArray\": AutoForm.valueConverters.numberToBooleanArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.max === \"undefined\" && typeof context.max === \"number\") {\n      context.atts.max = context.max;\n    }\n    if (typeof context.atts.min === \"undefined\" && typeof context.min === \"number\") {\n      context.atts.min = context.min;\n    }\n    return context;\n  }\n});\n","AutoForm.addInputType(\"password\", {\n  template: \"afInputPassword\",\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.maxlength === \"undefined\" && typeof context.max === \"number\") {\n      context.atts.maxlength = context.max;\n    }\n    return context;\n  }\n});\n","AutoForm.addInputType(\"radio\", {\n  template: \"afRadio\",\n  valueOut: function () {\n    if (this.is(\":checked\")) {\n      return this.val();\n    }\n  },\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray\n  }\n});\n\nTemplate[\"afRadio\"].helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    return atts;\n  }\n});\n","AutoForm.addInputType(\"range\", {\n  template: \"afInputRange\",\n  valueOut: function () {\n    return AutoForm.valueConverters.stringToNumber(this.val());\n  },\n  valueConverters: {\n    \"string\": AutoForm.valueConverters.numberToString,\n    \"stringArray\": AutoForm.valueConverters.numberToStringArray,\n    \"numberArray\": AutoForm.valueConverters.numberToNumberArray,\n    \"boolean\": AutoForm.valueConverters.numberToBoolean,\n    \"booleanArray\": AutoForm.valueConverters.numberToBooleanArray\n  }\n});\n","AutoForm.addInputType(\"reset\", {\n  template: \"afInputReset\"\n});","AutoForm.addInputType(\"search\", {\n  template: \"afInputSearch\",\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.maxlength === \"undefined\" && typeof context.max === \"number\") {\n      context.atts.maxlength = context.max;\n    }\n    return context;\n  }\n});\n","AutoForm.addInputType(\"select\", {\n  template: \"afSelect\",\n  valueOut: function () {\n    return this.val();\n  },\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray,\n    \"number\": AutoForm.valueConverters.stringToNumber,\n    \"numberArray\": AutoForm.valueConverters.stringToNumberArray,\n    \"boolean\": AutoForm.valueConverters.stringToBoolean,\n    \"booleanArray\": AutoForm.valueConverters.stringToBooleanArray,\n    \"date\": AutoForm.valueConverters.stringToDate,\n    \"dateArray\": AutoForm.valueConverters.stringToDateArray\n  },\n  contextAdjust: function (context) {\n    //can fix issues with some browsers selecting the firstOption instead of the selected option\n    context.atts.autocomplete = \"off\";\n\n    var itemAtts = _.omit(context.atts, 'firstOption');\n    var firstOption = context.atts.firstOption;\n\n    // build items list\n    context.items = [];\n\n    // If a firstOption was provided, add that to the items list first\n    if (firstOption !== false) {\n      if (typeof firstOption === 'function'){\n        firstOption = firstOption();\n      }\n      context.items.push({\n        name: context.name,\n        label: (typeof firstOption === \"string\" ? firstOption : \"(Select One)\"),\n        value: \"\",\n        // _id must be included because it is a special property that\n        // #each uses to track unique list items when adding and removing them\n        // See https://github.com/meteor/meteor/issues/2174\n        //\n        // Setting this to an empty string caused problems if option with value\n        // 1 was in the options list because Spacebars evaluates \"\" to 1 and\n        // considers that a duplicate.\n        // See https://github.com/aldeed/meteor-autoform/issues/656\n        _id: \"AUTOFORM_EMPTY_FIRST_OPTION\",\n        selected: false,\n        atts: itemAtts\n      });\n    }\n\n    // Add all defined options\n    _.each(context.selectOptions, function(opt) {\n      if (opt.optgroup) {\n        var subItems = _.map(opt.options, function(subOpt) {\n          return {\n            name: context.name,\n            label: subOpt.label,\n            value: subOpt.value,\n            htmlAtts: _.omit(subOpt, 'label', 'value'),\n            // _id must be included because it is a special property that\n            // #each uses to track unique list items when adding and removing them\n            // See https://github.com/meteor/meteor/issues/2174\n            //\n            // The toString() is necessary because otherwise Spacebars evaluates\n            // any string to 1 if the other values are numbers, and then considers\n            // that a duplicate.\n            // See https://github.com/aldeed/meteor-autoform/issues/656\n            _id: subOpt.value.toString(),\n            selected: (subOpt.value === context.value),\n            atts: itemAtts\n          };\n        });\n        context.items.push({\n          optgroup: opt.optgroup,\n          items: subItems\n        });\n      } else {\n        context.items.push({\n          name: context.name,\n          label: opt.label,\n          value: opt.value,\n          htmlAtts: _.omit(opt, 'label', 'value'),\n          // _id must be included because it is a special property that\n          // #each uses to track unique list items when adding and removing them\n          // See https://github.com/meteor/meteor/issues/2174\n          //\n          // The toString() is necessary because otherwise Spacebars evaluates\n          // any string to 1 if the other values are numbers, and then considers\n          // that a duplicate.\n          // See https://github.com/aldeed/meteor-autoform/issues/656\n          _id: opt.value.toString(),\n          selected: (opt.value === context.value),\n          atts: itemAtts\n        });\n      }\n    });\n\n    return context;\n  }\n});\n","AutoForm.addInputType(\"select-checkbox\", {\n  template: \"afCheckboxGroup\",\n  valueIsArray: true,\n  valueOut: function () {\n    var val = [];\n    this.find('input[type=checkbox]').each(function () {\n      if ($(this).is(\":checked\")) {\n        val.push($(this).val());\n      }\n    });\n    return val;\n  },\n  contextAdjust: function (context) {\n    var itemAtts = _.omit(context.atts);\n\n    // build items list\n    context.items = [];\n\n    // Add all defined options\n    _.each(context.selectOptions, function(opt) {\n      context.items.push({\n        name: context.name,\n        label: opt.label,\n        value: opt.value,\n        // _id must be included because it is a special property that\n        // #each uses to track unique list items when adding and removing them\n        // See https://github.com/meteor/meteor/issues/2174\n        _id: opt.value,\n        selected: (_.contains(context.value, opt.value)),\n        atts: itemAtts\n      });\n    });\n\n    return context;\n  }\n});\n\nTemplate.afCheckboxGroup.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    // remove data-schema-key attribute because we put it\n    // on the entire group\n    delete atts[\"data-schema-key\"];\n    return atts;\n  },\n  dsk: function dsk() {\n    return {\n      \"data-schema-key\": this.atts[\"data-schema-key\"]\n    }\n  }\n});\n","AutoForm.addInputType(\"select-checkbox-inline\", {\n  template: \"afCheckboxGroupInline\",\n  valueIsArray: true,\n  valueOut: function () {\n    var val = [];\n    this.find('input[type=checkbox]').each(function () {\n      if ($(this).is(\":checked\")) {\n        val.push($(this).val());\n      }\n    });\n    return val;\n  },\n  contextAdjust: function (context) {\n    var itemAtts = _.omit(context.atts);\n\n    // build items list\n    context.items = [];\n\n    // Add all defined options\n    _.each(context.selectOptions, function(opt) {\n      context.items.push({\n        name: context.name,\n        label: opt.label,\n        value: opt.value,\n        // _id must be included because it is a special property that\n        // #each uses to track unique list items when adding and removing them\n        // See https://github.com/meteor/meteor/issues/2174\n        _id: opt.value,\n        selected: (_.contains(context.value, opt.value)),\n        atts: itemAtts\n      });\n    });\n\n    return context;\n  }\n});\n\nTemplate.afCheckboxGroupInline.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    // remove data-schema-key attribute because we put it\n    // on the entire group\n    delete atts[\"data-schema-key\"];\n    return atts;\n  },\n  dsk: function dsk() {\n    return {\n      \"data-schema-key\": this.atts[\"data-schema-key\"]\n    };\n  }\n});\n","AutoForm.addInputType(\"select-multiple\", {\n  template: \"afSelectMultiple\",\n  valueIsArray: true,\n  valueOut: function () {\n    return AutoForm.Utility.getSelectValues(this[0]);\n  },\n  contextAdjust: function (context) {\n    // build items list\n    context.items = _.map(context.selectOptions, function(opt) {\n      if (opt.optgroup) {\n        var subItems = _.map(opt.options, function(subOpt) {\n          return {\n            name: context.name,\n            label: subOpt.label,\n            value: subOpt.value,\n            htmlAtts: _.omit(subOpt, 'label', 'value'),\n            // _id must be included because it is a special property that\n            // #each uses to track unique list items when adding and removing them\n            // See https://github.com/meteor/meteor/issues/2174\n            _id: subOpt.value,\n            selected: _.contains(context.value, subOpt.value),\n            atts: context.atts\n          };\n        });\n        return {\n          optgroup: opt.optgroup,\n          items: subItems\n        };\n      } else {\n        return {\n          name: context.name,\n          label: opt.label,\n          value: opt.value,\n          htmlAtts: _.omit(opt, 'label', 'value'),\n          // _id must be included because it is a special property that\n          // #each uses to track unique list items when adding and removing them\n          // See https://github.com/meteor/meteor/issues/2174\n          _id: opt.value,\n          selected: _.contains(context.value, opt.value),\n          atts: context.atts\n        };\n      }\n    });\n\n    return context;\n  }\n});\n","AutoForm.addInputType(\"select-radio\", {\n  template: \"afRadioGroup\",\n  valueOut: function () {\n    return this.find('input[type=radio]:checked').val();\n  },\n  contextAdjust: function (context) {\n    var itemAtts = _.omit(context.atts);\n\n    // build items list\n    context.items = [];\n\n    // Add all defined options\n    _.each(context.selectOptions, function(opt) {\n      context.items.push({\n        name: context.name,\n        label: opt.label,\n        value: opt.value,\n        // _id must be included because it is a special property that\n        // #each uses to track unique list items when adding and removing them\n        // See https://github.com/meteor/meteor/issues/2174\n        _id: opt.value,\n        selected: (opt.value === context.value),\n        atts: itemAtts\n      });\n    });\n\n    return context;\n  }\n});\n\nTemplate.afRadioGroup.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    // remove data-schema-key attribute because we put it\n    // on the entire group\n    delete atts[\"data-schema-key\"];\n    return atts;\n  },\n  dsk: function dsk() {\n    return {\n      \"data-schema-key\": this.atts[\"data-schema-key\"]\n    };\n  }\n});\n","AutoForm.addInputType(\"select-radio-inline\", {\n  template: \"afRadioGroupInline\",\n  valueOut: function () {\n    return this.find('input[type=radio]:checked').val();\n  },\n  contextAdjust: function (context) {\n    var itemAtts = _.omit(context.atts);\n\n    // build items list\n    context.items = [];\n\n    // Add all defined options\n    _.each(context.selectOptions, function(opt) {\n      context.items.push({\n        name: context.name,\n        label: opt.label,\n        value: opt.value,\n        // _id must be included because it is a special property that\n        // #each uses to track unique list items when adding and removing them\n        // See https://github.com/meteor/meteor/issues/2174\n        _id: opt.value,\n        selected: (opt.value === context.value),\n        atts: itemAtts\n      });\n    });\n\n    return context;\n  }\n});\n\nTemplate.afRadioGroupInline.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    // remove data-schema-key attribute because we put it\n    // on the entire group\n    delete atts[\"data-schema-key\"];\n    return atts;\n  },\n  dsk: function dsk() {\n    return {\n      \"data-schema-key\": this.atts[\"data-schema-key\"]\n    };\n  }\n});\n","AutoForm.addInputType(\"submit\", {\n  template: \"afInputSubmit\"\n});","AutoForm.addInputType(\"tel\", {\n  template: \"afInputTel\",\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.maxlength === \"undefined\" && typeof context.max === \"number\") {\n      context.atts.maxlength = context.max;\n    }\n    return context;\n  }\n});\n","AutoForm.addInputType(\"text\", {\n  template: \"afInputText\",\n  valueOut: function () {\n    return this.val();\n  },\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray,\n    \"number\": AutoForm.valueConverters.stringToNumber,\n    \"numberArray\": AutoForm.valueConverters.stringToNumberArray,\n    \"boolean\": AutoForm.valueConverters.stringToBoolean,\n    \"booleanArray\": AutoForm.valueConverters.stringToBooleanArray,\n    \"date\": AutoForm.valueConverters.stringToDate,\n    \"dateArray\": AutoForm.valueConverters.stringToDateArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.maxlength === \"undefined\" && typeof context.max === \"number\") {\n      context.atts.maxlength = context.max;\n    }\n    return context;\n  }\n});\n","AutoForm.addInputType(\"textarea\", {\n  template: \"afTextarea\",\n  valueConverters: {\n    \"stringArray\": function (val) {\n      if (typeof val === \"string\" && val.length > 0) {\n        return linesToArray(val);\n      }\n      return val;\n    },\n    \"number\": AutoForm.valueConverters.stringToNumber,\n    \"numberArray\": AutoForm.valueConverters.stringToNumberArray,\n    \"boolean\": AutoForm.valueConverters.stringToBoolean,\n    \"booleanArray\": function (val) {\n      if (typeof val === \"string\" && val.length > 0) {\n        var arr = linesToArray(val);\n        return _.map(arr, function (item) {\n          return AutoForm.valueConverters.stringToBoolean(item);\n        });\n      }\n      return val;\n    },\n    \"date\": AutoForm.valueConverters.stringToDate,\n    \"dateArray\": function (val) {\n      if (typeof val === \"string\" && val.length > 0) {\n        var arr = linesToArray(val);\n        return _.map(arr, function (item) {\n          return AutoForm.valueConverters.stringToDate(item);\n        });\n      }\n      return val;\n    }\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.maxlength === \"undefined\" && typeof context.max === \"number\") {\n      context.atts.maxlength = context.max;\n    }\n    return context;\n  }\n});\n\nfunction linesToArray(text) {\n  text = text.split('\\n');\n  var lines = [];\n  _.each(text, function (line) {\n    line = $.trim(line);\n    if (line.length) {\n      lines.push(line);\n    }\n  });\n  return lines;\n}\n","AutoForm.addInputType(\"time\", {\n  template: \"afInputTime\",\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray\n  }\n});\n","AutoForm.addInputType(\"url\", {\n  template: \"afInputUrl\",\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray\n  },\n  contextAdjust: function (context) {\n    if (typeof context.atts.maxlength === \"undefined\" && typeof context.max === \"number\") {\n      context.atts.maxlength = context.max;\n    }\n    return context;\n  }\n});\n","AutoForm.addInputType(\"week\", {\n  template: \"afInputWeek\",\n  valueConverters: {\n    \"stringArray\": AutoForm.valueConverters.stringToStringArray\n  }\n});\n","import MongoObject from 'mongo-object';\n\n/* global AutoForm, ReactiveVar, arrayTracker, Hooks, Utility, setDefaults */\n\nTemplate.autoForm.helpers({\n  atts: function autoFormTplAtts() {\n    // After removing all of the props we know about, everything else should\n    // become a form attribute unless it's an array or object.\n    var val, htmlAttributes = {}, context = this;\n    var removeProps = [\n      \"schema\",\n      \"collection\",\n      \"validation\",\n      \"doc\",\n      \"resetOnSuccess\",\n      \"type\",\n      \"template\",\n      \"autosave\",\n      \"autosaveOnKeyup\",\n      \"meteormethod\",\n      \"filter\",\n      \"autoConvert\",\n      \"removeEmptyStrings\",\n      \"trimStrings\"\n    ];\n\n    // Filter out any attributes that have a component prefix\n    function hasComponentPrefix(prop) {\n      return _.any(Utility.componentTypeList, function (componentType) {\n        return prop.indexOf(componentType + '-') === 0;\n      });\n    }\n\n    // Filter out arrays and objects, which are obviously not meant to be\n    // HTML attributes.\n    for (var prop in context) {\n      if (context.hasOwnProperty(prop) &&\n          !_.contains(removeProps, prop) &&\n          !hasComponentPrefix(prop)) {\n        val = context[prop];\n        if (!_.isArray(val) && !_.isObject(val)) {\n          htmlAttributes[prop] = val;\n        }\n      }\n    }\n\n    // By default, we add the `novalidate=\"novalidate\"` attribute to our form,\n    // unless the user passes `validation=\"browser\"`.\n    if (this.validation !== \"browser\" && !htmlAttributes.novalidate) {\n      htmlAttributes.novalidate = \"novalidate\";\n    }\n\n    return htmlAttributes;\n  },\n  afDestroyUpdateForm: function (formId) {\n    AutoForm._destroyForm[formId] = AutoForm._destroyForm[formId] || new ReactiveVar(false);\n    return AutoForm._destroyForm[formId].get();\n  }\n});\n\nTemplate.autoForm.created = function autoFormCreated() {\n  var template = this;\n\n  // We'll add tracker dependencies for reactive field values\n  // to this object as necessary\n  template.formValues = template.formValues || {};\n\n  // We'll store \"sticky\" errors here. These are errors added\n  // manually based on server validation, which we don't want to\n  // be wiped out by further client validation.\n  template._stickyErrors = {};\n\n  template.autorun(function (c) {\n    var data = Template.currentData(); // rerun when current data changes\n    var formId = data.id;\n\n    if (!formId) {\n      throw new Error('Every autoForm and quickForm must have an \"id\" attribute set to a unique string.');\n    }\n\n    // When we change the form, loading a different doc, reloading the current doc, etc.,\n    // we also want to reset the array counts for the form\n    arrayTracker.resetForm(formId);\n\n    data = setDefaults(data);\n\n    // Clone the doc so that docToForm and other modifications do not change\n    // the original referenced object.\n    var doc = data.doc ? EJSON.clone(data.doc) : null;\n\n    // Update cached form values for hot code reload persistence\n    if (data.preserveForm === false) {\n      AutoForm.formPreserve.unregisterForm(formId);\n    } else {\n      // Even if we have already registered, we reregister to ensure that the\n      // closure values of template, formId, and ss remain correct after each\n      // reaction\n      AutoForm.formPreserve.registerForm(formId, function autoFormRegFormCallback() {\n        return AutoForm.getFormValues(formId, template, data._resolvedSchema, false);\n      });\n    }\n\n    // Retain doc values after a \"hot code push\", if possible\n    if (c.firstRun) {\n      var retrievedDoc = AutoForm.formPreserve.getDocument(formId);\n      if (retrievedDoc !== false) {\n        // Ensure we keep the _id property which may not be present in retrievedDoc.\n        doc = _.extend(doc || {}, retrievedDoc || {});\n      }\n    }\n\n    var mDoc;\n    if (doc && !_.isEmpty(doc)) {\n      var hookCtx = {formId: formId};\n      // Pass doc through docToForm hooks\n      _.each(Hooks.getHooks(formId, 'docToForm'), function autoFormEachDocToForm(hook) {\n        doc = hook.call(hookCtx, doc, data._resolvedSchema);\n        if (!doc) {\n          throw new Error('Oops! Did you forget to return the modified document from your docToForm hook for the ' + formId + ' form?');\n        }\n      });\n\n      // Create a \"flat doc\" that can be used to easily get values for corresponding\n      // form fields.\n      mDoc = new MongoObject(doc);\n      AutoForm.reactiveFormData.sourceDoc(formId, mDoc);\n    } else {\n      AutoForm.reactiveFormData.sourceDoc(formId, null);\n    }\n  });\n};\n\nTemplate.autoForm.rendered = function autoFormRendered() {\n  var lastId;\n  this.autorun(function () {\n    var data = Template.currentData(); // rerun when current data changes\n\n    if (data.id === lastId) return;\n    lastId = data.id;\n\n    AutoForm.triggerFormRenderedDestroyedReruns(data.id);\n  });\n};\n\nTemplate.autoForm.destroyed = function autoFormDestroyed() {\n  var self = this;\n  var formId = self.data.id;\n\n  // TODO if formId was changing reactively during life of instance,\n  // some data won't be removed by the calls below.\n\n  // Remove from array fields list\n  arrayTracker.untrackForm(formId);\n\n  // Unregister form preservation\n  AutoForm.formPreserve.unregisterForm(formId);\n\n  // Trigger value reruns\n  AutoForm.triggerFormRenderedDestroyedReruns(formId);\n};\n","/* global AutoForm */\n\nTemplate.quickForm.helpers({\n  getTemplateName: function () {\n    return AutoForm.getTemplateName('quickForm', this.template);\n  },\n  innerContext: function quickFormContext() {\n    var atts = this;\n    var adjustedData = AutoForm.parseData(_.clone(this));\n    var simpleSchema = adjustedData._resolvedSchema;\n    var sortedSchema = {};\n    var fieldGroups = [];\n    var grouplessFieldContext;\n\n    // --------------- A. Schema --------------- //\n\n    var fieldList = atts.fields;\n    if (fieldList) {\n      fieldList = AutoForm.Utility.stringToArray(fieldList, 'AutoForm: fields attribute must be an array or a string containing a comma-delimited list of fields');\n    } else {\n      const fullSchema = simpleSchema.mergedSchema();\n      fieldList = _.keys(fullSchema);\n    }\n\n    // get the schema object, but sorted into the same order as the field list\n    fieldList.forEach(fieldName => {\n      sortedSchema[fieldName] = AutoForm.Utility.getFieldDefinition(simpleSchema, fieldName);\n    });\n\n    // --------------- B. Field With No Groups --------------- //\n\n    var grouplessFields = getFieldsWithNoGroup(sortedSchema);\n    if (grouplessFields.length > 0) {\n      grouplessFieldContext = {\n        atts: _.extend({}, atts, {fields: grouplessFields}),\n        fields: grouplessFields\n      };\n    }\n\n    // --------------- C. Field With Groups --------------- //\n\n    // get sorted list of field groups\n    var fieldGroupNames = getSortedFieldGroupNames(sortedSchema);\n\n    // Loop through the list and make a field group context for each\n    _.each(fieldGroupNames, function (fieldGroupName) {\n      var fieldsForGroup = getFieldsForGroup(fieldGroupName, sortedSchema);\n\n      if (fieldsForGroup.length > 0) {\n        fieldGroups.push({\n          name: fieldGroupName,\n          atts: _.extend({}, atts, {fields: fieldsForGroup}),\n          fields: fieldsForGroup\n        });\n      }\n    });\n\n    // --------------- D. Context --------------- //\n\n    // Pass along quickForm context to autoForm context, minus a few\n    // properties that are specific to quickForms.\n    var qfAutoFormContext = _.omit(atts,\n                                   'buttonContent',\n                                   'buttonClasses',\n                                   'fields',\n                                   'omitFields',\n                                   'id-prefix');\n\n    // Determine whether we want to render a submit button\n    var qfShouldRenderButton = (atts.buttonContent !== false && atts.type !== 'readonly' && atts.type !== 'disabled');\n\n    var context = {\n      qfAutoFormContext: qfAutoFormContext,\n      atts: atts,\n      qfShouldRenderButton: qfShouldRenderButton,\n      fieldGroups: fieldGroups,\n      grouplessFields: grouplessFieldContext\n    };\n    return context;\n  }\n});\n\n/* Private Functions */\n\n/**\n * Takes a schema object and returns a sorted array of field group names for it\n *\n * @param   {Object}   schemaObj Like from mySimpleSchema.schema()\n * @returns {String[]} Array of field group names\n */\nfunction getSortedFieldGroupNames(schemaObj) {\n  var names = _.map(schemaObj, function (field) {\n    return field.autoform && field.autoform.group;\n  });\n\n  // Remove undefined\n  names = _.compact(names);\n\n  // Remove duplicate names\n  names = _.unique(names);\n\n  return names.sort();\n}\n\n/**\n * Returns the schema field names that belong in the group.\n *\n * @param   {String}   groupName The group name\n * @param   {Object}   schemaObj Like from mySimpleSchema.schema()\n * @returns {String[]} Array of field names (schema keys)\n */\nfunction getFieldsForGroup(groupName, schemaObj) {\n  var fields = _.map(schemaObj, function (field, fieldName) {\n    return (fieldName.slice(-2) !== '.$') &&\n      field.autoform &&\n      field.autoform.group === groupName &&\n      fieldName;\n  });\n\n  // Remove undefined\n  fields = _.compact(fields);\n\n  return fields;\n}\n\n/**\n * Returns the schema field names that don't belong to a group\n *\n * @param   {Object}   schemaObj Like from mySimpleSchema.schema()\n * @returns {String[]} Array of field names (schema keys)\n */\nfunction getFieldsWithNoGroup(schemaObj) {\n  var fields = _.map(schemaObj, function (field, fieldName) {\n    return (fieldName.slice(-2) !== '.$') &&\n      (!field.autoform || !field.autoform.group) &&\n      fieldName;\n  });\n\n  // Remove undefined\n  fields = _.compact(fields);\n\n  return fields;\n}\n","/* global AutoForm, arrayTracker */\n\nTemplate.afArrayField.helpers({\n  getTemplateName: function () {\n    return AutoForm.getTemplateName('afArrayField', this.template, this.name);\n  },\n  innerContext: function afArrayFieldContext() {\n    var c = AutoForm.Utility.getComponentContext(this, \"afArrayField\");\n    var name = c.atts.name;\n    var fieldMinCount = c.atts.minCount || 0;\n    var fieldMaxCount = c.atts.maxCount || Infinity;\n    var ss = AutoForm.getFormSchema();\n    var formId = AutoForm.getFormId();\n\n    // Init the array tracking for this field\n    var docCount = AutoForm.getArrayCountFromDocForField(formId, name);\n    if (docCount === undefined) {\n      docCount = c.atts.initialCount;\n    }\n    arrayTracker.initField(formId, name, ss, docCount, fieldMinCount, fieldMaxCount);\n\n    return {\n      atts: c.atts\n    };\n  }\n});\n","/* global AutoForm, arrayTracker */\n\nTemplate.afEachArrayItem.helpers({\n  innerContext: function afEachArrayItemContext() {\n    var c = AutoForm.Utility.getComponentContext(this, \"afEachArrayItem\");\n    var formId = AutoForm.getFormId();\n    var ss = AutoForm.getFormSchema();\n    var name = c.atts.name;\n\n    var docCount = AutoForm.getArrayCountFromDocForField(formId, name);\n    if (docCount === undefined) {\n      docCount = c.atts.initialCount;\n    }\n    arrayTracker.initField(formId, name, ss, docCount, c.atts.minCount, c.atts.maxCount);\n    \n    return arrayTracker.getField(formId, name);\n  }\n});\n","/* global AutoForm, getInputValue, getInputData, updateTrackedFieldValue */\n\nTemplate.afFieldInput.helpers({\n  // similar to AutoForm.getTemplateName, but we have fewer layers of fallback, and we fall back\n  // lastly to a template without an _ piece at the end\n  getTemplateName: function getTemplateName() {\n    var self = this;\n\n    // Determine what `type` attribute should be if not set\n    var inputType = AutoForm.getInputType(this);\n    var componentDef = AutoForm._inputTypeDefinitions[inputType];\n    if (!componentDef) {\n      throw new Error('AutoForm: No component found for rendering input with type \"' + inputType + '\"');\n    }\n\n    var inputTemplateName = componentDef.template;\n    var styleTemplateName = this.template;\n\n    // We skip the check for existence here so that we can get the `_plain` string\n    // even though they don't exist.\n    var templateName = AutoForm.getTemplateName(inputTemplateName, styleTemplateName, self.name, true);\n\n    // Special case: the built-in \"plain\" template uses the basic input templates for\n    // everything, so if we found _plain, we use inputTemplateName instead\n    if (templateName.indexOf('_plain') !== -1) {\n      templateName = null;\n    }\n\n    // If no override templateName found, use the exact name from the input type definition\n    if (!templateName || !Template[templateName]) {\n      templateName = inputTemplateName;\n    }\n\n    return templateName;\n  },\n  innerContext: function afFieldInputContext() {\n    var c = AutoForm.Utility.getComponentContext(this, \"afFieldInput\");\n    var form = AutoForm.getCurrentDataForForm();\n    var formId = form.id;\n    var ss = AutoForm.getFormSchema();\n    var defs = c.defs;\n\n    // Get schema default value.\n    // We must do this before adjusting defs for arrays.\n    var schemaDefaultValue = defs.defaultValue;\n\n    // Adjust for array fields if necessary\n    if (defs.type === Array) {\n      defs = AutoForm.Utility.getFieldDefinition(ss, c.atts.name + \".$\");\n    }\n\n    // Determine what `type` attribute should be if not set\n    var inputType = AutoForm.getInputType(this);\n    var componentDef = AutoForm._inputTypeDefinitions[inputType];\n    if (!componentDef) {\n      throw new Error('AutoForm: No component found for rendering input with type \"' + inputType + '\"');\n    }\n\n    // Get reactive mDoc\n    var mDoc = AutoForm.reactiveFormData.sourceDoc(formId);\n\n    // Get input value\n    var value = getInputValue(c.atts, c.atts.value, mDoc, schemaDefaultValue, c.atts.defaultValue, componentDef);\n\n    // Mark field value as changed for reactive updates\n    // We need to defer this until the element will be\n    // added to the DOM. Otherwise, AutoForm.getFieldValue\n    // will not pick up the new value when there are #if etc.\n    // blocks involved.\n    // See https://github.com/aldeed/meteor-autoform/issues/461\n    var template = AutoForm.templateInstanceForForm();\n    if (template.view.isRendered) {\n      // No need to do this on first run because we'll rerun the value functions\n      // once the form is rendered anyway\n      updateTrackedFieldValue(template, c.atts.name);\n    }\n\n    // Build input data context\n    var iData = getInputData(defs, c.atts, value, ss.label(c.atts.name), form.type);\n\n    // Adjust and return context\n    return (typeof componentDef.contextAdjust === \"function\") ? componentDef.contextAdjust(iData) : iData;\n  }\n});\n","/* global AutoForm */\n\nTemplate.afFormGroup.helpers({\n  getTemplateName: function () {\n    return AutoForm.getTemplateName('afFormGroup', this.template, this.name);\n  },\n  innerContext: function afFormGroupContext() {\n    var c = AutoForm.Utility.getComponentContext(this, 'afFormGroup');\n    var afFormGroupAtts = formGroupAtts(c.atts);\n    var afFieldLabelAtts = formGroupLabelAtts(c.atts);\n    var afFieldInputAtts = formGroupInputAtts(c.atts);\n\n    // Construct an `id` attribute for the input, optionally\n    // adding a user-provided prefix. Since id attribute is\n    // supposed to be unique in the DOM and templates can be\n    // included multiple times, it's best not to provide an `id`\n    // and generate a random one here for accessibility reasons.\n    var id = c.atts.id || Random.id();\n    var idPrefix = c.atts['id-prefix'];\n    if (idPrefix && idPrefix.length > 0) {\n      id = idPrefix + '-' + id;\n    }\n\n    // Set the input's `id` attribute and the label's `for` attribute to\n    // the same ID.\n    // NOTE: `afFieldLabelAtts.for` causes exception in IE8\n    afFieldLabelAtts['for'] = afFieldInputAtts.id = id;\n\n    // Get the field's schema definition\n    var fieldSchema = AutoForm.getSchemaForField(c.atts.name);\n\n    return {\n      skipLabel: (c.atts.label === false),\n      afFormGroupClass: c.atts['formgroup-class'],\n      afFormGroupAtts: afFormGroupAtts,\n      afFieldLabelAtts: afFieldLabelAtts,\n      afFieldInputAtts: afFieldInputAtts,\n      name: c.atts.name,\n      required: fieldSchema ? !fieldSchema.optional : false,\n      labelText: (typeof c.atts.label === 'string') ? c.atts.label : null\n    };\n  }\n});\n\n/*\n * Private\n */\n\nfunction formGroupAtts(atts) {\n  // Separate formgroup options from input options; formgroup items begin with 'formgroup-'\n  var labelAtts = {};\n  _.each(atts, function autoFormLabelAttsEach(val, key) {\n    if (key.indexOf('formgroup-') === 0 && key != 'formgroup-class') {\n      labelAtts[key.substring(10)] = val;\n    }\n  });\n  return labelAtts;\n}\n\nfunction formGroupLabelAtts(atts) {\n  // Separate label options from input options; label items begin with 'label-'\n  var labelAtts = {};\n  _.each(atts, function autoFormLabelAttsEach(val, key) {\n    if (key.indexOf('label-') === 0) {\n      labelAtts[key.substring(6)] = val;\n    }\n  });\n  return labelAtts;\n}\n\nfunction formGroupInputAtts(atts) {\n  // Separate input options from label and formgroup options\n  // We also don't want the 'label' option\n  var inputAtts = {};\n  _.each(atts, function autoFormLabelAttsEach(val, key) {\n    if (['id-prefix', 'id', 'label'].indexOf(key) === -1 && key.indexOf('label-') !== 0 && key.indexOf('formgroup-') !== 0) {\n      inputAtts[key] = val;\n    }\n  });\n  return inputAtts;\n}\n","/* global AutoForm */\n\nTemplate.afObjectField.helpers({\n  getTemplateName: function () {\n    return AutoForm.getTemplateName('afObjectField', this.template, this.name);\n  },\n  innerContext: function() {\n    var c = AutoForm.Utility.getComponentContext(this, 'afObjectField');\n    return _.extend({}, this, c.atts);\n  }\n});\n","/* global AutoForm */\n\nTemplate.afQuickField.helpers({\n  isGroup: function afQuickFieldIsGroup() {\n    var c = AutoForm.Utility.getComponentContext(this, \"afQuickField\");\n    // Render a group of fields if we expect an Object and we don't have options\n    // and we have not overridden the type\n    const isSubschema = typeof c.defs.type === 'object' && c.defs.type._schema;\n    return ((c.defs.type === Object || isSubschema) && !c.atts.options && !c.atts.type);\n  },\n  isFieldArray: function afQuickFieldIsFieldArray() {\n    var c = AutoForm.Utility.getComponentContext(this, \"afQuickField\");\n    // Render an array of fields if we expect an Array and we don't have options\n    // and we have not overridden the type\n    return (c.defs.type === Array && !c.atts.options && !c.atts.type);\n  },\n  groupAtts: function afQuickFieldGroupAtts() {\n    // afQuickField passes `fields` and `omitFields` on to `afObjectField`\n    // and `afArrayField`, but not to `afFormGroup`\n    return _.omit(this, 'fields', 'omitFields');\n  },\n  isHiddenInput: function afQuickFieldIsHiddenInput() {\n    var c = AutoForm.Utility.getComponentContext(this, \"afQuickField\");\n    var inputType = c.atts.type;\n    if (inputType) {\n      var componentDef = AutoForm._inputTypeDefinitions[inputType];\n      if (!componentDef) {\n        throw new Error('AutoForm: No component found for rendering input with type \"' + inputType + '\"');\n      }\n      return componentDef.isHidden;\n    }\n\n    return false;\n  }\n});\n","/* global AutoForm */\n\nTemplate.afQuickFields.helpers({\n  quickFieldAtts: function afQuickFieldsQuickFieldAtts() {\n    var afQuickFieldsComponentAtts, defaultOptions, atts = {};\n\n    // Get the attributes that were on the afQuickFields component\n    afQuickFieldsComponentAtts = Template.parentData(1);\n    // It's possible to call {{> afQuickFields}} with no attributes, in which case we\n    // don't want the \"attributes\" because they're really just the parent context.\n    if (!afQuickFieldsComponentAtts || afQuickFieldsComponentAtts.atts) {\n      afQuickFieldsComponentAtts = {};\n    }\n\n    // Add default options from schema/allowed\n    defaultOptions = AutoForm._getOptionsForField(this.name);\n    if (defaultOptions) {\n      atts.options = defaultOptions;\n    }\n\n    return _.extend(atts, afQuickFieldsComponentAtts, this);\n  }\n});\n","/* global AutoForm, Hooks, validateField, updateTrackedFieldValue, arrayTracker, updateAllTrackedFieldValues */\n\n// all form events handled here\nvar lastAutoSaveElement = null;\nvar lastKeyVals = {};\n\nfunction beginSubmit(formId, template, hookContext) {\n  if (!Utility.checkTemplate(template)) return;\n\n  // Get user-defined hooks\n  var hooks = Hooks.getHooks(formId, 'beginSubmit');\n  if (hooks.length) {\n    _.each(hooks, function beginSubmitHooks(hook) {\n      hook.call(hookContext);\n    });\n  } else {\n    // If there are no user-defined hooks, by default we disable the submit button during submission\n    var submitButton = template.find('button[type=submit]') || template.find('input[type=submit]');\n    if (submitButton) {\n      submitButton.disabled = true;\n    }\n  }\n}\n\nfunction endSubmit(formId, template, hookContext) {\n  if (!Utility.checkTemplate(template)) return;\n\n  // Try to avoid incorrect reporting of which input caused autosave\n  lastAutoSaveElement = null;\n  // Get user-defined hooks\n  var hooks = Hooks.getHooks(formId, 'endSubmit');\n  if (hooks.length) {\n    _.each(hooks, function endSubmitHooks(hook) {\n      hook.call(hookContext);\n    });\n  } else {\n    // If there are no user-defined hooks, by default we disable the submit button during submission\n    var submitButton = template.find('button[type=submit]') || template.find('input[type=submit]');\n    if (submitButton) {\n      submitButton.disabled = false;\n    }\n  }\n}\n\nfunction adjustKeyForArrays(key) {\n  var gKey = AutoForm.Utility.makeKeyGeneric(key);\n  if (gKey.slice(-2) === '.$' || gKey.indexOf('.$.') !== -1) {\n    key = gKey.slice(0, gKey.indexOf('.$'));\n  }\n  return key;\n}\n\n/**\n * Returns `true` if the specified validation type should\n * be revalidated only when the form is already invalid.\n * @param {String} validationType The validation type string.\n */\nfunction onlyIfAlreadyInvalid(validationType) {\n  return validationType === 'submitThenKeyup' ||\n    validationType === 'submitThenBlur';\n}\n\n/**\n * Given an element, returns the schema key for it, using the\n * `data-schema-key` attribute on the element or on the closest\n * element that has one.\n *\n * @param   {Element}          element The DOM element\n * @returns {String|undefined} The schema key\n */\nfunction getKeyForElement(element) {\n  var key = element.getAttribute('data-schema-key');\n  if (!key) {\n    key = $(element).closest('[data-schema-key]').attr('data-schema-key');\n  }\n  return key;\n}\n\n// throttle autosave, at most autosave every 500ms\nvar throttleAutosave = _.throttle(function(event) {\n  lastAutoSaveElement = event.target;\n  $(event.currentTarget).submit();\n}, 500, { leading: false });\n\nTemplate.autoForm.events({\n  'submit form': function autoFormSubmitHandler(event, template) {\n    var formDoc;\n    // Gather necessary form info\n    var formId = this.id;\n    var form = AutoForm.getCurrentDataForForm(formId);\n    var formType = form.type;\n    // ss will be the schema for the `schema` attribute if present,\n    // else the schema for the collection\n    var ss = AutoForm.getFormSchema(formId);\n    var collection = AutoForm.getFormCollection(formId);\n    var ssIsOverride = !!(collection && form.schema);\n\n    var currentDoc = form.doc;\n    var docId = currentDoc ? currentDoc._id : null;\n    var isValid;\n\n    var validationOptions = {\n      validationContext: formId,\n      filter: form.filter,\n      autoConvert: form.autoConvert,\n      removeEmptyStrings: form.removeEmptyStrings,\n      trimStrings: form.trimStrings\n    };\n\n    // Get the form type definition\n    var ftd;\n    try {\n      ftd = Utility.getFormTypeDef(formType);\n    } catch (err) {\n      event.preventDefault();\n      throw err;\n    }\n\n    // Gather hooks\n    var onSuccessHooks = Hooks.getHooks(formId, 'onSuccess');\n    var onErrorHooks = Hooks.getHooks(formId, 'onError');\n    var beforeHooks = Hooks.getHooks(formId, 'before', formType);\n    var afterHooks = Hooks.getHooks(formId, 'after', formType);\n\n    // Prep context with which hooks are called\n    var hookContext = {\n      addStickyValidationError: function (key, type, value) {\n        AutoForm.addStickyValidationError(formId, key, type, value);\n      },\n      autoSaveChangedElement: lastAutoSaveElement,\n      collection: collection,\n      currentDoc: currentDoc,\n      docId: docId,\n      event: event,\n      formAttributes: form,\n      formId: formId,\n      formTypeDefinition: ftd,\n      removeStickyValidationError: function (key) {\n        AutoForm.removeStickyValidationError(formId, key);\n      },\n      resetForm: function () {\n        AutoForm.resetForm(formId, template);\n      },\n      ss: ss,\n      ssIsOverride: ssIsOverride,\n      template: template,\n      validationContext: AutoForm.getValidationContext(formId)\n    };\n\n    // Gather all form values\n    if (ftd.needsModifierAndDoc) {\n      formDoc = AutoForm.getFormValues(formId, template, ss);\n      hookContext.updateDoc = formDoc.updateDoc;\n      hookContext.insertDoc = formDoc.insertDoc;\n    } else if (ftd.usesModifier) {\n      formDoc = AutoForm.getFormValues(formId, template, ss, true);\n      hookContext.updateDoc = formDoc;\n    } else {\n      formDoc = AutoForm.getFormValues(formId, template, ss, false);\n      hookContext.insertDoc = formDoc;\n    }\n\n    // It is pretty unlikely since we are submitting it, but if\n    // for some reason this form is not currently rendered, we exit.\n    if (!formDoc) {\n      event.preventDefault();\n      return;\n    }\n\n    function endSubmission() {\n      // Run endSubmit hooks (re-enabled submit button or form, etc.)\n      endSubmit(formId, template, hookContext);\n    }\n\n    function failedValidation() {\n      // add validationErrors array as a property\n      // of the Error object before we call\n      // onError hooks\n      var ec = ss.namedContext(formId);\n      var ik = ec.validationErrors(), error;\n      if (ik) {\n        if (ik.length) {\n          error = new Error(ik[0].message || ec.keyErrorMessage(ik[0].name));\n        } else {\n          error = new Error('form failed validation');\n        }\n        error.validationErrors = ik;\n      } else {\n        error = new Error('form failed validation');\n      }\n      _.each(onErrorHooks, function onErrorEach(hook) {\n        hook.call(hookContext, 'pre-submit validation', error);\n      });\n      event.preventDefault();\n      event.stopPropagation();\n      endSubmission();\n    }\n\n    // Prep function that calls before hooks.\n    function runBeforeHooks(doc, next) {\n      // We call the hooks recursively, in order added,\n      // passing the result of the first hook to the\n      // second hook, etc.\n      function runHook(i, doc) {\n        var hook = beforeHooks[i];\n\n        if (!hook) {\n          // We've run all hooks; continue submission\n          next(doc);\n          return;\n        }\n\n        // Define a `result` function\n        var cb = function (d) {\n          // If the hook returns false, we cancel\n          if (d === false) {\n            endSubmission();\n          } else if (!_.isObject(d)) {\n            throw new Error(\"A 'before' hook must return an object\");\n          } else {\n            runHook(i + 1, d);\n          }\n        };\n\n        // Add the `result` function to the before hook context\n        var ctx = _.extend({\n          result: _.once(cb)\n        }, hookContext);\n\n        var result = hook.call(ctx, doc);\n\n        // If the hook returns undefined, we wait for it\n        // to call this.result()\n        if (result !== void 0) {\n          ctx.result(result);\n        }\n      }\n\n      runHook(0, doc);\n    }\n\n    // Prep function that calls after, onError, and onSuccess hooks.\n    // Also resets the form on success.\n    function resultCallback(error, result) {\n      if (error) {\n        if (onErrorHooks && onErrorHooks.length) {\n          _.each(onErrorHooks, function onErrorEach(hook) {\n            hook.call(hookContext, formType, error);\n          });\n        } else if ((!afterHooks || !afterHooks.length) && ss.namedContext(formId).isValid()) {\n          // if there are no onError or \"after\" hooks or validation errors, log the error\n          // because it must be some other error from the server\n          console.log(error);\n        }\n      } else {\n        // By default, we reset form after successful submit, but\n        // you can opt out. We should never reset after submit\n        // when autosaving.\n        if (form.resetOnSuccess !== false && form.autosave !== true) {\n          AutoForm.resetForm(formId, template);\n        }\n        // Set docId in the context for insert forms, too\n        if (formType === 'insert') {\n          hookContext.docId = result;\n        }\n        _.each(onSuccessHooks, function onSuccessEach(hook) {\n          hook.call(hookContext, formType, result);\n        });\n      }\n      _.each(afterHooks, function afterHooksEach(hook) {\n        hook.call(hookContext, error, result);\n      });\n      endSubmission();\n    }\n\n    // Run beginSubmit hooks (disable submit button or form, etc.)\n    // NOTE: This needs to stay after getFormValues in case a\n    // beginSubmit hook disables inputs. We don't get values for\n    // disabled inputs, but if they are just disabling during submission,\n    // then we actually do want the values.\n    //\n    // Also keep this before prevalidation so that sticky errors can be\n    // removed in this hook.\n    beginSubmit(formId, template, hookContext);\n\n    // Ask form type definition whether we should prevalidate. By default we do.\n    var shouldPrevalidate = ftd.shouldPrevalidate ? ftd.shouldPrevalidate.call(hookContext) : true;\n\n    if (shouldPrevalidate) {\n      // This validation pass happens before any \"before\" hooks run. We\n      // validate against the form schema. Then before hooks can add any missing\n      // properties before we validate against the full collection schema.\n      try {\n        isValid = (form.validation === 'none') ||\n          ftd.validateForm.call({\n            form: form,\n            formDoc: formDoc,\n            useCollectionSchema: false\n          });\n      } catch (e) {\n        // Catch exceptions in validation functions which will bubble up here, cause a form with\n        // onSubmit() to submit prematurely and prevent the error from being reported\n        // (due to a page refresh).\n        console.error('Validation error', e);\n        isValid = false;\n      }\n      // If we failed pre-submit validation, we stop submission.\n      if (isValid === false) {\n        failedValidation();\n        return;\n      }\n    }\n\n    // Call onSubmit from the form type definition\n    ftd.onSubmit.call(_.extend({\n      runBeforeHooks: runBeforeHooks,\n      result: resultCallback,\n      endSubmission: endSubmission,\n      failedValidation: failedValidation,\n      validationOptions: validationOptions,\n      hookContext: hookContext\n    }, hookContext));\n  },\n  'keyup [data-schema-key]': function autoFormKeyUpHandler(event) {\n    // Ignore enter/return, shift, ctrl, cmd, tab, arrows, etc.\n    // Most of these are just optimizations, but without ignoring Enter, errors can fail to show up\n    // because of conflicts between running onSubmit handlers and this around the same time.\n    if (_.contains([13, 9, 16, 20, 17, 91, 37, 38, 39, 40], event.keyCode)) return;\n\n    // validateField is throttled, so we need to get the nearest form's\n    // ID here, while we're still in the correct context\n    var formId = AutoForm.getFormId();\n\n    // Get current form data context\n    var form = AutoForm.getCurrentDataForForm(formId);\n\n    var validationType = form.validation;\n    var skipEmpty = !(event.keyCode === 8 || event.keyCode === 46); // if deleting or backspacing, don't skip empty\n\n    if ((validationType === 'keyup' || validationType === 'submitThenKeyup')) {\n      var key = getKeyForElement(event.currentTarget);\n      if (!key) return;\n\n      validateField(key, formId, skipEmpty, onlyIfAlreadyInvalid(validationType));\n\n      // If it's an array field, we also want to validate the entire topmost array\n      // in case there are minCount/maxCount errors, etc.\n      var arrayKey = adjustKeyForArrays(key);\n      if (arrayKey !== key) {\n        validateField(arrayKey, formId, skipEmpty, onlyIfAlreadyInvalid(validationType));\n      }\n\n      // If the form should be auto-saved whenever updated, we do that on field\n      // changes instead of validating the field\n      if (form.autosaveOnKeyup === true) {\n        throttleAutosave(event);\n      }\n    }\n  },\n  'blur [data-schema-key]': function autoFormBlurHandler(event) {\n    // validateField is throttled, so we need to get the nearest form's\n    // ID here, while we're still in the correct context\n    var formId = AutoForm.getFormId();\n\n    // Get current form data context\n    var form = AutoForm.getCurrentDataForForm(formId);\n    var validationType = form.validation;\n\n    if (validationType === 'keyup' ||\n        validationType === 'blur' ||\n        validationType === 'submitThenKeyup' ||\n        validationType === 'submitThenBlur') {\n      var key = getKeyForElement(event.currentTarget);\n      if (!key) {return;}\n\n      validateField(key, formId, false, onlyIfAlreadyInvalid(validationType));\n\n      // If it's an array field, we also want to validate the entire topmost array\n      // in case there are minCount/maxCount errors, etc.\n      var arrayKey = adjustKeyForArrays(key);\n      if (arrayKey !== key) {\n        validateField(arrayKey, formId, false, onlyIfAlreadyInvalid(validationType));\n      }\n    }\n  },\n  'change form': function autoFormChangeHandler(event, template) {\n    var key = getKeyForElement(event.target);\n    if (!key) {return;}\n\n    var formId = this.id;\n\n    // Some plugins, like jquery.inputmask, can cause infinite\n    // loops by continually saying the field changed when it did not,\n    // especially in an autosave situation. This is an attempt to\n    // prevent that from happening.\n    var $target = $(event.target);\n    var keyVal = $target.val();\n    if (event.target.type === 'checkbox') {\n      // Special handling for checkboxes, which always have the same value\n      keyVal = keyVal + '_' + $target.prop('checked');\n    }\n\n    keyVal = key + '___' + keyVal;\n\n    if (formId in lastKeyVals && keyVal === lastKeyVals[formId]) {\n      return;\n    }\n    lastKeyVals[formId] = keyVal;\n\n    // Mark field value as changed for reactive updates\n    updateTrackedFieldValue(template, key);\n\n    // Get current form data context\n    var form = AutoForm.getCurrentDataForForm(formId);\n\n    // If the form should be auto-saved whenever updated, we do that on field\n    // changes instead of validating the field\n    if (form.autosave === true || form.autosaveOnKeyup === true) {\n      lastAutoSaveElement = event.target;\n      $(event.currentTarget).submit();\n      return;\n    }\n\n    var validationType = form.validation;\n\n    if (validationType === 'keyup' ||\n        validationType === 'blur' ||\n        validationType === 'submitThenKeyup' ||\n        validationType === 'submitThenBlur') {\n\n      validateField(key, formId, false, onlyIfAlreadyInvalid(validationType));\n\n      // If it's an array field, we also want to validate the entire topmost array\n      // in case there are minCount/maxCount errors, etc.\n      var arrayKey = adjustKeyForArrays(key);\n      if (arrayKey !== key) {\n        validateField(arrayKey, formId, false, onlyIfAlreadyInvalid(validationType));\n      }\n    }\n  },\n  'reset form': function autoFormResetHandler(event, template) {\n    var formId = this.id;\n\n    AutoForm.formPreserve.clearDocument(formId);\n\n    // Reset array counts\n    arrayTracker.resetForm(formId);\n\n    var vc = AutoForm.getValidationContext(formId);\n    if (vc) vc.reset();\n\n    event.preventDefault();\n    AutoForm._forceResetFormValues(formId);\n\n    // Mark all fields as changed\n    updateAllTrackedFieldValues(template);\n    // Focus the autofocus element\n    template.$('[autofocus]').focus();\n\n  },\n  'keydown .autoform-array-item input': function (event) {\n    // When enter is pressed in an array item field, default behavior\n    // seems to be to \"click\" the remove item button. This doesn't make\n    // sense so we stop it.\n    if (event.keyCode === 13) {\n      event.preventDefault();\n    }\n  },\n  'click .autoform-remove-item': function autoFormClickRemoveItem(event, template) {\n    var self = this; // This type of button must be used within an afEachArrayItem block, so we know the context\n\n    event.preventDefault();\n\n    var name = self.arrayFieldName;\n    var minCount = self.minCount; // optional, overrides schema\n    var maxCount = self.maxCount; // optional, overrides schema\n    var index = self.index;\n    var data = template.data;\n    var formId = data && data.id;\n    var ss = AutoForm.getFormSchema(formId);\n\n    // remove the item we clicked\n    arrayTracker.removeFromFieldAtIndex(formId, name, index, ss, minCount, maxCount);\n  },\n  'click .autoform-add-item': function autoFormClickAddItem(event, template) {\n    event.preventDefault();\n\n    // We pull from data attributes because the button could be manually\n    // added anywhere, so we don't know the data context.\n    var btn = $(event.currentTarget);\n    var name = btn.attr('data-autoform-field');\n    var minCount = btn.attr('data-autoform-minCount'); // optional, overrides schema\n    var maxCount = btn.attr('data-autoform-maxCount'); // optional, overrides schema\n\n    var data = template.data;\n    var formId = data && data.id;\n    var ss = AutoForm.getFormSchema(formId);\n\n    arrayTracker.addOneToField(formId, name, ss, minCount, maxCount);\n  }\n});\n","/* global AutoForm */\n\n/*\n * Template helpers for \"bootstrap3\" templates\n */\n\nTemplate.registerHelper('attsPlusFormControlClass', function attsPlusFormControlClass() {\n  var atts = _.clone(this.atts);\n  // Add bootstrap class\n  atts = AutoForm.Utility.addClass(atts, \"form-control\");\n  return atts;\n});\n\nTemplate.registerHelper('attsPlusBtnClass', function attsPlusBtnClass() {\n  var atts = _.clone(this.atts);\n  // Add bootstrap class\n  atts = AutoForm.Utility.addClass(atts, \"btn\");\n  return atts;\n});\n","Template.quickForm_bootstrap3.helpers({\n  fieldGroupLabel: function () {\n    var name = this.name;\n\n    // if field group name is of the form XY_abcde where \"XY\" is a number, remove prefix\n    if (!isNaN(parseInt(name.substr(0,2), 10)) && name.charAt(2) === \"_\") {\n      name = name.substr(3);\n    }\n\n    // if SimpleSchema.defaultLabel is defined, use it\n    if (AutoForm.SimpleSchema && typeof AutoForm.SimpleSchema.defaultLabel === \"function\") {\n      return AutoForm.SimpleSchema.defaultLabel(name);\n    } else {\n      // else, just capitalise name\n      return name.charAt(0).toUpperCase() + name.slice(1);\n    }\n  },\n  quickFieldsAtts: function () {\n    // These are the quickForm attributes that we want to forward to\n    // the afQuickFields component.\n    return _.pick(this.atts, 'fields', 'id-prefix', 'input-col-class', 'label-class');\n  },\n  submitButtonAtts: function bsQuickFormSubmitButtonAtts() {\n    var qfAtts = this.atts;\n    var atts = {};\n    if (typeof qfAtts.buttonClasses === 'string') {\n      atts['class'] = qfAtts.buttonClasses;\n    } else {\n      atts['class'] = 'btn btn-primary';\n    }\n    return atts;\n  }\n});\n","Template.afArrayField_bootstrap3.helpers({\n  panelClass: function () {\n    return this.panelClass || 'panel-default';\n  },\n  headingClass: function () {\n    return this.atts.headingClass || '';\n  },\n});\n","Template.afFormGroup_bootstrap3.helpers({\n  skipLabel: function bsFormGroupSkipLabel() {\n    var self = this;\n\n    var type = AutoForm.getInputType(self.afFieldInputAtts);\n    return (self.skipLabel || type === \"boolean-checkbox\");\n  },\n  bsFieldLabelAtts: function bsFieldLabelAtts() {\n    var atts = _.clone(this.afFieldLabelAtts);\n    // Add bootstrap class\n    atts = AutoForm.Utility.addClass(atts, \"control-label\");\n    return atts;\n  }\n});\n","Template.afObjectField_bootstrap3.helpers({\n  quickFieldsAtts: function () {\n    return _.pick(this, 'name', 'id-prefix');\n  },\n  panelClass: function() {\n    return this.panelClass || 'panel-default';\n  }\n});\n","Template.afBooleanRadioGroup_bootstrap3.helpers({\n  falseAtts: function falseAtts() {\n    var atts = _.omit(this.atts, 'trueLabel', 'falseLabel', 'nullLabel', 'data-schema-key');\n    if (this.value === false) {\n      atts.checked = \"\";\n    }\n    return atts;\n  },\n  trueAtts: function trueAtts() {\n    var atts = _.omit(this.atts, 'trueLabel', 'falseLabel', 'nullLabel', 'data-schema-key');\n    if (this.value === true) {\n      atts.checked = \"\";\n    }\n    return atts;\n  },\n  nullAtts: function nullAtts() {\n    var atts = _.omit(this.atts, 'trueLabel', 'falseLabel', 'nullLabel', 'data-schema-key');\n    if (this.value !== true && this.value !== false) {\n      atts.checked = \"\";\n    }\n    return atts;\n  },\n  dsk: function () {\n    return {'data-schema-key': this.atts['data-schema-key']};\n  }\n});\n","Template.afRadio_bootstrap3.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    return atts;\n  }\n});\n","Template.afCheckboxGroup_bootstrap3.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    // remove data-schema-key attribute because we put it\n    // on the entire group\n    delete atts[\"data-schema-key\"];\n    return atts;\n  },\n  dsk: function dsk() {\n    return {\n      \"data-schema-key\": this.atts[\"data-schema-key\"]\n    };\n  }\n});\n","Template.afCheckboxGroupInline_bootstrap3.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    // remove data-schema-key attribute because we put it\n    // on the entire group\n    delete atts[\"data-schema-key\"];\n    return atts;\n  },\n  dsk: function dsk() {\n    return {\n      \"data-schema-key\": this.atts[\"data-schema-key\"]\n    };\n  }\n});\n","Template.afRadioGroup_bootstrap3.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    // remove data-schema-key attribute because we put it\n    // on the entire group\n    delete atts[\"data-schema-key\"];\n    return atts;\n  },\n  dsk: function dsk() {\n    return {\n      \"data-schema-key\": this.atts[\"data-schema-key\"]\n    };\n  }\n});\n","Template.afRadioGroupInline_bootstrap3.helpers({\n  atts: function selectedAttsAdjust() {\n    var atts = _.clone(this.atts);\n    if (this.selected) {\n      atts.checked = \"\";\n    }\n    // remove data-schema-key attribute because we put it\n    // on the entire group\n    delete atts[\"data-schema-key\"];\n    return atts;\n  },\n  dsk: function dsk() {\n    return {\n      \"data-schema-key\": this.atts[\"data-schema-key\"]\n    };\n  }\n});\n","Template['quickForm_bootstrap3-horizontal'].helpers({\n  inputClass: function () {\n    return this.atts[\"input-col-class\"];\n  },\n  labelClass: function () {\n    return this.atts[\"label-class\"];\n  },\n  fieldGroupLabel: function () {\n    var name = this.name;\n\n    // if field group name is of the form XY_abcde where \"XY\" is a number, remove prefix\n    if (!isNaN(parseInt(name.substr(0,2), 10)) && name.charAt(2) === \"_\") {\n      name = name.substr(3);\n    }\n\n    // if SimpleSchema.defaultLabel is defined, use it\n    if (AutoForm.SimpleSchema && typeof AutoForm.SimpleSchema.defaultLabel === \"function\") {\n      return AutoForm.SimpleSchema.defaultLabel(name);\n    } else {\n      // else, just capitalise name\n      return name.charAt(0).toUpperCase() + name.slice(1);\n    }\n  },\n  quickFieldsAtts: function () {\n    // These are the quickForm attributes that we want to forward to\n    // the afQuickFields component.\n    return _.pick(this.atts, 'fields', 'id-prefix', 'input-col-class', 'label-class');\n  },\n  submitButtonAtts: function () {\n    var qfAtts = this.atts;\n    var atts = {};\n    if (typeof qfAtts.buttonClasses === \"string\") {\n      atts['class'] = qfAtts.buttonClasses;\n    } else {\n      atts['class'] = 'btn btn-primary';\n    }\n    return atts;\n  },\n  qfAutoFormContext: function () {\n    var ctx = _.clone(this.qfAutoFormContext || {});\n    ctx = AutoForm.Utility.addClass(ctx, 'form-horizontal');\n\n    // input-col-class and label-class attributes are unique to this template so they will\n    // not have been removed by AutoForm core. We remove them from the autoForm context\n    // because they are attributes supported only by quickFields, quickField,\n    // afObjectField, afArrayField, and afFormGroup.\n    delete ctx['input-col-class'];\n    delete ctx['label-class'];\n\n    return ctx;\n  }\n});\n","Template[\"afArrayField_bootstrap3-horizontal\"].helpers({\n  rightColumnClass: function () {\n    var atts = this.atts || {};\n    return atts['input-col-class'] || \"\";\n  },\n  afFieldLabelAtts: function () {\n    // Use only atts beginning with label-\n    var labelAtts = {};\n    _.each(this.atts, function (val, key) {\n      if (key.indexOf(\"label-\") === 0) {\n        labelAtts[key.substring(6)] = val;\n      }\n    });\n    // Add bootstrap class\n    labelAtts = AutoForm.Utility.addClass(labelAtts, \"control-label\");\n    return labelAtts;\n  }\n});\n","Template[\"afFormGroup_bootstrap3-horizontal\"].helpers({\n  afFieldInputAtts: function () {\n    var atts = _.omit(this.afFieldInputAtts || {}, 'input-col-class');\n    // We have a special template for check boxes, but otherwise we\n    // want to use the same as those defined for bootstrap3 template.\n    if (AutoForm.getInputType(this.afFieldInputAtts) === \"boolean-checkbox\") {\n      atts.template = \"bootstrap3-horizontal\";\n    } else {\n      atts.template = \"bootstrap3\";\n    }\n    return atts;\n  },\n  afFieldLabelAtts: function () {\n    var atts = _.clone(this.afFieldLabelAtts || {});\n    // Add bootstrap class\n    atts = AutoForm.Utility.addClass(atts, \"control-label\");\n    return atts;\n  },\n  rightColumnClass: function () {\n    var atts = this.afFieldInputAtts || {};\n    return atts['input-col-class'] || \"\";\n  },\n  skipLabel: function () {\n    var self = this;\n\n    var type = AutoForm.getInputType(self.afFieldInputAtts);\n    return (self.skipLabel || (type === \"boolean-checkbox\" && !self.afFieldInputAtts.leftLabel));\n  }\n});\n","/* global AutoForm */\n\nTemplate[\"afObjectField_bootstrap3-horizontal\"].helpers({\n  rightColumnClass: function () {\n    return this['input-col-class'] || \"\";\n  },\n  afFieldLabelAtts: function () {\n    // Use only atts beginning with label-\n    var labelAtts = {};\n    _.each(this, function (val, key) {\n      if (key.indexOf(\"label-\") === 0) {\n        labelAtts[key.substring(6)] = val;\n      }\n    });\n    // Add bootstrap class\n    labelAtts = AutoForm.Utility.addClass(labelAtts, \"control-label\");\n    return labelAtts;\n  },\n  quickFieldsAtts: function () {\n    var atts = _.pick(this, 'name', 'id-prefix');\n    // We want to default to using bootstrap3 template below this point\n    // because we don't want horizontal within horizontal\n    atts.template = 'bootstrap3';\n    return atts;\n  }\n});\n","Template[\"afCheckbox_bootstrap3-horizontal\"].helpers({\n  attsPlusSpecialClass: function () {\n    var atts = _.clone(this.atts);\n    atts = AutoForm.Utility.addClass(atts, \"autoform-checkbox-margin-fix\");\n    return atts;\n  },\n  useLeftLabel: function () {\n    return this.atts.leftLabel;\n  }\n});\n","/* global AutoForm */\n\nTemplate['quickForm_bootstrap3-inline'].helpers({\n  submitButtonAtts: function () {\n    var qfAtts = this.atts;\n    var atts = {};\n    if (typeof qfAtts.buttonClasses === 'string') {\n      atts['class'] = qfAtts.buttonClasses;\n    } else {\n      atts['class'] = 'btn btn-primary autoform-inline-align';\n    }\n    return atts;\n  },\n  qfAutoFormContext: function () {\n    var ctx = _.clone(this.qfAutoFormContext || {});\n    ctx = AutoForm.Utility.addClass(ctx, 'form-inline');\n\n    // label-class attribute is unique to this template so it will\n    // not have been removed by AutoForm core. We remove it from the autoForm context\n    // because it is an attribute supported only by quickFields, quickField,\n    // afObjectField, afArrayField, and afFormGroup.\n    delete ctx['label-class'];\n\n    return ctx;\n  },\n  quickFieldsAtts: function () {\n    // These are the quickForm attributes that we want to forward to\n    // the afQuickFields component.\n    return _.pick(this.atts, 'id-prefix', 'label-class');\n  }\n});\n\nTemplate['afFormGroup_bootstrap3-inline'].helpers({\n  afFieldInputAtts: function () {\n    var atts = _.clone(this.afFieldInputAtts || {});\n    // Use the same templates as those defined for bootstrap3 template.\n    atts.template = 'bootstrap3';\n    return atts;\n  }\n});\n","Template.quickForm_plain.helpers({\n  quickFieldsAtts: function () {\n    // These are the quickForm attributes that we want to forward to\n    // the afQuickFields component.\n    return _.pick(this.atts, 'id-prefix');\n  },\n  submitButtonAtts: function plQuickFormSubmitButtonAtts() {\n    var qfAtts = this.atts;\n    var atts = {};\n    if (typeof qfAtts.buttonClasses === \"string\") {\n      atts['class'] = qfAtts.buttonClasses;\n    }\n    return atts;\n  }\n});\n","Template.afObjectField_plain.helpers({\n  quickFieldsAtts: function () {\n    return _.pick(this, 'name', 'id-prefix');\n  }\n});\n","Template['quickForm_plain-fieldset'].helpers({\n  quickFieldsAtts: function () {\n    // These are the quickForm attributes that we want to forward to\n    // the afQuickFields component.\n    return _.pick(this.atts, 'id-prefix');\n  },\n  submitButtonAtts: function plfsQuickFormSubmitButtonAtts() {\n    var qfAtts = this.atts;\n    var atts = {};\n    if (typeof qfAtts.buttonClasses === \"string\") {\n      atts['class'] = qfAtts.buttonClasses;\n    }\n    return atts;\n  }\n});\n"]}